import{b as M,e as $,r as n,a as d,j as e}from"./index-D4P1_Gkc.js";import{X as G}from"./x-C-gq2N0i.js";const W={run:{background:"var(--accent-dim)",color:"var(--accent)"},rest:{background:"rgba(107,114,128,0.15)",color:"var(--text-muted)"},"cross-train":{background:"rgba(245,158,11,0.18)",color:"#f59e0b"},strength:{background:"var(--accent-dim)",color:"var(--accent)"}};function K(){var w,N;const b=M(),R=$(),[a,C]=n.useState(null),[I,_]=n.useState(!0),[f,h]=n.useState(!1),[u,D]=n.useState({}),[p,L]=n.useState(null),[E,v]=n.useState(null),[i,P]=n.useState(null),[T,j]=n.useState(!1),m=async()=>{var s,t;try{const[r,c,l]=await Promise.all([d.get("/plans/current"),d.get("/plans/compliance").catch(()=>({data:null})),d.get("/injury/active").catch(()=>({data:{injuries:[]}}))]);C(((s=r.data)==null?void 0:s.plan)||r.data||null),L(c.data);const o=(((t=l.data)==null?void 0:t.injuries)||[])[0]||null;P(o),j(o?localStorage.getItem(`forge-plan-injury-dismissed-${o.id}`)==="1":!1)}finally{_(!1)}};n.useEffect(()=>{m()},[]);const A=!!((w=R.state)!=null&&w.suggestEasyDay),g=n.useMemo(()=>{var s,t,r;if((r=(t=(s=a==null?void 0:a.plan_json)==null?void 0:s.weeks)==null?void 0:t[0])!=null&&r.days)return a.plan_json.weeks[0].days;if(!(a!=null&&a.weekly_structure))return[];if(Array.isArray(a.weekly_structure))return a.weekly_structure;try{return JSON.parse(a.weekly_structure)}catch{return[]}},[a]),x=n.useMemo(()=>{if(!i)return g;const s=["tempo","interval","threshold","speed","hill","long"];return g.map(t=>{const r=String(t.workout_type||t.type||"").toLowerCase(),c=!r.includes("rest")&&!r.includes("strength")&&!r.includes("cross"),l=s.some(o=>r.includes(o));return c&&l?{...t,workout_type:"Recovery",type:"recovery",distance_miles:0,description:"Low-impact recovery work, mobility, and PT."}:t})},[g,i]);n.useEffect(()=>{x.filter(t=>{const r=(t.workout_type||t.type||"").toLowerCase();return!r.includes("rest")&&!r.includes("strength")&&!r.includes("cross")}).forEach((t,r)=>{d.get(`/ai/run-brief?sessionId=${t.id||r}`).then(c=>{D(l=>({...l,[t.id||r]:c.data}))}).catch(()=>{})})},[x]);const k=async()=>{h(!0);try{await d.post("/plans/generate"),await m()}finally{h(!1)}},B=new Date().toLocaleDateString("en-US",{weekday:"long"});return I?e.jsx("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",color:"var(--text-muted)"},children:"Loading your training data..."}):a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:a.title||"Your Plan"}),e.jsxs("p",{className:"mt-1 text-sm",style:{color:"var(--text-muted)"},children:["Goal: ",a.goal||"--"]})]}),A&&e.jsx("div",{className:"rounded-xl p-3",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Recovery suggestion: replace today with an easy 20-30 minute run."})}),!T&&i&&e.jsx("div",{className:"rounded-xl p-3",style:{background:"rgba(234,179,8,0.2)",border:"1px solid #EAB308"},children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"#0f1117"},children:["Recovery Mode — ",i.body_part||"Injury"," — Est. return: ",i.date||"--"]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#0f1117"},children:"Your plan has been adjusted for recovery. Focus on PT and low-impact activity."})]}),e.jsx("button",{onClick:()=>{localStorage.setItem(`forge-plan-injury-dismissed-${i.id}`,"1"),j(!0)},"aria-label":"Dismiss recovery banner",style:{background:"transparent",color:"#0f1117"},children:e.jsx(G,{size:16})})]})}),((N=p==null?void 0:p.missed)==null?void 0:N.length)>0&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-sm font-semibold mb-2",style:{color:"var(--text-primary)"},children:"Missed sessions"}),e.jsx("div",{className:"space-y-2",children:p.missed.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[s.day," · ",s.type," ",s.distance?`· ${s.distance} mi`:""]}),e.jsx("button",{onClick:async()=>{v(s.sessionId),await d.post("/plans/reschedule-missed",{originalDate:s.date,sessionId:s.sessionId}),await m(),v(null)},className:"rounded-lg px-2 py-1 text-xs font-semibold",style:{background:"var(--accent)",color:"#000"},children:E===s.sessionId?"Rescheduling...":"Reschedule"})]},s.sessionId))})]}),e.jsx("div",{className:"space-y-3",children:x.map((s,t)=>{const r=(s.workout_type||s.type||"").toString().toLowerCase(),c=r.includes("cross")?"cross-train":r.includes("strength")?"strength":r.includes("rest")?"rest":"run",l=(s.day||"").toLowerCase().includes(B.toLowerCase());return e.jsxs("div",{className:"rounded-xl border p-4",style:l?{borderColor:"var(--accent)",background:"linear-gradient(135deg, rgba(234,179,8,0.12) 0%, var(--bg-card) 100%)"}:{borderColor:"var(--border-subtle)",background:"var(--bg-card)"},children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold",style:{color:"var(--text-primary)"},children:s.day||`Day ${t+1}`}),l?e.jsx("span",{className:"rounded-full px-2 py-0.5 text-xs font-bold",style:{background:"var(--accent)",color:"black"},children:"TODAY"}):null]}),e.jsx("span",{className:"rounded-full px-2 py-1 text-xs",style:W[c],children:s.workout_type||s.type||"Run"})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:s.description||"No description."}),u[s.id||t]&&e.jsxs("div",{className:"mt-2 rounded-lg p-2",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-primary)"},children:u[s.id||t].why}),e.jsxs("p",{className:"text-[11px]",style:{color:"var(--text-muted)"},children:["Effort: ",u[s.id||t].effort," · BPM: ",u[s.id||t].bpmRange," · Cadence: ",u[s.id||t].cadence]})]}),l&&e.jsx("div",{style:{marginTop:12},children:(()=>{const o=(s.workout_type||s.type||"").toLowerCase(),y=o.includes("rest"),S=o.includes("strength")||o.includes("lift")||o.includes("cross");return e.jsx("button",{onClick:()=>{y||b(S?"/log-lift":"/log-run")},style:{width:"100%",padding:"14px",background:y?"var(--bg-input)":"var(--accent)",color:y?"var(--text-muted)":"#000",fontWeight:900,fontSize:15,borderRadius:12,border:"none",cursor:y?"default":"pointer"},children:y?"Rest Day — Take it easy":S?"Log Workout":"Start Run"})})()})]},t)})}),e.jsx("button",{onClick:k,disabled:f,className:"w-full rounded-xl border py-3 font-semibold disabled:opacity-60",style:{borderColor:"var(--border-subtle)",background:"var(--bg-card)",color:"var(--text-primary)"},children:f?"Regenerating...":"Regenerate Plan"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx("img",{src:"/empty-plan.png",alt:"",className:"w-64 h-64 object-contain"}),e.jsx("p",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:"No training plan yet."}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Generate one to get started."}),e.jsx("button",{onClick:k,className:"mt-2 rounded-xl px-6 py-3 font-semibold text-black",style:{background:"var(--accent)"},children:"Generate Plan"})]})}export{K as default};
