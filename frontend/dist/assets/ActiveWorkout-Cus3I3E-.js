import{r,a as _,j as e,f as ee,b as te,e as se}from"./index-vmUng2Mm.js";function re({muscleGroup:l,onSelect:u,onClose:x}){const[o,g]=r.useState([]),[d,y]=r.useState(""),[T,N]=r.useState(!0),[L,h]=r.useState(!1),[v,j]=r.useState(""),[P,m]=r.useState(""),[n,D]=r.useState(null),[E,p]=r.useState(""),[f,k]=r.useState(!1);r.useEffect(()=>{R()},[l]);const R=async()=>{N(!0);try{const s=l?{muscle_group:l}:{},b=await _.get("/exercises",{params:s});g(Array.isArray(b.data)?b.data:[])}finally{N(!1)}},w=o.filter(s=>s.name.toLowerCase().includes(d.toLowerCase())),A=async()=>{var s,b;if(v.trim()){k(!0),p("");try{(await _.post("/exercises",{name:v.trim(),muscle_group:l||"other",instructions:P.trim()})).data.alreadyExists?p("Already in the library — found it!"):p("Added to community library!"),await R(),setTimeout(()=>{h(!1),j(""),m(""),p("")},1200)}catch(S){p(((b=(s=S==null?void 0:S.response)==null?void 0:s.data)==null?void 0:b.error)||"Could not add exercise.")}finally{k(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/70",onClick:s=>{s.target===s.currentTarget&&x()},children:e.jsxs("div",{className:"w-full max-w-lg rounded-t-2xl flex flex-col max-h-[80vh] relative",style:{background:"var(--bg-card)"},children:[n&&e.jsxs("div",{className:"absolute inset-0 z-10 rounded-t-2xl flex flex-col",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--border-subtle)"},children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:n.name}),e.jsx("button",{onClick:()=>D(null),className:"text-sm px-3 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Back"})]}),e.jsxs("div",{className:"overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:["Primary: ",n.muscle_group]}),n.secondary_muscles&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:["Also: ",n.secondary_muscles]})]}),n.how_to_image_url&&e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsx("img",{src:n.how_to_image_url,alt:n.name,className:"w-full object-contain max-h-48",onError:s=>{s.target.style.display="none"}})}),n.instructions?e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-sm font-semibold mb-2",style:{color:"var(--text-primary)"},children:"How to do it"}),e.jsx("p",{className:"text-sm leading-relaxed",style:{color:"var(--text-muted)"},children:n.instructions})]}):e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No instructions yet for this exercise."}),!n.is_system&&e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.6},children:"Community exercise — added by a FORGE user"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("button",{onClick:()=>{u(n),x()},className:"w-full py-3 rounded-xl font-bold text-black",style:{background:"var(--accent)"},children:["Select ",n.name]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:"Choose Exercise"}),l&&e.jsx("p",{className:"text-xs mt-0.5 capitalize",style:{color:"var(--text-muted)"},children:l})]}),e.jsx("button",{onClick:x,className:"text-sm px-3 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Close"})]}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:"var(--border-subtle)"},children:e.jsx("input",{type:"text",value:d,onChange:s=>y(s.target.value),placeholder:"Search exercises...",autoFocus:!0,className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}})}),e.jsx("div",{className:"overflow-y-auto flex-1 p-4 space-y-2",children:T?e.jsx("p",{className:"text-center py-8 text-sm",style:{color:"var(--text-muted)"},children:"Loading..."}):w.length===0&&!d?e.jsx("p",{className:"text-center py-8 text-sm",style:{color:"var(--text-muted)"},children:"No exercises for this muscle group yet."}):w.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsxs("p",{className:"text-sm mb-3",style:{color:"var(--text-muted)"},children:['No results for "',d,'"']}),!L&&e.jsxs("button",{onClick:()=>{j(d),h(!0)},className:"text-sm font-semibold px-4 py-2 rounded-xl",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:['Add "',d,'" to library']})]}):w.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl px-4 py-3 cursor-pointer transition-all hover:opacity-80",style:{background:"var(--bg-input)"},children:[e.jsxs("button",{className:"flex-1 text-left",onClick:()=>{u(s),x()},children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:s.name}),s.secondary_muscles&&e.jsxs("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:["Also: ",s.secondary_muscles]}),!s.is_system&&e.jsx("span",{className:"text-xs",style:{color:"var(--accent)",opacity:.7},children:"community"})]}),(s.instructions||s.how_to_image_url)&&e.jsx("button",{onClick:b=>{b.stopPropagation(),D(s)},className:"ml-3 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",style:{background:"var(--accent-dim)",color:"var(--accent)"},title:"How to do this exercise",children:"?"})]},s.id))}),e.jsx("div",{className:"border-t p-4",style:{borderColor:"var(--border-subtle)"},children:L?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold",style:{color:"var(--accent)"},children:"New exercise — saved for everyone"}),e.jsx("input",{type:"text",value:v,onChange:s=>j(s.target.value),placeholder:"Exercise name (e.g. Sissy Squat)",className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}}),e.jsx("textarea",{value:P,onChange:s=>m(s.target.value),placeholder:"How to do it (optional — helps other users)",rows:2,className:"w-full px-4 py-3 rounded-xl text-sm outline-none resize-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}}),E&&e.jsx("p",{className:"text-xs text-center font-medium",style:{color:"var(--accent)"},children:E}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{h(!1),j(""),m(""),p("")},className:"flex-1 py-3 rounded-xl text-sm",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Cancel"}),e.jsx("button",{onClick:A,disabled:f||!v.trim(),className:"flex-1 py-3 rounded-xl text-sm font-bold text-black",style:{background:v.trim()?"var(--accent)":"var(--bg-input)",opacity:f?.6:1},children:f?"Adding...":"Add Exercise"})]})]}):e.jsx("button",{onClick:()=>h(!0),className:"w-full py-3 rounded-xl text-sm font-semibold",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Don't see yours? Add it to the library"})})]})})}const ae=[30,60,90,120,180];function K(l){const u=Math.floor(l/3600),x=Math.floor(l%3600/60),o=l%60;return u>0?`${u}:${String(x).padStart(2,"0")}:${String(o).padStart(2,"0")}`:`${x}:${String(o).padStart(2,"0")}`}function le(){try{const l=new(window.AudioContext||window.webkitAudioContext),u=(x,o,g)=>{const d=l.createOscillator(),y=l.createGain();d.connect(y),y.connect(l.destination),d.frequency.value=x,d.type="sine",y.gain.setValueAtTime(.5,l.currentTime+o),y.gain.exponentialRampToValueAtTime(.001,l.currentTime+o+g),d.start(l.currentTime+o),d.stop(l.currentTime+o+g+.1)};u(880,0,.15),u(1100,.2,.15),u(880,.4,.15),u(1320,.6,.3)}catch{}}function oe(){var B,Q;const{id:l}=ee(),u=te(),x=se(),o=((B=x.state)==null?void 0:B.exercises)||[],g=((Q=x.state)==null?void 0:Q.workoutName)||"",[d,y]=r.useState(0),T=r.useRef(null),[N,L]=r.useState(0),[h,v]=r.useState(""),[j,P]=r.useState([]),[m,n]=r.useState(null),[D,E]=r.useState(!1),[p,f]=r.useState(""),[k,R]=r.useState(""),[w,A]=r.useState(1),[s,b]=r.useState([]),[S,U]=r.useState(!0),[C,F]=r.useState(0),[$,H]=r.useState(!1),M=r.useRef(null),[W,X]=r.useState(null),[q,O]=r.useState(!1);r.useEffect(()=>(T.current=setInterval(()=>y(t=>t+1),1e3),()=>clearInterval(T.current)),[]),r.useEffect(()=>{_.get(`/workouts/${l}`).then(t=>{var c,i;const a=((i=(c=t.data)==null?void 0:c.session)==null?void 0:i.muscle_groups)||[];P(a),a.length>0&&v(a[0])}).catch(()=>{})},[l]),r.useEffect(()=>{_.get(`/workouts/${l}/sets`).then(t=>{var a;b(((a=t.data)==null?void 0:a.sets)||[])}).catch(()=>{})},[l]),r.useEffect(()=>{_.get("/runs").then(t=>{var c;const a=(((c=t.data)==null?void 0:c.runs)||[])[0];a!=null&&a.avg_heart_rate&&X({bpm:a.avg_heart_rate,ts:a.created_at||a.date})}).catch(()=>{})},[]),r.useEffect(()=>{if(o.length>0){const t=o[0];n({name:t.name}),f(String(t.reps||""))}},[]),r.useEffect(()=>($&&C>0?M.current=setTimeout(()=>F(t=>t-1),1e3):$&&C===0&&(H(!1),le()),()=>clearTimeout(M.current)),[$,C]);const G=t=>{clearTimeout(M.current),F(t),H(!0)},Y=async()=>{if(!(!(m!=null&&m.name)||!p||!k))try{const t=await _.post(`/workouts/${l}/sets`,{exercise_name:m.name,muscle_group:h,reps:Number(p),weight_lbs:Number(k),set_number:w});b(i=>[...i,t.data.set]);const a=w+1;A(a),f(""),R(""),G(90);const c=o[N];if(c&&a>Number(c.sets)){const i=N+1;if(i<o.length){const J=o[i];L(i),n({name:J.name}),f(String(J.reps||"")),R(""),A(1)}}}catch{}},Z=async()=>{O(!0),clearInterval(T.current);try{await _.put(`/workouts/${l}/end`,{}),u(`/workout/summary/${l}`)}catch{O(!1)}},I=(m==null?void 0:m.name)||"",z=[...s].reverse().find(t=>t.exercise_name===I),V=s.filter(t=>t.exercise_name===I);return e.jsxs("div",{className:"space-y-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Workout Time"}),e.jsx("p",{className:"text-3xl font-bold tabular-nums",style:{color:"var(--accent)"},children:K(d)}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:W?`HR: ${W.bpm} bpm · ${Math.max(1,Math.round((Date.now()-new Date(W.ts).getTime())/6e4))} min ago`:"No watch data yet — sync your watch to unlock this"})]}),e.jsx("button",{onClick:Z,disabled:q,className:"rounded-xl px-5 py-3 font-bold text-sm",style:{background:"rgba(239,68,68,0.15)",color:"#ef4444",border:"1px solid rgba(239,68,68,0.3)"},children:q?"Ending...":"End Workout"})]}),o.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[g&&e.jsx("p",{className:"text-xs font-bold mb-3 uppercase tracking-widest",style:{color:"var(--accent)"},children:g}),e.jsx("div",{className:"space-y-2",children:o.map((t,a)=>{const c=a===N,i=a<N;return e.jsxs("div",{className:"flex items-center gap-3 rounded-xl px-3 py-2",style:{background:c?"rgba(234,179,8,0.08)":"transparent",borderLeft:c?"3px solid var(--accent)":"3px solid transparent",opacity:i?.4:1},children:[e.jsx("span",{className:"flex-1 text-sm font-semibold",style:{color:c?"var(--accent)":"var(--text-primary)",textDecoration:i?"line-through":"none"},children:t.name}),e.jsxs("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:[t.sets,"x",t.reps]}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:t.rest})]},a)})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>U(t=>!t),className:"rounded-full px-3 py-1.5 text-xs font-medium border transition-all",style:S?{background:"var(--accent-dim)",borderColor:"var(--accent)",color:"var(--accent)"}:{background:"var(--bg-card)",borderColor:"var(--border-subtle)",color:"var(--text-muted)"},children:"Rest Timer"})}),S&&e.jsxs("div",{className:"rounded-xl p-3 space-y-2",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-muted)"},children:"Rest Timer"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:ae.map(t=>e.jsx("button",{onClick:()=>G(t),className:"rounded-lg px-3 py-1.5 text-xs font-semibold border",style:$&&C===t?{background:"var(--accent)",color:"black",borderColor:"var(--accent)"}:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",color:"var(--text-muted)"},children:t<60?`${t}s`:`${t/60}m`},t))}),C>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-bold tabular-nums",style:{color:C<=5?"#ef4444":"var(--text-primary)"},children:K(C)}),e.jsx("button",{onClick:()=>H(t=>!t),className:"rounded-lg px-3 py-1 text-xs font-semibold",style:{background:"var(--accent)",color:"black"},children:$?"Pause":"Resume"})]})]}),j.length>0&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:j.map(t=>e.jsx("button",{onClick:()=>{v(t),n(null),A(1)},className:"rounded-full px-4 py-1.5 text-sm capitalize font-medium whitespace-nowrap border flex-shrink-0",style:h===t?{background:"var(--accent)",borderColor:"var(--accent)",color:"black"}:{background:"var(--bg-card)",borderColor:"var(--border-subtle)",color:"var(--text-muted)"},children:t},t))}),e.jsxs("div",{className:"rounded-2xl p-4 space-y-3",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-base",style:{color:"var(--accent)"},children:["Current: ",I||"None selected"]}),e.jsx("button",{onClick:()=>E(!0),className:"text-xs",style:{color:"var(--text-muted)"},children:I?"Change Exercise":"Choose Exercise"})]}),D&&e.jsx(re,{muscleGroup:h,onSelect:t=>{n(t),A(1),E(!1)},onClose:()=>E(!1)}),z&&e.jsx("div",{className:"rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},children:e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:["Last set: ",e.jsxs("span",{className:"font-bold",style:{color:"var(--text-primary)"},children:[z.reps," reps @ ",z.weight_lbs," lbs"]})]})}),V.length>0&&e.jsx("div",{className:"space-y-1",children:V.map((t,a)=>e.jsxs("div",{className:"flex gap-3 text-sm",style:{color:"var(--text-muted)"},children:[e.jsxs("span",{children:["Set ",a+1]}),e.jsxs("span",{children:[t.reps," reps"]}),e.jsxs("span",{children:[t.weight_lbs," lbs"]})]},t.id))}),I&&e.jsxs("div",{className:"flex gap-3 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Reps"}),e.jsx("input",{type:"number",min:"1",placeholder:"0",value:p,onChange:t=>f(t.target.value),className:"w-full rounded-xl px-3 py-3 text-center text-xl font-bold border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",color:"var(--text-primary)"}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Weight (lbs)"}),e.jsx("input",{type:"number",min:"0",step:"2.5",placeholder:"0",value:k,onChange:t=>R(t.target.value),className:"w-full rounded-xl px-3 py-3 text-center text-xl font-bold border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",color:"var(--text-primary)"}})]}),e.jsxs("button",{onClick:Y,disabled:!p||!k,className:"rounded-xl px-4 py-3 font-bold text-sm disabled:opacity-40",style:{background:"var(--accent)",color:"black"},children:["+ Set ",w]})]})]}),s.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("p",{className:"text-xs font-medium mb-3",style:{color:"var(--text-muted)"},children:["Sets logged — ",s.length," total"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(s.reduce((t,a)=>(t[a.exercise_name]||(t[a.exercise_name]=[]),t[a.exercise_name].push(a),t),{})).map(([t,a])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:t}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:a.map((c,i)=>e.jsxs("span",{className:"text-xs px-2 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:[i+1,": ",c.reps,"×",c.weight_lbs]},c.id))})]},t))})]})]})}export{oe as default};
