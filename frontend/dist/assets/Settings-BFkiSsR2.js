import{b as U,u as B,c as F,r as y,a as R,j as i}from"./index-DlECNy7h.js";import{C as G}from"./chevron-right-DsY4wMV3.js";const T=.621371,K=621371e-9;function M(n){const t=[];let e="",a=!1;for(let o=0;o<n.length;o+=1){const r=n[o],c=n[o+1];if(r==='"'&&a&&c==='"'){e+='"',o+=1;continue}if(r==='"'){a=!a;continue}if(r===","&&!a){t.push(e.trim()),e="";continue}e+=r}return t.push(e.trim()),t}function W(n){const t=String(n||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(a=>a.trim().length>0);if(!t.length)return[];const e=M(t[0]).map(a=>a.trim());return t.slice(1).map(a=>{const o=M(a),r={};return e.forEach((c,d)=>{r[c]=o[d]??""}),r})}function A(n){if(n==null)return null;const t=String(n).replace(/[^0-9.+-]/g,"");if(!t)return null;const e=Number(t);return Number.isFinite(e)?e:null}function N(n){var r,c,d;if(n==null)return 0;const t=String(n).trim();if(!t)return 0;if(/^\d+$/.test(t))return Number(t);if(/^\d+:\d{1,2}(:\d{1,2})?$/.test(t)){const l=t.split(":").map(m=>Number(m));if(l.length===2)return l[0]*60+l[1];if(l.length===3)return l[0]*3600+l[1]*60+l[2]}const e=(r=/(\d+)\s*h/i.exec(t))==null?void 0:r[1],a=(c=/(\d+)\s*m/i.exec(t))==null?void 0:c[1],o=(d=/(\d+)\s*s/i.exec(t))==null?void 0:d[1];return e||a||o?Number(e||0)*3600+Number(a||0)*60+Number(o||0):0}function z(n){if(!n)return null;const t=new Date(n);return Number.isNaN(t.getTime())?null:t.toISOString().slice(0,10)}function H(n){const t=String(n||"").toLowerCase();return!t||t.includes("run")||t.includes("jog")||t.includes("walk")?"run":t.includes("strength")||t.includes("lift")||t.includes("weight")?"strength":t}function P(n,t="miles"){if(!n)return 0;const e=String(n).toLowerCase(),a=A(e);return a?e.includes("km")?a*T:e.includes("m ")||e.endsWith("m")?a*K:e.includes("mi")?a:t==="km"?a*T:a:0}function V(n){return W(n).map(e=>{const a=z(e.date||e.Date||e["Start Time"]||e.start_time),o=A(e.distance||e["distance (km)"]||e["Distance (km)"]||e.Distance),r=N(e.duration||e.Duration||e["Elapsed Time"]||e.elapsed_time),c=A(e.avg_heart_rate||e["Average Heart Rate"]||e["Avg Heart Rate"]),d=H(e.type||e.Type||e.activity_type||e["Activity Type"]);return{date:a,type:d,distanceMiles:Number(((o||0)*T).toFixed(3)),durationSeconds:r,avgHeartRate:c||null,source:"garmin_csv"}}).filter(e=>e.date&&(e.distanceMiles>0||e.durationSeconds>0))}function J(n){return W(n).map(e=>{const a=z(e["Activity Date"]||e.date||e.Date),o=H(e["Activity Type"]||e.type||e.Type),r=P(e.Distance||e.distance,"miles"),c=N(e["Elapsed Time"]||e.duration||e.Duration),d=A(e["Average Heart Rate"]||e.avg_heart_rate||e["Avg Heart Rate"]);return{date:a,type:o,distanceMiles:Number(r.toFixed(3)),durationSeconds:c,avgHeartRate:d||null,source:"strava_csv"}}).filter(e=>e.date&&(e.distanceMiles>0||e.durationSeconds>0))}async function Q(n,t){if(typeof n.requestAuthorization=="function")return n.requestAuthorization({read:t});if(typeof n.requestPermissions=="function")return n.requestPermissions({read:t});if(typeof n.requestPermission=="function")return n.requestPermission(t);throw new Error("Apple Health permissions API not available in this Safari version.")}async function Y(n,t,e){if(typeof n.queryWorkouts=="function")return n.queryWorkouts({startDate:t,endDate:e});if(typeof n.getWorkouts=="function")return n.getWorkouts({startDate:t,endDate:e});if(typeof n.readWorkouts=="function")return n.readWorkouts({startDate:t,endDate:e});if(typeof n.querySamples=="function"){const a=await n.querySamples({type:"workout",startDate:t,endDate:e});return(a==null?void 0:a.samples)||a||[]}throw new Error("Apple Health workout query API is not available.")}async function X(){if(typeof navigator>"u"||!navigator.health)throw new Error("Apple Health import is only supported in Safari on iOS 16+.");const n=navigator.health,t=new Date,e=new Date(t.getTime()-30*24*60*60*1e3);await Q(n,["steps","distance","heartRate","workouts"]);const o=await Y(n,e,t);return(Array.isArray(o)?o:[]).map(r=>{const c=H(r.activityType||r.type||r.workoutActivityType),d=Number(P(r.distanceMiles||r.distance||r.totalDistance||r.distance_miles||0,r.distanceUnit==="km"?"km":"miles").toFixed(3)),l=N(r.durationSeconds||r.duration||r.elapsedTime||r.elapsed_time||0),m=A(r.avgHeartRate||r.averageHeartRate||r.avg_heart_rate||null);return{date:z(r.startDate||r.date||r.start||r.endDate)||new Date().toISOString().slice(0,10),type:c,distanceMiles:d,durationSeconds:l,avgHeartRate:m||null,source:"apple_health",raw:r}}).filter(r=>r.distanceMiles>0||r.durationSeconds>0)}const Z=[{code:"en",name:"English",flag:"ðŸ‡ºðŸ‡¸"},{code:"es",name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},{code:"pt-BR",name:"PortuguÃªs (BR)",flag:"ðŸ‡§ðŸ‡·"},{code:"de",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},{code:"ja",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"}],w=.621371;function ee(n){const t=String(n||"").trim();if(!t)return 0;if(/^\d+$/.test(t))return Number(t);if(/^\d+:\d{1,2}(:\d{1,2})?$/.test(t)){const e=t.split(":").map(Number);if(e.length===2)return e[0]*60+e[1];if(e.length===3)return e[0]*3600+e[1]*60+e[2]}return 0}function te(n){const t=new Date(n);return Number.isNaN(t.getTime())?null:t.toISOString().slice(0,10)}function ne(n){return(Array.isArray(n)?n:Array.isArray(n==null?void 0:n.workouts)?n.workouts:[]).map(e=>{const a=te(e.date||e.startDate||e["Activity Date"]),o=e.type||e.activityType||e["Activity Type"]||"run",r=String(e.unit||e.distanceUnit||"").toLowerCase(),c=Number(e.distance||e.distance_km||e.distanceKm||e.distanceMiles||0),d=e.distanceMiles?Number(e.distanceMiles):Number((c*(r==="km"||e.distance_km||e.distanceKm?w:1)).toFixed(3)),l=Number(e.durationSeconds||e.duration_seconds||ee(e.duration||e["Elapsed Time"])||0),m=Number(e.avgHeartRate||e.avg_heart_rate||e["Average Heart Rate"]||0)||null;return{date:a,type:o,distanceMiles:d,durationSeconds:l,avgHeartRate:m,source:"manual_json"}}).filter(e=>e.date&&(e.distanceMiles>0||e.durationSeconds>0))}function ae(){const n=U(),{t,i18n:e}=B(),{units:a,setUnits:o}=F(),[r,c]=y.useState("miles"),[d,l]=y.useState(!1),[m,_]=y.useState(!1),[C,D]=y.useState(""),[x,f]=y.useState(null),I=y.useRef(null),b=typeof navigator<"u"&&/iP(ad|hone|od)/.test(navigator.userAgent)&&/WebKit/.test(navigator.userAgent)&&typeof navigator<"u"&&!!navigator.health;y.useEffect(()=>{R.get("/users/settings").then(s=>{c(s.data.distance_unit||"miles")}).catch(()=>{})},[]),y.useEffect(()=>{if(!x)return;const s=setTimeout(()=>f(null),5e3);return()=>clearTimeout(s)},[x]);const O=async s=>{c(s),await R.put("/users/settings",{distance_unit:s}).catch(()=>{}),l(!0),setTimeout(()=>l(!1),2e3)},q=async s=>{await o(s),l(!0),setTimeout(()=>l(!1),2e3)},E=async(s,p)=>{var S,g;if(!p.length){f({ok:!1,text:"No workouts found in that export."});return}_(!0),D(`Importing ${p.length} workouts...`);try{const{data:u}=await R.post(s,{workouts:p}),j=Number((u==null?void 0:u.imported)||0),k=Number((u==null?void 0:u.skipped)||0);f({ok:!0,text:`âœ… ${j} workouts imported, ${k} skipped (already existed)`})}catch(u){f({ok:!1,text:((g=(S=u==null?void 0:u.response)==null?void 0:S.data)==null?void 0:g.error)||"Import failed. Please try another file."})}finally{D(""),_(!1)}},$=async()=>{if(!b){f({ok:!1,text:"Apple Health import is only supported on iOS Safari with Web Health API access."});return}try{const s=await X();await E("/import/health",s)}catch(s){f({ok:!1,text:(s==null?void 0:s.message)||"Unable to connect to Apple Health on this device."})}},L=async s=>{var S;const p=(S=s.target.files)==null?void 0:S[0];if(s.target.value="",!!p)try{const g=await p.text(),u=p.name.toLowerCase();let j=[];if(u.endsWith(".csv")){const k=g.split(/\r?\n/)[0]||"";j=/Activity Date|Activity Type|Elapsed Time/i.test(k)?J(g):V(g)}else if(u.endsWith(".json"))j=ne(JSON.parse(g));else{f({ok:!1,text:"Unsupported file type. Please upload CSV or JSON."});return}await E("/import/workouts",j)}catch{f({ok:!1,text:"Could not parse file. Expected Garmin/Strava CSV or workout JSON."})}},h={background:"var(--bg-card)",borderRadius:16,padding:"20px",marginBottom:16,border:"1px solid var(--border-subtle)"},v={fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:"var(--text-muted)",marginBottom:12,display:"block"};return i.jsxs("div",{children:[i.jsx("h1",{style:{fontWeight:900,fontSize:24,color:"var(--text-primary)",marginBottom:24},children:t("settings.title")}),i.jsxs("div",{style:h,children:[i.jsx("span",{style:v,children:t("settings.language")}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:10},children:Z.map(s=>i.jsxs("button",{onClick:()=>e.changeLanguage(s.code),style:{display:"flex",alignItems:"center",gap:8,padding:"12px 14px",borderRadius:12,border:`2px solid ${e.language===s.code?"#EAB308":"var(--border-subtle)"}`,background:e.language===s.code?"rgba(234, 179, 8, 0.15)":"var(--bg-input)",color:"var(--text-primary)",fontWeight:600,fontSize:14,cursor:"pointer",textAlign:"left"},children:[i.jsx("span",{style:{fontSize:18},children:s.flag}),i.jsx("span",{children:s.name})]},s.code))})]}),i.jsxs("div",{style:h,children:[i.jsx("span",{style:v,children:t("settings.units")}),i.jsx("div",{style:{display:"flex",gap:10},children:[["imperial",t("settings.imperial")],["metric",t("settings.metric")]].map(([s,p])=>i.jsx("button",{onClick:()=>q(s),style:{flex:1,padding:"14px",borderRadius:12,border:`2px solid ${a===s?"var(--accent)":"var(--border-subtle)"}`,background:a===s?"var(--accent-dim)":"var(--bg-input)",color:a===s?"var(--accent)":"var(--text-muted)",fontWeight:700,fontSize:14,cursor:"pointer"},children:p},s))}),i.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:10},children:a==="imperial"?"Miles, lbs, Â°F":"Kilometers, kg, Â°C"}),d&&i.jsx("p",{style:{fontSize:12,color:"#22c55e",marginTop:10},children:"Saved"})]}),i.jsxs("div",{style:h,children:[i.jsx("span",{style:v,children:"Distance Units (Legacy)"}),i.jsx("div",{style:{display:"flex",gap:10},children:[["miles","Miles"],["km","Kilometers"]].map(([s,p])=>i.jsx("button",{onClick:()=>O(s),style:{flex:1,padding:"14px",borderRadius:12,border:`2px solid ${r===s?"var(--accent)":"var(--border-subtle)"}`,background:r===s?"var(--accent-dim)":"var(--bg-input)",color:r===s?"var(--accent)":"var(--text-muted)",fontWeight:700,fontSize:14,cursor:"pointer"},children:p},s))}),d&&i.jsx("p",{style:{fontSize:12,color:"#22c55e",marginTop:10},children:"Saved"})]}),i.jsxs("div",{style:h,children:[i.jsx("span",{style:v,children:"Account"}),i.jsxs("button",{onClick:()=>n("/profile"),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",background:"none",border:"none",cursor:"pointer",padding:0},children:[i.jsx("span",{style:{fontSize:15,fontWeight:600,color:"var(--text-primary)"},children:t("profile.editProfile")}),i.jsx(G,{size:18,style:{color:"var(--text-muted)"}})]})]}),i.jsxs("div",{style:h,children:[i.jsx("span",{style:v,children:"Notifications"}),i.jsx("p",{style:{fontSize:14,color:"var(--text-muted)"},children:"Push notifications â€” coming soon."})]}),i.jsxs("div",{style:h,children:[i.jsx("span",{style:v,children:"Connect / Import Data"}),i.jsxs("div",{style:{border:"1px solid var(--border-subtle)",borderRadius:12,padding:14,marginBottom:12},children:[i.jsx("p",{style:{margin:0,fontSize:14,fontWeight:700,color:"var(--text-primary)"},children:"Import from Apple Health"}),i.jsx("p",{style:{margin:"8px 0 10px",fontSize:12,color:"var(--text-muted)"},children:"iOS Safari only. Requests access to steps, distance, heart rate, and workouts from the last 30 days."}),i.jsx("button",{onClick:$,disabled:m||!b,style:{width:"100%",border:"1px solid var(--border-subtle)",borderRadius:10,padding:"10px 12px",fontSize:13,fontWeight:700,background:b?"var(--bg-input)":"rgba(148,163,184,0.1)",color:b?"var(--text-primary)":"var(--text-muted)",cursor:b?"pointer":"not-allowed"},children:b?"Import from Apple Health":"Apple Health unavailable on this browser"})]}),i.jsxs("div",{style:{border:"1px solid var(--border-subtle)",borderRadius:12,padding:14},children:[i.jsx("p",{style:{margin:0,fontSize:14,fontWeight:700,color:"var(--text-primary)"},children:"Import from Garmin/Strava CSV"}),i.jsx("p",{style:{margin:"8px 0 10px",fontSize:12,color:"var(--text-muted)"},children:"Export your Garmin data as CSV â†’ upload here"}),i.jsx("input",{ref:I,type:"file",accept:".csv,.json",onChange:L,style:{display:"none"}}),i.jsx("button",{onClick:()=>{var s;return(s=I.current)==null?void 0:s.click()},disabled:m,style:{width:"100%",border:"1px solid var(--border-subtle)",borderRadius:10,padding:"10px 12px",fontSize:13,fontWeight:700,background:"var(--bg-input)",color:"var(--text-primary)",cursor:"pointer"},children:"Import from Garmin/Strava CSV"})]}),C&&i.jsx("p",{style:{fontSize:12,marginTop:10,color:"var(--text-muted)"},children:C})]}),i.jsxs("div",{style:h,children:[i.jsx("span",{style:v,children:"Data & Privacy"}),i.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",lineHeight:1.6},children:"Your data lives on FORGE servers. We never sell your information."})]}),x&&i.jsx("div",{style:{background:x.ok?"rgba(34,197,94,0.15)":"rgba(239,68,68,0.12)",border:`1px solid ${x.ok?"rgba(34,197,94,0.35)":"rgba(239,68,68,0.35)"}`,color:x.ok?"#86efac":"#fca5a5",borderRadius:12,padding:"10px 12px",fontSize:13,marginBottom:16},children:x.text}),i.jsx("p",{style:{textAlign:"center",fontSize:12,color:"var(--text-muted)",opacity:.5,marginTop:24},children:"FORGE v1.0 Â· Built to adapt."})]})}export{ae as default};
