import{b as mt,c as pt,u as ht,r as a,a as x,j as e,R as ve}from"./index-DPvCFa56.js";import{A as yt}from"./AchievementUnlock-DhNFZIHY.js";import{L as gt}from"./LoadingRunner-B4Gs0_Nn.js";import{X as je}from"./x-D4VZuQN9.js";import{F as ft}from"./flame-DTygbOdz.js";import{F as bt}from"./footprints-COhZ2vGV.js";import{A as vt,a as jt}from"./arrow-up-right-qRADT5jN.js";import{T as kt}from"./triangle-alert-CmNIuAk_.js";import{W as St}from"./watch-DHBzgyMW.js";function ke(s){if(!s)return"0 min";const r=Math.floor(s/3600),o=Math.floor(s%3600/60);return r>0?o>0?`${r}h ${o}min`:`${r}h`:`${o} min`}function Nt(s){if(!s)return"0m";const r=Math.floor(s/3600),o=Math.floor(s%3600/60);return r>0?`${r}h ${o}m`:`${o}m`}function ee(s,r=900){const[o,l]=ve.useState(0);return ve.useEffect(()=>{if(!s){l(0);return}let g=0;const f=s/(r/16),u=setInterval(()=>{g+=f,g>=s?(l(s),clearInterval(u)):l(Math.floor(g))},16);return()=>clearInterval(u)},[s,r]),o}function wt({data:s=[]}){if(!s.length)return null;const r=Math.max(...s.map(u=>u.miles),1),o=100,l=40,g=s.map((u,b)=>{const m=b/(s.length-1)*o,w=l-u.miles/r*l;return`${m},${w}`}).join(" "),f=`0,${l} `+g+` ${o},${l}`;return e.jsxs("svg",{viewBox:`0 0 ${o} ${l}`,className:"w-full h-16",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trendGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--accent)",stopOpacity:"0.4"}),e.jsx("stop",{offset:"100%",stopColor:"var(--accent)",stopOpacity:"0"})]})}),e.jsx("polygon",{points:f,fill:"url(#trendGrad)"}),e.jsx("polyline",{points:g,fill:"none",stroke:"var(--accent)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),s.map((u,b)=>{const m=b/(s.length-1)*o,w=l-u.miles/r*l;return u.miles>0?e.jsx("circle",{cx:m,cy:w,r:"1.5",fill:"var(--accent)"},b):null})]})}function _t({score:s,onClick:r}){const f=2*Math.PI*28,u=s/100*f,b=s>=75?"#22c55e":s>=50?"var(--accent)":"#ef4444",m=s>=80?"Optimal":s>=60?"Good":s>=40?"Moderate":"Low";return e.jsxs("div",{onClick:r,style:{cursor:"pointer"},className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 72 72",children:[e.jsx("circle",{cx:36,cy:36,r:28,fill:"none",stroke:"var(--border-subtle)",strokeWidth:"5"}),e.jsx("circle",{cx:36,cy:36,r:28,fill:"none",stroke:b,strokeWidth:"5",strokeDasharray:`${u} ${f}`,strokeLinecap:"round",transform:"rotate(-90 36 36)"}),e.jsx("text",{x:36,y:37,textAnchor:"middle",dominantBaseline:"middle",fontSize:"13",fontWeight:"bold",fill:b,children:s})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-base",style:{color:"var(--text-primary)"},children:m}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:"Training readiness"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)",opacity:.7},children:s>=75?"Go hard today.":s>=50?"Moderate effort.":"Take it easy today."})]})]}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)",opacity:.6},children:"Tap to see breakdown"})]})}function Se(){const s=new Date,r=new Date(Date.UTC(s.getFullYear(),0,1)),o=Math.floor((s-r)/864e5),l=Math.ceil((o+r.getUTCDay()+1)/7);return`${s.getFullYear()}-${String(l).padStart(2,"0")}`}function Rt({onSyncPayload:s}){const[r,o]=a.useState(null),[l,g]=a.useState(!1),[f,u]=a.useState(!1);a.useEffect(()=>{const w=localStorage.getItem("forge_token");if(!w)return;const L=v=>{o(_=>(v&&_&&v.synced_at!==(_==null?void 0:_.synced_at)&&(u(!0),setTimeout(()=>u(!1),3e3)),v)),s==null||s(v)};fetch("/api/watch-sync/status",{headers:{Authorization:`Bearer ${w}`}}).then(v=>v.ok?v.json():null).then(L).catch(()=>{});const U=setInterval(()=>{fetch("/api/watch-sync/status",{headers:{Authorization:`Bearer ${w}`}}).then(v=>v.ok?v.json():null).then(L).catch(()=>{})},1e4);return()=>clearInterval(U)},[s]);const b=(r==null?void 0:r.treadmill_brand)||(r==null?void 0:r.watch_mode)||null,m=r&&(r.avg_heart_rate||r.distance_miles);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("style",{children:`
        @keyframes watchPulse { 0%,100% { box-shadow: 0 0 0 0 rgba(234,179,8,0.4); } 50% { box-shadow: 0 0 0 8px rgba(234,179,8,0); } }
        @keyframes syncFlash { 0% { background: rgba(34,197,94,0.3); } 100% { background: transparent; } }
      `}),e.jsxs("button",{onClick:()=>{g(!0),setTimeout(()=>g(!1),1500)},style:{display:"flex",alignItems:"center",gap:6,background:m?"rgba(234,179,8,0.1)":"var(--bg-input)",border:`1px solid ${m?"rgba(234,179,8,0.4)":"var(--border-subtle)"}`,borderRadius:10,padding:"6px 12px",cursor:"pointer",animation:l?"watchPulse 1s ease-in-out infinite":"none",transition:"all 0.3s ease",...f?{animation:"syncFlash 1s ease forwards"}:{}},children:[e.jsx(St,{size:14,color:m?"#EAB308":"var(--text-muted)"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("p",{style:{fontSize:9,color:"var(--text-muted)",margin:0,letterSpacing:.5,textTransform:"uppercase"},children:b||"Watch"}),e.jsx("p",{style:{fontSize:11,fontWeight:700,color:m?"#EAB308":"var(--text-muted)",margin:0},children:f?"Synced!":m?`HR ${r.avg_heart_rate||"--"} bpm`:"No data"})]}),m&&e.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:"#22c55e",animation:"watchPulse 2s ease infinite"}})]}),e.jsx("p",{style:{fontSize:9,color:"var(--text-muted)",textAlign:"center",marginTop:2},children:"+ Meta Glasses (soon)"})]})}function Gt(){var E,pe,he,ye;const s=mt(),{fmt:r}=pt(),{t:o}=ht(),[l,g]=a.useState(null),[f,u]=a.useState([]),[b,m]=a.useState([]),[w,L]=a.useState(!1),[U,v]=a.useState(!0),[_,Ne]=a.useState("week"),[H,we]=a.useState(!1),[te,_e]=a.useState(!1),[se,Re]=a.useState("auto"),[P,Ce]=a.useState(null),[Ct,Tt]=a.useState(!1),[Dt,$t]=a.useState(""),[Te,Y]=a.useState(!1),[i,O]=a.useState(null),[h,ae]=a.useState(null),[re,De]=a.useState([]),[$e,ze]=a.useState({currentStreak:0,bestStreak:0}),[le,ne]=a.useState([]),[oe,ie]=a.useState(null),[j,We]=a.useState(null),[ce,Me]=a.useState(!1),[R,Ae]=a.useState(null),[V,Le]=a.useState(null),[Ie,Be]=a.useState(Number(localStorage.getItem("forge_load_warning_dismissed_until")||0)),[Ee,Fe]=a.useState([]),[Ge,Ue]=a.useState(0),[T,He]=a.useState(null),[de,K]=a.useState(null),[Pe,J]=a.useState("manual"),[C,Ye]=a.useState(null),[Oe,ue]=a.useState(!1),[I,Ve]=a.useState(null),[Ke,xe]=a.useState(!1);a.useEffect(()=>{(async()=>{var t,n,c,p,d,k,N,M,D,z,S,A,$;try{const[Q,X,q,at,F,Z,rt,lt,nt,ot,it,ct,dt]=await Promise.all([x.get("/auth/me/stats"),x.get("/runs",{params:{limit:5}}),x.get("/lifts"),x.get("/coach/warning"),x.get("/checkin/today").catch(()=>({data:null})),x.get("/users/goal").catch(()=>({data:null})),x.get("/auth/me/streak").catch(()=>({data:{currentStreak:0,bestStreak:0}})),x.get("/milestones/new").catch(()=>({data:{milestones:[]}})),x.get("/plans/compliance").catch(()=>({data:null})),x.get("/runs/load-analysis").catch(()=>({data:null})),x.get("/races/next").catch(()=>({data:{race:null}})),x.get("/gear/shoes").catch(()=>({data:{shoes:[]}})),x.get("/injury/active").catch(()=>({data:{injuries:[]}}))]);g(Q.data);const ge=Array.isArray(X.data)?X.data:((t=X.data)==null?void 0:t.runs)||[];u(ge),_e(ge.some(y=>y.avg_heart_rate||y.watch_mode||y.route_coords)),m(Array.isArray(q.data)?q.data:((n=q.data)==null?void 0:n.lifts)||[]),L(((c=at.data)==null?void 0:c.warning)===!0);const fe=((p=F.data)==null?void 0:p.step_count)??((d=F.data)==null?void 0:d.steps);if(Number.isFinite(Number(fe)))K(Number(fe)),J("manual");else{const y=((N=(k=Q.data)==null?void 0:k.day)==null?void 0:N.steps)??((D=(M=Q.data)==null?void 0:M.today)==null?void 0:D.steps);Number.isFinite(Number(y))&&(K(Number(y)),J("manual"))}F.data&&(we(!0),He(F.data)),Z.data&&(Re(Z.data.mode||"auto"),Ce(Z.data.miles||null)),ze(rt.data||{currentStreak:0,bestStreak:0});const G=((z=lt.data)==null?void 0:z.milestones)||[];ne(G),G.length>0&&ie(y=>y||{name:G[0].title,description:G[0].description,icon:"Award",color:"#EAB308"}),We(nt.data),Ae(ot.data),Le(((S=it.data)==null?void 0:S.race)||null),Fe((((A=ct.data)==null?void 0:A.shoes)||[]).filter(y=>Number(y.total_miles||0)>450)),Ye(((($=dt.data)==null?void 0:$.injuries)||[])[0]||null),x.get("/recap/weekly").then(y=>{var be;Ue(((be=y.data)==null?void 0:be.totalCalories)||0);const ut=new Date().getDay()===0,xt=`recap-seen-${Se()}`;ut&&localStorage.getItem(xt)!=="1"&&(Ve(y.data||null),xe(!0))}).catch(()=>{})}finally{v(!1)}})()},[]),a.useEffect(()=>{const t=localStorage.getItem("forge_last_watch_sync_seen_at")||"1970-01-01T00:00:00";x.get("/watch-sync/recent",{params:{since:t}}).then(n=>{var p;const c=((p=n.data)==null?void 0:p.items)||[];c.length&&(De(c.filter(d=>d.routed_section==="other")),ae(c[0]))}).catch(()=>{})},[]),a.useEffect(()=>{ue(!1)},[C==null?void 0:C.id]);const{readiness:W,readinessBreakdown:Je}=a.useMemo(()=>{var A;if(!l||!H||!te)return{readiness:null,readinessBreakdown:[]};const{streak:t,week:n,all:c}=l;let p=50;const d=[];d.push({label:"Base score",value:50,delta:0,reason:"Starting point for all athletes."});const k=Math.min(t*4,20);p+=k,d.push({label:"Consistency streak",value:k,delta:k,reason:t>0?`${t}-day active streak adds +${k} pts. Staying consistent pays off.`:"No active streak. Logging runs builds your streak bonus."});const N=c.miles/Math.max((A=l.weeklyTrend)==null?void 0:A.filter($=>$.miles>0).length,1),M=N>0?n.miles/N:0;let D=0,z="";M<.5?(D=15,z=`This week you ran ${r.distance(n.miles,1)} vs your avg ${r.distance(N,1)} — low volume means your legs are fresh.`):M>1.3?(D=-15,z=`This week you ran ${r.distance(n.miles,1)} vs your avg ${r.distance(N,1)} — high volume week, body needs recovery.`):z=`This week (${r.distance(n.miles,1)}) is on par with your average (${r.distance(N,1)}) — balanced load.`,p+=D,d.push({label:"Weekly load",value:D,delta:D,reason:z});const S=Number((T==null?void 0:T.sleep_hours)||0);if(S>0){const $=S<6?-12:S>=8?5:0;p+=$,d.push({label:"Sleep",value:$,delta:$,reason:S<6?`${S}h sleep lowers readiness today.`:S>=8?`${S}h sleep boosts recovery readiness.`:`${S}h sleep is neutral for readiness.`})}return{readiness:Math.max(1,Math.min(99,Math.round(p))),readinessBreakdown:d}},[l,H,te,T,r]);a.useMemo(()=>{var p;if(!l)return null;const t=((p=l.month)==null?void 0:p.miles)||0;let n;se==="manual"&&P?n=P:n=Math.max(25,Math.ceil(t/25)*25+(t>=25?25:0));const c=Math.min(t/n*100,100);return{miles:t,goal:n,pct:c}},[l,se,P]);const B=(l==null?void 0:l[_])||{},Qe=ee(Math.round((B.miles||0)*10),900),Xe=ee(B.count||0,900);ee($e.currentStreak||0,900);const me=a.useMemo(()=>{const t=f.slice(0,3).map(d=>({...d,_type:"run"})),n=(b||[]).slice(0,3).map(d=>({...d,_type:"lift"})),c=(re||[]).slice(0,3).map(d=>({...d,_type:"other"}));return[...t,...n,...c].sort((d,k)=>{const N=d.date||d.started_at||d.created_at||"";return(k.date||k.started_at||k.created_at||"").localeCompare(N)}).slice(0,4)},[f,b,re]),qe=R&&["elevated","high","danger"].includes(R.loadStatus)&&Date.now()>Ie,Ze=(j==null?void 0:j.score)>=80?"#22c55e":(j==null?void 0:j.score)>=50?"#EAB308":"#ef4444",et={day:"Today",week:o("dashboard.thisWeek"),month:"This Month",year:"This Year",all:"All Time"},tt=Oe||C&&localStorage.getItem(`forge-injury-dismissed-${C.id}`)==="1",st=a.useCallback(t=>{if(!t)return;const n=t.step_count??t.steps,c=Number(n);Number.isFinite(c)&&c>=0&&(K(Math.round(c)),J("watch"))},[]);return U?e.jsx(gt,{message:"Getting ready"}):e.jsxs("div",{className:"space-y-4",children:[oe&&e.jsx(yt,{badge:oe,onDismiss:()=>ie(null)}),e.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        @keyframes ringClose {
          0% { opacity: 1; stroke-dasharray: 157 0; }
          80% { opacity: 1; stroke-dasharray: 157 0; }
          100% { opacity: 0; stroke-dasharray: 157 0; }
        }
      `}),!tt&&C&&e.jsx("div",{className:"rounded-xl p-4",style:{background:"rgba(234,179,8,0.2)",border:"1px solid #EAB308"},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold",style:{color:"#0f1117"},children:["Recovery Mode — ",C.body_part||"Injury"," — Est. return: ",C.date||"--"]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#0f1117"},children:"Your plan has been adjusted for recovery. Focus on PT and low-impact activity."})]}),e.jsx("button",{onClick:()=>{localStorage.setItem(`forge-injury-dismissed-${C.id}`,"1"),ue(!0)},className:"rounded-md p-1",style:{background:"transparent",color:"#0f1117"},"aria-label":"Dismiss injury warning",children:e.jsx(je,{size:16})})]})}),Ke&&I&&e.jsx("div",{className:"rounded-xl p-4",style:{background:"#1a1d2e",border:"1px solid #2a2d3e"},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",style:{color:"#EAB308"},children:"Weekly Recap"}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:[((pe=(E=I.totalMiles)==null?void 0:E.toFixed)==null?void 0:pe.call(E,1))||0," mi · ",I.totalRuns||0," runs · ",(I.totalCalories||0).toLocaleString()," cal"]})]}),e.jsx("button",{onClick:()=>{localStorage.setItem(`recap-seen-${Se()}`,"1"),xe(!1)},style:{background:"transparent",color:"var(--text-muted)"},className:"p-1","aria-label":"Dismiss weekly recap",children:e.jsx(je,{size:16})})]})}),qe&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:R.loadStatus==="danger"?"rgba(239,68,68,0.12)":R.loadStatus==="high"?"rgba(249,115,22,0.12)":"rgba(234,179,8,0.12)",border:`1px solid ${R.loadStatus==="danger"?"rgba(239,68,68,0.35)":R.loadStatus==="high"?"rgba(249,115,22,0.35)":"rgba(234,179,8,0.35)"}`},children:[e.jsxs("p",{className:"text-xs font-bold uppercase",style:{color:"var(--text-primary)"},children:[R.loadStatus," load"]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-primary)"},children:R.warning||R.recommendation}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},onClick:()=>s("/plan",{state:{suggestEasyDay:!0}}),children:"Take Easy Day"}),e.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},onClick:()=>{const t=Date.now()+864e5;localStorage.setItem("forge_load_warning_dismissed_until",String(t)),Be(t)},children:"OK"})]})]}),V&&(()=>{const t=Math.ceil((new Date(`${V.race_date}T12:00:00`).getTime()-Date.now())/864e5);return t>0&&t<=60?e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Next Race"}),e.jsx("p",{className:"text-base font-bold",style:{color:"var(--text-primary)"},children:V.race_name}),e.jsxs("p",{className:"text-sm",style:{color:"var(--accent)"},children:[t," days to go"]})]}):null})(),j&&e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},onClick:()=>Me(!ce),children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:[o("dashboard.thisWeek"),": ",j.completed,"/",j.planned," sessions — ",j.score,"%"]}),e.jsx("div",{className:"w-full h-2 rounded-full mt-2",style:{background:"var(--bg-input)"},children:e.jsx("div",{className:"h-2 rounded-full",style:{width:`${j.score}%`,background:Ze}})}),ce&&e.jsx("div",{className:"mt-3 space-y-1",children:(j.sessions||[]).map((t,n)=>e.jsxs("p",{className:"text-xs",style:{color:t.completed?"#22c55e":"#ef4444"},children:[t.day,": ",t.type," ",t.completed?"hit":"missed"]},n))})]}),le.length>0&&e.jsx("div",{className:"space-y-2",children:le.map(t=>e.jsxs("div",{className:"rounded-xl p-3 flex items-center justify-between",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:t.title}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:t.description})]}),e.jsx("button",{onClick:()=>ne(n=>n.filter(c=>c.key!==t.key)),className:"text-xs",style:{color:"var(--text-muted)"},children:"Dismiss"})]},t.key))}),!H&&e.jsxs("a",{href:"/checkin",style:{display:"block",background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)",borderRadius:14,padding:"12px 16px",marginBottom:12,textDecoration:"none"},children:[e.jsx("p",{style:{color:"var(--accent)",fontWeight:700,fontSize:14,margin:0},children:"Quick check-in — 3 taps"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:12,margin:"2px 0 0"},children:"Help me adjust today's plan around your day"})]}),h&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:["New activity synced from your watch — ",h.activity_name,". View it in ",h.routed_section==="lift"?"Lift":h.routed_section==="other"?"History":"Run"," tab."]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>{localStorage.setItem("forge_last_watch_sync_seen_at",h.synced_at),h.routed_section==="lift"?s("/log-lift"):h.normalized_type==="treadmill"?s("/run/treadmill",{state:{incline:h.incline_pct,speed:h.belt_speed_mph,durationSeconds:h.duration_seconds,treadmillType:h.treadmill_brand||"Generic",watchMetrics:h}}):s("/log-run")},className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},children:"View"}),e.jsx("button",{onClick:()=>{localStorage.setItem("forge_last_watch_sync_seen_at",h.synced_at),ae(null)},className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},children:"Dismiss"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 flex flex-col items-center",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("h2",{className:"text-2xl font-black mb-1",style:{color:"var(--text-primary)"},children:"Ready to Run?"}),e.jsx("p",{className:"text-sm mb-10 text-center",style:{color:"var(--text-muted)"},children:"Dynamic warm-up reduces injury risk and improves performance."}),e.jsxs("button",{onClick:()=>s("/warmup"),className:"rounded-full w-28 h-28 mb-3 font-black flex flex-col items-center justify-center",style:{background:"var(--accent)",color:"#000",border:"none",cursor:"pointer"},children:[e.jsx(ft,{className:"mb-1"}),e.jsx("span",{className:"text-xs font-black",children:"Start Warm-Up"})]}),e.jsx("button",{onClick:()=>s("/log-run"),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",fontSize:14,padding:"8px 0"},children:"Skip warm-up"})]}),e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[W===null?e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Complete your daily check-in and sync your watch to unlock your Training Readiness score"}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{score:W,onClick:()=>Y(!0)}),e.jsxs("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)"},children:["Based on your HRV, sleep, soreness, and energy levels",T!=null&&T.sleep_hours?` · Sleep: ${T.sleep_hours}h`:""]})]}),de!==null&&e.jsx("div",{className:"mt-3 pt-3",style:{borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("p",{className:"text-xs flex items-center gap-2",style:{color:"var(--text-muted)"},children:[e.jsx(bt,{size:14}),e.jsxs("span",{children:[e.jsxs("strong",{style:{color:"var(--text-primary)"},children:[Number(de).toLocaleString()," steps"]}),Pe==="watch"&&e.jsx("span",{style:{marginLeft:6,fontSize:11,color:"#22c55e"},children:"⌚ synced"})]})]})})]}),e.jsx(Rt,{onSyncPayload:st}),(l==null?void 0:l.calendarDays)&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"text-xs font-medium mb-3",style:{color:"var(--text-muted)"},children:o("dashboard.thisWeek")}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:l.calendarDays.map(t=>e.jsxs("div",{className:"flex flex-col items-center gap-1",onClick:()=>O(t),style:{cursor:"pointer"},children:[e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.6},children:t.day}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border",style:{background:t.hasRun||t.hasLift?"var(--accent)":"var(--bg-input)",borderColor:t.isToday?"var(--accent)":"transparent",borderWidth:t.isToday?2:1},children:t.hasRun&&t.hasLift?e.jsx("span",{className:"text-xs font-bold text-black",children:"R+L"}):t.hasRun?e.jsx("span",{className:"text-xs font-bold text-black",children:"R"}):t.hasLift?e.jsx("span",{className:"text-xs font-bold text-black",children:"L"}):e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.4},children:"·"})})]},t.date))})]}),e.jsxs("div",{className:"rounded-2xl p-4 space-y-3",style:{background:"var(--bg-card)"},children:[e.jsx("div",{className:"flex gap-2",children:[{key:"day",label:"D"},{key:"week",label:"W"},{key:"month",label:"M"},{key:"all",label:"All"}].map(({key:t,label:n})=>e.jsx("button",{onClick:()=>Ne(t),className:"px-4 py-1.5 rounded-full text-xs font-semibold transition-all",style:_===t?{background:"var(--accent)",color:"#000"}:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},children:n},t))}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:et[_]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-5xl font-black tabular-nums",style:{color:"var(--text-primary)"},children:r.distanceValue(Qe/10).toFixed(1)}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:[r.distanceLabel.charAt(0).toUpperCase()+r.distanceLabel.slice(1),"s"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{label:"Runs",value:Xe},{label:"Time",value:Nt(B.seconds)},{label:"Cal",value:_==="week"?Ge.toLocaleString():(B.calories||0).toLocaleString()}].map((t,n)=>{const c=n%2===0;return e.jsxs("div",{className:"rounded-lg p-2",style:{border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:t.value}),e.jsxs("p",{className:"text-xs flex items-center gap-1",style:{color:"var(--text-muted)"},children:[t.label,c?e.jsx(vt,{size:12,color:"#22c55e"}):e.jsx(jt,{size:12,color:"#ef4444"})]})]},t.label)})})]}),(l==null?void 0:l.weeklyTrend)&&l.weeklyTrend.some(t=>t.miles>0)&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-muted)"},children:"Past 12 Weeks"}),e.jsxs("p",{className:"text-xs font-semibold",style:{color:"var(--accent)"},children:[r.distance((he=l.weeklyTrend[l.weeklyTrend.length-1])==null?void 0:he.miles,1)," last week"]})]}),e.jsx(wt,{data:l.weeklyTrend}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.5},children:new Date((ye=l.weeklyTrend[0])==null?void 0:ye.week).toLocaleDateString("en-US",{month:"short"})}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.5},children:"Now"})]})]}),w&&e.jsx("div",{className:"rounded-xl border p-3 text-sm",style:{borderColor:"rgba(234,179,8,0.3)",background:"rgba(234,179,8,0.08)",color:"var(--accent)"},children:"Heavy legs detected — consider a rest day or easy run today"}),Ee.map(t=>e.jsxs("div",{style:{background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.3)",borderRadius:12,padding:"10px 14px"},children:[e.jsxs("p",{style:{fontSize:13,fontWeight:700,color:"#ef4444",margin:0,display:"flex",alignItems:"center",gap:6},children:[e.jsx(kt,{size:14})," Your ",t.nickname||`${t.brand} ${t.model}`," has ",Number(t.total_miles||0).toFixed(0)," miles — time to replace soon"]}),e.jsxs("p",{style:{fontSize:11,color:"var(--text-muted)",margin:"2px 0 0"},children:[t.total_miles," of 500 miles"]})]},t.id)),e.jsxs("section",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("h3",{className:"text-base font-bold mb-3",style:{color:"var(--text-primary)",borderBottom:"1px solid rgba(234,179,8,0.45)",paddingBottom:6},children:"Recent Activity"}),e.jsxs("div",{className:"space-y-3",children:[me.map(t=>t._type==="run"?e.jsxs("div",{onClick:()=>s(`/history?runId=${t.id}`),className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",borderLeft:"4px solid #EAB308",cursor:"pointer"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:"Run"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(t.date||t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:r.distance(Number(t.distance_miles||0),2)})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:r.pace(t.duration_seconds/t.distance_miles)})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:ke(t.duration_seconds)})}),t.calories>0&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:[t.calories," cal"]})})]})]},t.id):t._type==="other"?e.jsxs("div",{className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"rgba(234,179,8,0.2)",color:"var(--accent)"},children:"Other Activity"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(t.synced_at||t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("p",{className:"text-sm font-bold mt-1",style:{color:"var(--text-primary)"},children:t.activity_name||t.activity_type||"Synced activity"})]},t.id):e.jsxs("div",{onClick:()=>s(`/history?workoutId=${t.id}`),className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",borderLeft:"4px solid #ffffff",cursor:"pointer"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"rgba(139,92,246,0.15)",color:"#a78bfa"},children:"Lift"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(t.date||t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("p",{className:"text-sm font-bold mt-1",style:{color:"var(--text-primary)"},children:t.exercise_name||(Array.isArray(t.muscle_groups)?t.muscle_groups.join(", "):"Workout")}),t.sets&&e.jsxs("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:[t.sets," sets · ",t.reps," reps · ",t.weight_lbs," lbs"]})]},t.id)),me.length===0&&e.jsx("p",{className:"text-sm py-4 text-center",style:{color:"var(--text-muted)"},children:o("dashboard.noActivity")})]})]}),i&&e.jsx("div",{onClick:()=>O(null),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:50,display:"flex",alignItems:"flex-end"},children:e.jsxs("div",{onClick:t=>t.stopPropagation(),style:{background:"var(--bg-card)",borderRadius:"20px 20px 0 0",padding:24,width:"100%",maxHeight:"60vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)"},children:new Date(i.date+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsx("p",{style:{fontSize:20,fontWeight:900,color:"var(--text-primary)"},children:i.hasRun||i.hasLift?"Active Day":"Rest Day"})]}),e.jsx("button",{onClick:()=>O(null),style:{background:"var(--bg-input)",border:"none",borderRadius:10,padding:"8px 14px",color:"var(--text-muted)",cursor:"pointer",fontSize:13},children:"Close"})]}),i.run&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:16,marginBottom:12},children:[e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--accent)",letterSpacing:1,textTransform:"uppercase",marginBottom:10},children:"Run"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:Number(i.run.distance||0).toFixed(2)}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"miles"})]}),i.run.duration>0&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:ke(i.run.duration)}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"duration"})]}),i.run.distance>0&&i.run.duration>0&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:(()=>{const t=i.run.duration/i.run.distance;return`${Math.floor(t/60)}:${String(Math.round(t%60)).padStart(2,"0")}`})()}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"avg pace /mi"})]}),i.run.surface&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",textTransform:"capitalize"},children:i.run.surface}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"surface"})]})]}),i.run.notes&&e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginTop:12,lineHeight:1.5,borderTop:"1px solid var(--border-subtle)",paddingTop:10},children:i.run.notes})]}),i.lifts&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:16,marginBottom:12},children:[e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--accent)",letterSpacing:1,textTransform:"uppercase",marginBottom:8},children:"Strength"}),e.jsxs("p",{style:{fontSize:20,fontWeight:900,color:"var(--text-primary)"},children:[i.lifts," workout session",i.lifts>1?"s":""]})]}),!i.hasRun&&!i.hasLift&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:20,textAlign:"center"},children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",marginBottom:6},children:"Rest day"}),e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",lineHeight:1.6},children:i.isToday?"No activity logged yet today.":"Recovery is part of training. Rest days make you stronger."})]})]})}),Te&&e.jsx("div",{onClick:()=>Y(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:50,display:"flex",alignItems:"flex-end"},children:e.jsxs("div",{onClick:t=>t.stopPropagation(),style:{background:"var(--bg-card)",borderRadius:"20px 20px 0 0",padding:24,width:"100%",maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)"},children:"Training Readiness"}),e.jsxs("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:[W," ",e.jsx("span",{style:{fontSize:14,fontWeight:400,color:"var(--text-muted)"},children:"/ 100"})]}),e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginTop:2},children:W>=80?"Go hard today.":W>=60?"Moderate effort — push but listen to your body.":W>=40?"Take it easy — a recovery run or rest day is smart.":"Rest today. Your body is telling you something."})]}),e.jsx("button",{onClick:()=>Y(!1),style:{background:"var(--bg-input)",border:"none",borderRadius:10,padding:"8px 14px",color:"var(--text-muted)",cursor:"pointer",fontSize:13},children:"Close"})]}),e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--text-muted)",letterSpacing:1,textTransform:"uppercase",marginBottom:12},children:"Score Breakdown"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:Je.map((t,n)=>e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:12,padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("p",{style:{fontSize:13,fontWeight:700,color:"var(--text-primary)"},children:t.label}),e.jsx("p",{style:{fontSize:13,fontWeight:700,color:t.delta>0?"#22c55e":t.delta<0?"#ef4444":"var(--text-muted)"},children:t.delta>0?`+${t.delta}`:t.delta<0?`${t.delta}`:`${t.value}`})]}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",lineHeight:1.5},children:t.reason})]},n))}),e.jsxs("div",{style:{marginTop:20,padding:14,background:"var(--bg-base)",borderRadius:12,borderLeft:"3px solid var(--accent)"},children:[e.jsx("p",{style:{fontSize:12,fontWeight:700,color:"var(--accent)",marginBottom:6},children:"How to improve your score"}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",lineHeight:1.6},children:"Log runs consistently to build your streak. Keep weekly mileage within 10–20% of your average. Connect your Garmin for HRV and sleep data — that unlocks a much more accurate score."})]})]})})]})}export{Gt as default};
