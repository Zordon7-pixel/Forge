import{r as s,b as gt,c as ft,u as bt,a as b,j as e,R as Se}from"./index-Bez5XITZ.js";import{A as vt}from"./AchievementUnlock-CrZ3efPt.js";import{L as jt}from"./LoadingRunner-Dut7A22X.js";import{g as kt,f as St}from"./offlineQueue-B-c8T9Pb.js";import{X as we}from"./x-c0hv5cfd.js";import{F as wt}from"./flame-DWes9oUx.js";import{F as Nt}from"./footprints-BmIgJgcF.js";import{A as _t,a as Rt}from"./arrow-up-right-DBgHUq6Q.js";import{T as Ct}from"./triangle-alert-Dk2ckmOY.js";import{W as Wt}from"./watch-CjfD7Ucx.js";function Lt(){const[a,r]=s.useState(()=>typeof navigator>"u"?!0:navigator.onLine),[i,n]=s.useState(0),m=s.useCallback(async()=>{try{const u=await kt();n(u)}catch{n(0)}},[]),y=s.useCallback(async()=>{try{await St()}finally{await m()}},[m]);return s.useEffect(()=>{m()},[m]),s.useEffect(()=>{const u=()=>{var N;r(!0),y(),(N=navigator.serviceWorker)!=null&&N.controller&&navigator.serviceWorker.controller.postMessage({type:"FLUSH_OFFLINE_QUEUE"})},g=()=>r(!1),x=()=>m(),S=N=>{var f;const z=(f=N==null?void 0:N.data)==null?void 0:f.type;(z==="OFFLINE_QUEUE_UPDATED"||z==="OFFLINE_QUEUE_FLUSHED")&&m()};return window.addEventListener("online",u),window.addEventListener("offline",g),window.addEventListener("offline-queue-updated",x),navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",S),navigator.onLine&&y(),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",g),window.removeEventListener("offline-queue-updated",x),navigator.serviceWorker&&navigator.serviceWorker.removeEventListener("message",S)}},[y,m]),{isOnline:a,queueCount:i}}function Ne(a){if(!a)return"0 min";const r=Math.floor(a/3600),i=Math.floor(a%3600/60);return r>0?i>0?`${r}h ${i}min`:`${r}h`:`${i} min`}function Tt(a){if(!a)return"0m";const r=Math.floor(a/3600),i=Math.floor(a%3600/60);return r>0?`${r}h ${i}m`:`${i}m`}function te(a,r=900){const[i,n]=Se.useState(0);return Se.useEffect(()=>{if(!a){n(0);return}let m=0;const y=a/(r/16),u=setInterval(()=>{m+=y,m>=a?(n(a),clearInterval(u)):n(Math.floor(m))},16);return()=>clearInterval(u)},[a,r]),i}function Dt({data:a=[]}){if(!a.length)return null;const r=Math.max(...a.map(u=>u.miles),1),i=100,n=40,m=a.map((u,g)=>{const x=g/(a.length-1)*i,S=n-u.miles/r*n;return`${x},${S}`}).join(" "),y=`0,${n} `+m+` ${i},${n}`;return e.jsxs("svg",{viewBox:`0 0 ${i} ${n}`,className:"w-full h-16",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trendGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--accent)",stopOpacity:"0.4"}),e.jsx("stop",{offset:"100%",stopColor:"var(--accent)",stopOpacity:"0"})]})}),e.jsx("polygon",{points:y,fill:"url(#trendGrad)"}),e.jsx("polyline",{points:m,fill:"none",stroke:"var(--accent)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),a.map((u,g)=>{const x=g/(a.length-1)*i,S=n-u.miles/r*n;return u.miles>0?e.jsx("circle",{cx:x,cy:S,r:"1.5",fill:"var(--accent)"},g):null})]})}function $t({score:a,onClick:r}){const y=2*Math.PI*28,u=a/100*y,g=a>=75?"#22c55e":a>=50?"var(--accent)":"#ef4444",x=a>=80?"Optimal":a>=60?"Good":a>=40?"Moderate":"Low";return e.jsxs("div",{onClick:r,style:{cursor:"pointer"},className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 72 72",children:[e.jsx("circle",{cx:36,cy:36,r:28,fill:"none",stroke:"var(--border-subtle)",strokeWidth:"5"}),e.jsx("circle",{cx:36,cy:36,r:28,fill:"none",stroke:g,strokeWidth:"5",strokeDasharray:`${u} ${y}`,strokeLinecap:"round",transform:"rotate(-90 36 36)"}),e.jsx("text",{x:36,y:37,textAnchor:"middle",dominantBaseline:"middle",fontSize:"13",fontWeight:"bold",fill:g,children:a})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-base",style:{color:"var(--text-primary)"},children:x}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:"Training readiness"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)",opacity:.7},children:a>=75?"Go hard today.":a>=50?"Moderate effort.":"Take it easy today."})]})]}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)",opacity:.6},children:"Tap to see breakdown"})]})}function _e(){const a=new Date,r=new Date(Date.UTC(a.getFullYear(),0,1)),i=Math.floor((a-r)/864e5),n=Math.ceil((i+r.getUTCDay()+1)/7);return`${a.getFullYear()}-${String(n).padStart(2,"0")}`}function zt({onSyncPayload:a}){const[r,i]=s.useState(null),[n,m]=s.useState(!1),[y,u]=s.useState(!1);s.useEffect(()=>{const S=localStorage.getItem("forge_token");if(!S)return;const N=f=>{i(R=>(f&&R&&f.synced_at!==(R==null?void 0:R.synced_at)&&(u(!0),setTimeout(()=>u(!1),3e3)),f)),a==null||a(f)};fetch("/api/watch-sync/status",{headers:{Authorization:`Bearer ${S}`}}).then(f=>f.ok?f.json():null).then(N).catch(()=>{});const z=setInterval(()=>{fetch("/api/watch-sync/status",{headers:{Authorization:`Bearer ${S}`}}).then(f=>f.ok?f.json():null).then(N).catch(()=>{})},1e4);return()=>clearInterval(z)},[a]);const g=(r==null?void 0:r.treadmill_brand)||(r==null?void 0:r.watch_mode)||null,x=r&&(r.avg_heart_rate||r.distance_miles);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("style",{children:`
        @keyframes watchPulse { 0%,100% { box-shadow: 0 0 0 0 rgba(234,179,8,0.4); } 50% { box-shadow: 0 0 0 8px rgba(234,179,8,0); } }
        @keyframes syncFlash { 0% { background: rgba(34,197,94,0.3); } 100% { background: transparent; } }
      `}),e.jsxs("button",{onClick:()=>{m(!0),setTimeout(()=>m(!1),1500)},style:{display:"flex",alignItems:"center",gap:6,background:x?"rgba(234,179,8,0.1)":"var(--bg-input)",border:`1px solid ${x?"rgba(234,179,8,0.4)":"var(--border-subtle)"}`,borderRadius:10,padding:"6px 12px",cursor:"pointer",animation:n?"watchPulse 1s ease-in-out infinite":"none",transition:"all 0.3s ease",...y?{animation:"syncFlash 1s ease forwards"}:{}},children:[e.jsx(Wt,{size:14,color:x?"#EAB308":"var(--text-muted)"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("p",{style:{fontSize:9,color:"var(--text-muted)",margin:0,letterSpacing:.5,textTransform:"uppercase"},children:g||"Watch"}),e.jsx("p",{style:{fontSize:11,fontWeight:700,color:x?"#EAB308":"var(--text-muted)",margin:0},children:y?"Synced!":x?`HR ${r.avg_heart_rate||"--"} bpm`:"No data"})]}),x&&e.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:"#22c55e",animation:"watchPulse 2s ease infinite"}})]}),e.jsx("p",{style:{fontSize:9,color:"var(--text-muted)",textAlign:"center",marginTop:2},children:"+ Meta Glasses (soon)"})]})}function Vt(){var F,ge,fe,be;const a=gt(),{fmt:r}=ft(),{t:i}=bt(),[n,m]=s.useState(null),[y,u]=s.useState([]),[g,x]=s.useState([]),[S,N]=s.useState(!1),[z,f]=s.useState(!0),[R,Re]=s.useState("week"),[O,Ce]=s.useState(!1),[se,We]=s.useState(!1),[ae,Le]=s.useState("auto"),[G,Te]=s.useState(null),[Mt,Et]=s.useState(!1),[At,It]=s.useState(""),[De,Q]=s.useState(!1),[d,P]=s.useState(null),[v,re]=s.useState(null),[ne,$e]=s.useState([]),[ze,Me]=s.useState({currentStreak:0,bestStreak:0}),[oe,le]=s.useState([]),[ie,ce]=s.useState(null),[w,Ee]=s.useState(null),[de,Ae]=s.useState(!1),[C,Ie]=s.useState(null),[q,Be]=s.useState(null),[Fe,Ue]=s.useState(Number(localStorage.getItem("forge_load_warning_dismissed_until")||0)),[He,Oe]=s.useState([]),[Ge,Qe]=s.useState(0),[L,Pe]=s.useState(null),[ue,Y]=s.useState(null),[qe,V]=s.useState("manual"),[W,Ye]=s.useState(null),[Ve,me]=s.useState(!1),[I,Ke]=s.useState(null),[Je,xe]=s.useState(!1),[Xe,pe]=s.useState(!1),{isOnline:he,queueCount:K}=Lt();s.useEffect(()=>{(async()=>{var t,l,c,p,o,h,j,E,T,$,_,A,D;try{const[J,X,Z,lt,U,ee,it,ct,dt,ut,mt,xt,pt]=await Promise.all([b.get("/auth/me/stats"),b.get("/runs",{params:{limit:5}}),b.get("/lifts"),b.get("/coach/warning"),b.get("/checkin/today").catch(()=>({data:null})),b.get("/users/goal").catch(()=>({data:null})),b.get("/auth/me/streak").catch(()=>({data:{currentStreak:0,bestStreak:0}})),b.get("/milestones/new").catch(()=>({data:{milestones:[]}})),b.get("/plans/compliance").catch(()=>({data:null})),b.get("/runs/load-analysis").catch(()=>({data:null})),b.get("/races/next").catch(()=>({data:{race:null}})),b.get("/gear/shoes").catch(()=>({data:{shoes:[]}})),b.get("/injury/active").catch(()=>({data:{injuries:[]}}))]);m(J.data);const ve=Array.isArray(X.data)?X.data:((t=X.data)==null?void 0:t.runs)||[];u(ve),We(ve.some(k=>k.avg_heart_rate||k.watch_mode||k.route_coords)),x(Array.isArray(Z.data)?Z.data:((l=Z.data)==null?void 0:l.lifts)||[]),N(((c=lt.data)==null?void 0:c.warning)===!0);const je=((p=U.data)==null?void 0:p.step_count)??((o=U.data)==null?void 0:o.steps);if(Number.isFinite(Number(je)))Y(Number(je)),V("manual");else{const k=((j=(h=J.data)==null?void 0:h.day)==null?void 0:j.steps)??((T=(E=J.data)==null?void 0:E.today)==null?void 0:T.steps);Number.isFinite(Number(k))&&(Y(Number(k)),V("manual"))}U.data&&(Ce(!0),Pe(U.data)),ee.data&&(Le(ee.data.mode||"auto"),Te(ee.data.miles||null)),Me(it.data||{currentStreak:0,bestStreak:0});const H=(($=ct.data)==null?void 0:$.milestones)||[];le(H),H.length>0&&ce(k=>k||{name:H[0].title,description:H[0].description,icon:"Award",color:"#EAB308"}),Ee(dt.data),Ie(ut.data),Be(((_=mt.data)==null?void 0:_.race)||null),Oe((((A=xt.data)==null?void 0:A.shoes)||[]).filter(k=>Number(k.total_miles||0)>450)),Ye((((D=pt.data)==null?void 0:D.injuries)||[])[0]||null),b.get("/recap/weekly").then(k=>{var ke;Qe(((ke=k.data)==null?void 0:ke.totalCalories)||0);const ht=new Date().getDay()===0,yt=`recap-seen-${_e()}`;ht&&localStorage.getItem(yt)!=="1"&&(Ke(k.data||null),xe(!0))}).catch(()=>{})}finally{f(!1)}})()},[]),s.useEffect(()=>{const t=localStorage.getItem("forge_last_watch_sync_seen_at")||"1970-01-01T00:00:00";b.get("/watch-sync/recent",{params:{since:t}}).then(l=>{var p;const c=((p=l.data)==null?void 0:p.items)||[];c.length&&($e(c.filter(o=>o.routed_section==="other")),re(c[0]))}).catch(()=>{})},[]),s.useEffect(()=>{me(!1)},[W==null?void 0:W.id]),s.useEffect(()=>{let t;const l=o=>{!o||o<1||(pe(!0),clearTimeout(t),t=setTimeout(()=>pe(!1),2500))},c=o=>{var h;l(Number(((h=o==null?void 0:o.detail)==null?void 0:h.flushedCount)||0))},p=o=>{var h,j;((h=o==null?void 0:o.data)==null?void 0:h.type)==="OFFLINE_QUEUE_FLUSHED"&&l(Number(((j=o==null?void 0:o.data)==null?void 0:j.flushedCount)||0))};return window.addEventListener("offline-queue-flushed",c),navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",p),()=>{clearTimeout(t),window.removeEventListener("offline-queue-flushed",c),navigator.serviceWorker&&navigator.serviceWorker.removeEventListener("message",p)}},[]);const{readiness:M,readinessBreakdown:Ze}=s.useMemo(()=>{var A;if(!n||!O||!se)return{readiness:null,readinessBreakdown:[]};const{streak:t,week:l,all:c}=n;let p=50;const o=[];o.push({label:"Base score",value:50,delta:0,reason:"Starting point for all athletes."});const h=Math.min(t*4,20);p+=h,o.push({label:"Consistency streak",value:h,delta:h,reason:t>0?`${t}-day active streak adds +${h} pts. Staying consistent pays off.`:"No active streak. Logging runs builds your streak bonus."});const j=c.miles/Math.max((A=n.weeklyTrend)==null?void 0:A.filter(D=>D.miles>0).length,1),E=j>0?l.miles/j:0;let T=0,$="";E<.5?(T=15,$=`This week you ran ${r.distance(l.miles,1)} vs your avg ${r.distance(j,1)} â€” low volume means your legs are fresh.`):E>1.3?(T=-15,$=`This week you ran ${r.distance(l.miles,1)} vs your avg ${r.distance(j,1)} â€” high volume week, body needs recovery.`):$=`This week (${r.distance(l.miles,1)}) is on par with your average (${r.distance(j,1)}) â€” balanced load.`,p+=T,o.push({label:"Weekly load",value:T,delta:T,reason:$});const _=Number((L==null?void 0:L.sleep_hours)||0);if(_>0){const D=_<6?-12:_>=8?5:0;p+=D,o.push({label:"Sleep",value:D,delta:D,reason:_<6?`${_}h sleep lowers readiness today.`:_>=8?`${_}h sleep boosts recovery readiness.`:`${_}h sleep is neutral for readiness.`})}return{readiness:Math.max(1,Math.min(99,Math.round(p))),readinessBreakdown:o}},[n,O,se,L,r]);s.useMemo(()=>{var p;if(!n)return null;const t=((p=n.month)==null?void 0:p.miles)||0;let l;ae==="manual"&&G?l=G:l=Math.max(25,Math.ceil(t/25)*25+(t>=25?25:0));const c=Math.min(t/l*100,100);return{miles:t,goal:l,pct:c}},[n,ae,G]);const B=(n==null?void 0:n[R])||{},et=te(Math.round((B.miles||0)*10),900),tt=te(B.count||0,900);te(ze.currentStreak||0,900);const ye=s.useMemo(()=>{const t=y.slice(0,3).map(o=>({...o,_type:"run"})),l=(g||[]).slice(0,3).map(o=>({...o,_type:"lift"})),c=(ne||[]).slice(0,3).map(o=>({...o,_type:"other"}));return[...t,...l,...c].sort((o,h)=>{const j=o.date||o.started_at||o.created_at||"";return(h.date||h.started_at||h.created_at||"").localeCompare(j)}).slice(0,4)},[y,g,ne]),st=C&&["elevated","high","danger"].includes(C.loadStatus)&&Date.now()>Fe,at=(w==null?void 0:w.score)>=80?"#22c55e":(w==null?void 0:w.score)>=50?"#EAB308":"#ef4444",rt={day:"Today",week:i("dashboard.thisWeek"),month:"This Month",year:"This Year",all:"All Time"},nt=Ve||W&&localStorage.getItem(`forge-injury-dismissed-${W.id}`)==="1",ot=s.useCallback(t=>{if(!t)return;const l=t.step_count??t.steps,c=Number(l);Number.isFinite(c)&&c>=0&&(Y(Math.round(c)),V("watch"))},[]);return z?e.jsx(jt,{message:"Getting ready"}):e.jsxs("div",{className:"space-y-4",children:[Xe&&e.jsx("div",{className:"rounded-xl p-2 text-sm font-semibold",style:{background:"rgba(34,197,94,0.18)",border:"1px solid rgba(34,197,94,0.45)",color:"#16a34a"},children:"Synced!"}),(!he||K>0)&&e.jsx("div",{className:"rounded-xl p-2 text-sm font-semibold",style:{background:"rgba(234,179,8,0.14)",border:"1px solid rgba(234,179,8,0.35)",color:"var(--text-primary)"},children:he?`${K} workouts queued for sync`:`ðŸ“´ Offline â€” ${K} workouts queued for sync`}),ie&&e.jsx(vt,{badge:ie,onDismiss:()=>ce(null)}),e.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        @keyframes ringClose {
          0% { opacity: 1; stroke-dasharray: 157 0; }
          80% { opacity: 1; stroke-dasharray: 157 0; }
          100% { opacity: 0; stroke-dasharray: 157 0; }
        }
      `}),!nt&&W&&e.jsx("div",{className:"rounded-xl p-4",style:{background:"rgba(234,179,8,0.2)",border:"1px solid #EAB308"},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold",style:{color:"#0f1117"},children:["Recovery Mode â€” ",W.body_part||"Injury"," â€” Est. return: ",W.date||"--"]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#0f1117"},children:"Your plan has been adjusted for recovery. Focus on PT and low-impact activity."})]}),e.jsx("button",{onClick:()=>{localStorage.setItem(`forge-injury-dismissed-${W.id}`,"1"),me(!0)},className:"rounded-md p-1",style:{background:"transparent",color:"#0f1117"},"aria-label":"Dismiss injury warning",children:e.jsx(we,{size:16})})]})}),Je&&I&&e.jsx("div",{className:"rounded-xl p-4",style:{background:"#1a1d2e",border:"1px solid #2a2d3e"},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",style:{color:"#EAB308"},children:"Weekly Recap"}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:[((ge=(F=I.totalMiles)==null?void 0:F.toFixed)==null?void 0:ge.call(F,1))||0," mi Â· ",I.totalRuns||0," runs Â· ",(I.totalCalories||0).toLocaleString()," cal"]})]}),e.jsx("button",{onClick:()=>{localStorage.setItem(`recap-seen-${_e()}`,"1"),xe(!1)},style:{background:"transparent",color:"var(--text-muted)"},className:"p-1","aria-label":"Dismiss weekly recap",children:e.jsx(we,{size:16})})]})}),st&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:C.loadStatus==="danger"?"rgba(239,68,68,0.12)":C.loadStatus==="high"?"rgba(249,115,22,0.12)":"rgba(234,179,8,0.12)",border:`1px solid ${C.loadStatus==="danger"?"rgba(239,68,68,0.35)":C.loadStatus==="high"?"rgba(249,115,22,0.35)":"rgba(234,179,8,0.35)"}`},children:[e.jsxs("p",{className:"text-xs font-bold uppercase",style:{color:"var(--text-primary)"},children:[C.loadStatus," load"]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-primary)"},children:C.warning||C.recommendation}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},onClick:()=>a("/plan",{state:{suggestEasyDay:!0}}),children:"Take Easy Day"}),e.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},onClick:()=>{const t=Date.now()+864e5;localStorage.setItem("forge_load_warning_dismissed_until",String(t)),Ue(t)},children:"OK"})]})]}),q&&(()=>{const t=Math.ceil((new Date(`${q.race_date}T12:00:00`).getTime()-Date.now())/864e5);return t>0&&t<=60?e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Next Race"}),e.jsx("p",{className:"text-base font-bold",style:{color:"var(--text-primary)"},children:q.race_name}),e.jsxs("p",{className:"text-sm",style:{color:"var(--accent)"},children:[t," days to go"]})]}):null})(),w&&e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},onClick:()=>Ae(!de),children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:[i("dashboard.thisWeek"),": ",w.completed,"/",w.planned," sessions â€” ",w.score,"%"]}),e.jsx("div",{className:"w-full h-2 rounded-full mt-2",style:{background:"var(--bg-input)"},children:e.jsx("div",{className:"h-2 rounded-full",style:{width:`${w.score}%`,background:at}})}),de&&e.jsx("div",{className:"mt-3 space-y-1",children:(w.sessions||[]).map((t,l)=>e.jsxs("p",{className:"text-xs",style:{color:t.completed?"#22c55e":"#ef4444"},children:[t.day,": ",t.type," ",t.completed?"hit":"missed"]},l))})]}),oe.length>0&&e.jsx("div",{className:"space-y-2",children:oe.map(t=>e.jsxs("div",{className:"rounded-xl p-3 flex items-center justify-between",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:t.title}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:t.description})]}),e.jsx("button",{onClick:()=>le(l=>l.filter(c=>c.key!==t.key)),className:"text-xs",style:{color:"var(--text-muted)"},children:"Dismiss"})]},t.key))}),!O&&e.jsxs("a",{href:"/checkin",style:{display:"block",background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)",borderRadius:14,padding:"12px 16px",marginBottom:12,textDecoration:"none"},children:[e.jsx("p",{style:{color:"var(--accent)",fontWeight:700,fontSize:14,margin:0},children:"Quick check-in â€” 3 taps"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:12,margin:"2px 0 0"},children:"Help me adjust today's plan around your day"})]}),v&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:["New activity synced from your watch â€” ",v.activity_name,". View it in ",v.routed_section==="lift"?"Lift":v.routed_section==="other"?"History":"Run"," tab."]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>{localStorage.setItem("forge_last_watch_sync_seen_at",v.synced_at),v.routed_section==="lift"?a("/log-lift"):v.normalized_type==="treadmill"?a("/run/treadmill",{state:{incline:v.incline_pct,speed:v.belt_speed_mph,durationSeconds:v.duration_seconds,treadmillType:v.treadmill_brand||"Generic",watchMetrics:v}}):a("/log-run")},className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},children:"View"}),e.jsx("button",{onClick:()=>{localStorage.setItem("forge_last_watch_sync_seen_at",v.synced_at),re(null)},className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},children:"Dismiss"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 flex flex-col items-center",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("h2",{className:"text-2xl font-black mb-1",style:{color:"var(--text-primary)"},children:"Ready to Run?"}),e.jsx("p",{className:"text-sm mb-10 text-center",style:{color:"var(--text-muted)"},children:"Dynamic warm-up reduces injury risk and improves performance."}),e.jsxs("button",{onClick:()=>a("/warmup"),className:"rounded-full w-28 h-28 mb-3 font-black flex flex-col items-center justify-center",style:{background:"var(--accent)",color:"#000",border:"none",cursor:"pointer"},children:[e.jsx(wt,{className:"mb-1"}),e.jsx("span",{className:"text-xs font-black",children:"Start Warm-Up"})]}),e.jsx("button",{onClick:()=>a("/log-run"),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",fontSize:14,padding:"8px 0"},children:"Skip warm-up"})]}),e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[M===null?e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Complete your daily check-in and sync your watch to unlock your Training Readiness score"}):e.jsxs(e.Fragment,{children:[e.jsx($t,{score:M,onClick:()=>Q(!0)}),e.jsxs("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)"},children:["Based on your HRV, sleep, soreness, and energy levels",L!=null&&L.sleep_hours?` Â· Sleep: ${L.sleep_hours}h`:""]})]}),ue!==null&&e.jsx("div",{className:"mt-3 pt-3",style:{borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("p",{className:"text-xs flex items-center gap-2",style:{color:"var(--text-muted)"},children:[e.jsx(Nt,{size:14}),e.jsxs("span",{children:[e.jsxs("strong",{style:{color:"var(--text-primary)"},children:[Number(ue).toLocaleString()," steps"]}),qe==="watch"&&e.jsx("span",{style:{marginLeft:6,fontSize:11,color:"#22c55e"},children:"âŒš synced"})]})]})})]}),e.jsx(zt,{onSyncPayload:ot}),(n==null?void 0:n.calendarDays)&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"text-xs font-medium mb-3",style:{color:"var(--text-muted)"},children:i("dashboard.thisWeek")}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:n.calendarDays.map(t=>e.jsxs("div",{className:"flex flex-col items-center gap-1",onClick:()=>P(t),style:{cursor:"pointer"},children:[e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.6},children:t.day}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border",style:{background:t.hasRun||t.hasLift?"var(--accent)":"var(--bg-input)",borderColor:t.isToday?"var(--accent)":"transparent",borderWidth:t.isToday?2:1},children:t.hasRun&&t.hasLift?e.jsx("span",{className:"text-xs font-bold text-black",children:"R+L"}):t.hasRun?e.jsx("span",{className:"text-xs font-bold text-black",children:"R"}):t.hasLift?e.jsx("span",{className:"text-xs font-bold text-black",children:"L"}):e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.4},children:"Â·"})})]},t.date))})]}),e.jsxs("div",{className:"rounded-2xl p-4 space-y-3",style:{background:"var(--bg-card)"},children:[e.jsx("div",{className:"flex gap-2",children:[{key:"day",label:"D"},{key:"week",label:"W"},{key:"month",label:"M"},{key:"all",label:"All"}].map(({key:t,label:l})=>e.jsx("button",{onClick:()=>Re(t),className:"px-4 py-1.5 rounded-full text-xs font-semibold transition-all",style:R===t?{background:"var(--accent)",color:"#000"}:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},children:l},t))}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:rt[R]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-5xl font-black tabular-nums",style:{color:"var(--text-primary)"},children:r.distanceValue(et/10).toFixed(1)}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:[r.distanceLabel.charAt(0).toUpperCase()+r.distanceLabel.slice(1),"s"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{label:"Runs",value:tt},{label:"Time",value:Tt(B.seconds)},{label:"Cal",value:R==="week"?Ge.toLocaleString():(B.calories||0).toLocaleString()}].map((t,l)=>{const c=l%2===0;return e.jsxs("div",{className:"rounded-lg p-2",style:{border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:t.value}),e.jsxs("p",{className:"text-xs flex items-center gap-1",style:{color:"var(--text-muted)"},children:[t.label,c?e.jsx(_t,{size:12,color:"#22c55e"}):e.jsx(Rt,{size:12,color:"#ef4444"})]})]},t.label)})})]}),(n==null?void 0:n.weeklyTrend)&&n.weeklyTrend.some(t=>t.miles>0)&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-muted)"},children:"Past 12 Weeks"}),e.jsxs("p",{className:"text-xs font-semibold",style:{color:"var(--accent)"},children:[r.distance((fe=n.weeklyTrend[n.weeklyTrend.length-1])==null?void 0:fe.miles,1)," last week"]})]}),e.jsx(Dt,{data:n.weeklyTrend}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.5},children:new Date((be=n.weeklyTrend[0])==null?void 0:be.week).toLocaleDateString("en-US",{month:"short"})}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.5},children:"Now"})]})]}),S&&e.jsx("div",{className:"rounded-xl border p-3 text-sm",style:{borderColor:"rgba(234,179,8,0.3)",background:"rgba(234,179,8,0.08)",color:"var(--accent)"},children:"Heavy legs detected â€” consider a rest day or easy run today"}),He.map(t=>e.jsxs("div",{style:{background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.3)",borderRadius:12,padding:"10px 14px"},children:[e.jsxs("p",{style:{fontSize:13,fontWeight:700,color:"#ef4444",margin:0,display:"flex",alignItems:"center",gap:6},children:[e.jsx(Ct,{size:14})," Your ",t.nickname||`${t.brand} ${t.model}`," has ",Number(t.total_miles||0).toFixed(0)," miles â€” time to replace soon"]}),e.jsxs("p",{style:{fontSize:11,color:"var(--text-muted)",margin:"2px 0 0"},children:[t.total_miles," of 500 miles"]})]},t.id)),e.jsxs("section",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("h3",{className:"text-base font-bold mb-3",style:{color:"var(--text-primary)",borderBottom:"1px solid rgba(234,179,8,0.45)",paddingBottom:6},children:"Recent Activity"}),e.jsxs("div",{className:"space-y-3",children:[ye.map(t=>t._type==="run"?e.jsxs("div",{onClick:()=>a(`/history?runId=${t.id}`),className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",borderLeft:"4px solid #EAB308",cursor:"pointer"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:"Run"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(t.date||t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:r.distance(Number(t.distance_miles||0),2)})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:r.pace(t.duration_seconds/t.distance_miles)})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:Ne(t.duration_seconds)})}),t.calories>0&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:[t.calories," cal"]})})]})]},t.id):t._type==="other"?e.jsxs("div",{className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"rgba(234,179,8,0.2)",color:"var(--accent)"},children:"Other Activity"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(t.synced_at||t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("p",{className:"text-sm font-bold mt-1",style:{color:"var(--text-primary)"},children:t.activity_name||t.activity_type||"Synced activity"})]},t.id):e.jsxs("div",{onClick:()=>a(`/history?workoutId=${t.id}`),className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",borderLeft:"4px solid #ffffff",cursor:"pointer"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"rgba(139,92,246,0.15)",color:"#a78bfa"},children:"Lift"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(t.date||t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("p",{className:"text-sm font-bold mt-1",style:{color:"var(--text-primary)"},children:t.exercise_name||(Array.isArray(t.muscle_groups)?t.muscle_groups.join(", "):"Workout")}),t.sets&&e.jsxs("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:[t.sets," sets Â· ",t.reps," reps Â· ",t.weight_lbs," lbs"]})]},t.id)),ye.length===0&&e.jsx("p",{className:"text-sm py-4 text-center",style:{color:"var(--text-muted)"},children:i("dashboard.noActivity")})]})]}),d&&e.jsx("div",{onClick:()=>P(null),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:50,display:"flex",alignItems:"flex-end"},children:e.jsxs("div",{onClick:t=>t.stopPropagation(),style:{background:"var(--bg-card)",borderRadius:"20px 20px 0 0",padding:24,width:"100%",maxHeight:"60vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)"},children:new Date(d.date+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsx("p",{style:{fontSize:20,fontWeight:900,color:"var(--text-primary)"},children:d.hasRun||d.hasLift?"Active Day":"Rest Day"})]}),e.jsx("button",{onClick:()=>P(null),style:{background:"var(--bg-input)",border:"none",borderRadius:10,padding:"8px 14px",color:"var(--text-muted)",cursor:"pointer",fontSize:13},children:"Close"})]}),d.run&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:16,marginBottom:12},children:[e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--accent)",letterSpacing:1,textTransform:"uppercase",marginBottom:10},children:"Run"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:Number(d.run.distance||0).toFixed(2)}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"miles"})]}),d.run.duration>0&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:Ne(d.run.duration)}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"duration"})]}),d.run.distance>0&&d.run.duration>0&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:(()=>{const t=d.run.duration/d.run.distance;return`${Math.floor(t/60)}:${String(Math.round(t%60)).padStart(2,"0")}`})()}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"avg pace /mi"})]}),d.run.surface&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",textTransform:"capitalize"},children:d.run.surface}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"surface"})]})]}),d.run.notes&&e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginTop:12,lineHeight:1.5,borderTop:"1px solid var(--border-subtle)",paddingTop:10},children:d.run.notes})]}),d.lifts&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:16,marginBottom:12},children:[e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--accent)",letterSpacing:1,textTransform:"uppercase",marginBottom:8},children:"Strength"}),e.jsxs("p",{style:{fontSize:20,fontWeight:900,color:"var(--text-primary)"},children:[d.lifts," workout session",d.lifts>1?"s":""]})]}),!d.hasRun&&!d.hasLift&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:20,textAlign:"center"},children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",marginBottom:6},children:"Rest day"}),e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",lineHeight:1.6},children:d.isToday?"No activity logged yet today.":"Recovery is part of training. Rest days make you stronger."})]})]})}),De&&e.jsx("div",{onClick:()=>Q(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:50,display:"flex",alignItems:"flex-end"},children:e.jsxs("div",{onClick:t=>t.stopPropagation(),style:{background:"var(--bg-card)",borderRadius:"20px 20px 0 0",padding:24,width:"100%",maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)"},children:"Training Readiness"}),e.jsxs("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:[M," ",e.jsx("span",{style:{fontSize:14,fontWeight:400,color:"var(--text-muted)"},children:"/ 100"})]}),e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginTop:2},children:M>=80?"Go hard today.":M>=60?"Moderate effort â€” push but listen to your body.":M>=40?"Take it easy â€” a recovery run or rest day is smart.":"Rest today. Your body is telling you something."})]}),e.jsx("button",{onClick:()=>Q(!1),style:{background:"var(--bg-input)",border:"none",borderRadius:10,padding:"8px 14px",color:"var(--text-muted)",cursor:"pointer",fontSize:13},children:"Close"})]}),e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--text-muted)",letterSpacing:1,textTransform:"uppercase",marginBottom:12},children:"Score Breakdown"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:Ze.map((t,l)=>e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:12,padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("p",{style:{fontSize:13,fontWeight:700,color:"var(--text-primary)"},children:t.label}),e.jsx("p",{style:{fontSize:13,fontWeight:700,color:t.delta>0?"#22c55e":t.delta<0?"#ef4444":"var(--text-muted)"},children:t.delta>0?`+${t.delta}`:t.delta<0?`${t.delta}`:`${t.value}`})]}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",lineHeight:1.5},children:t.reason})]},l))}),e.jsxs("div",{style:{marginTop:20,padding:14,background:"var(--bg-base)",borderRadius:12,borderLeft:"3px solid var(--accent)"},children:[e.jsx("p",{style:{fontSize:12,fontWeight:700,color:"var(--accent)",marginBottom:6},children:"How to improve your score"}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",lineHeight:1.6},children:"Log runs consistently to build your streak. Keep weekly mileage within 10â€“20% of your average. Connect your Garmin for HRV and sleep data â€” that unlocks a much more accurate score."})]})]})})]})}export{Vt as default};
