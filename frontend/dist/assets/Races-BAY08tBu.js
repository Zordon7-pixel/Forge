import{r as n,j as a,a as d}from"./index-DPvCFa56.js";const b={"5K":3.1,"10K":6.2,Half:13.1,Full:26.2,Other:null};function C(r){const i=new Date(`${r}T12:00:00`).getTime()-Date.now();return Math.ceil(i/864e5)}function w(){const[r,i]=n.useState([]),[t,l]=n.useState({race_name:"",race_date:"",distance_key:"5K",distance_miles:3.1,location:"",goal_time:""}),[p,u]=n.useState(""),[c,m]=n.useState(null),[g,o]=n.useState(null),x=()=>d.get("/races").then(e=>i(e.data.races||[]));n.useEffect(()=>{x()},[]);const y=n.useMemo(()=>r.filter(e=>e.status==="upcoming").sort((e,s)=>e.race_date.localeCompare(s.race_date)),[r]),_=n.useMemo(()=>r.filter(e=>e.status!=="upcoming").sort((e,s)=>s.race_date.localeCompare(e.race_date)),[r]),h=async e=>{e.preventDefault();const s=t.goal_time?t.goal_time.split(":").reduce((f,k)=>f*60+Number(k),0):null,v={race_name:t.race_name,race_date:t.race_date,distance_miles:Number(t.distance_miles),location:t.location,goal_time_seconds:s},N=await d.post("/races",v);u("Race added");const j=N.data.race;m(j),l({race_name:"",race_date:"",distance_key:"5K",distance_miles:3.1,location:"",goal_time:""}),x()};return a.jsxs("div",{className:"space-y-4",children:[a.jsx("h1",{className:"text-2xl font-black",style:{color:"var(--text-primary)"},children:"Races"}),c&&a.jsxs("div",{className:"rounded-xl p-4",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[a.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Build a training plan for this race?"}),a.jsxs("div",{className:"flex gap-2 mt-3",children:[a.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},onClick:async()=>{try{o(c.id),await d.post("/plans/generate",{target:{raceDate:c.race_date,distanceMiles:Number(c.distance_miles),raceName:c.race_name}}),m(null),u(`Your training plan has been updated around ${c.race_name}`)}finally{o(null)}},children:g===c.id?"Generating...":"Generate Race Plan"}),a.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},onClick:()=>m(null),children:"Not now"})]})]}),a.jsxs("form",{onSubmit:h,className:"rounded-xl p-4 space-y-3",style:{background:"var(--bg-card)"},children:[a.jsx("p",{className:"text-sm font-semibold",children:"Add Race"}),a.jsx("input",{className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Race name",value:t.race_name,onChange:e=>l({...t,race_name:e.target.value}),required:!0}),a.jsx("input",{type:"date",className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},value:t.race_date,onChange:e=>l({...t,race_date:e.target.value}),required:!0}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("select",{className:"rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},value:t.distance_key,onChange:e=>{const s=e.target.value;l({...t,distance_key:s,distance_miles:b[s]??t.distance_miles})},children:Object.keys(b).map(e=>a.jsx("option",{children:e},e))}),a.jsx("input",{type:"number",step:"0.1",className:"rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Miles",value:t.distance_miles,onChange:e=>l({...t,distance_miles:e.target.value}),required:!0})]}),a.jsx("input",{className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Location",value:t.location,onChange:e=>l({...t,location:e.target.value})}),a.jsx("input",{className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Goal time (hh:mm:ss)",value:t.goal_time,onChange:e=>l({...t,goal_time:e.target.value})}),a.jsx("button",{className:"rounded-lg px-4 py-2 font-bold",style:{background:"var(--accent)",color:"#000"},children:"Save Race"}),p&&a.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:p})]}),a.jsxs("section",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm font-semibold",children:"Upcoming"}),y.map(e=>{const s=C(e.race_date);return a.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)"},children:[a.jsx("p",{className:"font-bold",children:e.race_name}),a.jsxs("p",{className:"text-xs",style:{color:"var(--accent)"},children:[s," days to go"]}),a.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[e.distance_miles," mi ",e.location?`Â· ${e.location}`:""]}),a.jsx("button",{className:"mt-2 rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"#EAB308",color:"#0f1117"},onClick:async()=>{try{o(e.id),await d.post("/plans/generate",{target:{raceDate:e.race_date,distanceMiles:Number(e.distance_miles),raceName:e.race_name}}),u(`Your training plan has been updated around ${e.race_name}`)}finally{o(null)}},children:g===e.id?"Generating...":"Generate Race Plan"})]},e.id)})]}),a.jsxs("section",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm font-semibold",children:"Past"}),_.map(e=>a.jsx("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)"},children:a.jsx("p",{className:"font-semibold",children:e.race_name})},e.id))]})]})}export{w as default};
