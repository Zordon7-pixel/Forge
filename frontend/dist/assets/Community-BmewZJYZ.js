import{d as A,r as x,j as e,b as L,a as h}from"./index-BY6vNrGT.js";import{H as z}from"./heart-BrXBVFdt.js";import{M as E}from"./message-circle-Juy_OI7m.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],C=A("UserCheck",M);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],$=A("UserPlus",R),T=["The body achieves what the mind believes.","Small daily progress creates big race-day results.","Discipline beats motivation on hard days.","One workout does not define you. Consistency does.","Show up today. Future you is watching."];function Q(){const[s,r]=x.useState("feed");return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Community"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{key:"feed",label:"Feed"},{key:"workouts",label:"Workouts"},{key:"routes",label:"Routes"}].map(a=>e.jsx("button",{onClick:()=>r(a.key),className:"rounded-full px-3 py-1 text-xs font-semibold",style:{background:s===a.key?"var(--accent)":"var(--bg-input)",color:s===a.key?"#000":"var(--text-muted)"},children:a.label},a.key))}),s==="feed"?e.jsx(D,{}):s==="workouts"?e.jsx(P,{}):e.jsx(U,{})]})}function D(){const s=L(),[r,a]=x.useState([]),[u,y]=x.useState([]),[g,l]=x.useState([]),[o,p]=x.useState({}),[k,b]=x.useState({}),[v,f]=x.useState({}),w=()=>{h.get("/social/feed").then(t=>{var n,d;a(((n=t.data)==null?void 0:n.items)||[]),y(((d=t.data)==null?void 0:d.suggested_users)||[])}).catch(()=>{a([]),y([])})};x.useEffect(()=>{w(),Promise.all([h.get("/runs").catch(()=>({data:{runs:[]}})),h.get("/workouts").catch(()=>({data:{sessions:[]}}))]).then(([t,n])=>{var N,j;const d=(((N=t.data)==null?void 0:N.runs)||[]).slice(0,3).map(m=>({id:`run-${m.id}`,title:`Run · ${Number(m.distance_miles||0).toFixed(2)} mi`,sub:m.date||m.created_at})),i=(((j=n.data)==null?void 0:j.sessions)||[]).slice(0,2).map(m=>({id:`lift-${m.id}`,title:`Lift · ${Math.round((m.total_seconds||0)/60)} min`,sub:m.started_at}));l([...d,...i])}).catch(()=>l([]))},[]);const c=async(t,n)=>{try{n?await h.delete(`/social/unfollow/${t}`):await h.post(`/social/follow/${t}`),a(d=>d.map(i=>i.user_id===t?{...i,is_following:!n}:i)),y(d=>d.map(i=>i.id===t?{...i,is_following:!n}:i))}catch{}},_=async t=>{try{const n=await h.post(`/social/like/${t}`);a(d=>d.map(i=>{var N,j;return i.id===t?{...i,liked:!!((N=n.data)!=null&&N.liked),likes_count:Number(((j=n.data)==null?void 0:j.likes_count)||0)}:i}))}catch{}},B=async t=>{try{const n=await h.get(`/social/comment/${t}`);f(d=>{var i;return{...d,[t]:((i=n.data)==null?void 0:i.comments)||[]}})}catch{f(n=>({...n,[t]:[]}))}},F=async t=>{const n=String(o[t]||"").trim();if(n)try{await h.post(`/social/comment/${t}`,{text:n}),p(d=>({...d,[t]:""})),a(d=>d.map(i=>i.id===t?{...i,comments_count:Number(i.comments_count||0)+1}:i)),await B(t)}catch{}};return r.length===0?e.jsxs("div",{className:"space-y-3",children:[u.length>0&&e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Athletes to Follow"}),e.jsx("div",{className:"space-y-2 mt-3",children:u.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:t.name}),e.jsxs("button",{onClick:()=>c(t.id,!!t.is_following),className:"rounded-lg px-3 py-1.5 text-xs font-semibold flex items-center gap-1",style:{background:"var(--accent)",color:"#000"},children:[t.is_following?e.jsx(C,{size:13}):e.jsx($,{size:13}),t.is_following?"Following":"Follow"]})]},t.id))})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{background:"#1a1d2e",border:"1px solid #2a2d3e"},children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"#EAB308"},children:"Inspiration Mode"}),e.jsx("div",{className:"space-y-2 mt-3",children:T.slice(0,4).map((t,n)=>e.jsxs("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:['"',t,'"']},n))}),e.jsx("button",{onClick:()=>s("/log-run"),className:"mt-4 rounded-lg px-3 py-2 text-xs font-bold",style:{background:"#EAB308",color:"#0f1117"},children:"Be the first to share"})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Your Highlights"}),e.jsxs("div",{className:"space-y-2 mt-3",children:[g.map(t=>e.jsxs("div",{className:"rounded-lg p-2",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:t.title}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(t.sub).toLocaleDateString()})]},t.id)),g.length===0&&e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"No recent workouts yet."})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[u.length>0&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Athletes to Follow"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:u.slice(0,6).map(t=>e.jsxs("button",{onClick:()=>c(t.id,!!t.is_following),className:"rounded-full px-3 py-1.5 text-xs font-semibold flex items-center gap-1",style:{background:t.is_following?"var(--bg-input)":"var(--accent)",color:t.is_following?"var(--text-primary)":"#000"},children:[t.is_following?e.jsx(C,{size:13}):e.jsx($,{size:13}),t.name]},t.id))})]}),r.map(t=>{var j;const n=t.type==="run"?t.data||{}:{},d=t.type==="lift"?t.data||{}:{},i=t.type==="achievement"?t.data||{}:{},N=t.type==="run"?`${Number(n.distance_miles||0).toFixed(2)} mi · ${n.run_type||"run"}`:t.type==="lift"?`${d.exercise_name||"Strength session"}${d.sets?` · ${d.sets} sets`:""}`:t.type==="achievement"?`${i.badge_name||"New badge unlocked"}`:((j=t.data)==null?void 0:j.text)||"Activity update";return e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:[t.user_name||"Athlete"," · ",String(t.type||"activity").replace("_"," ")]}),t.user_id&&e.jsxs("button",{onClick:()=>c(t.user_id,!!t.is_following),className:"rounded-lg px-2 py-1 text-xs font-semibold flex items-center gap-1",style:{background:t.is_following?"var(--bg-input)":"var(--accent)",color:t.is_following?"var(--text-primary)":"#000"},children:[t.is_following?e.jsx(C,{size:12}):e.jsx($,{size:12}),t.is_following?"Following":"Follow"]})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:N}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)"},children:new Date(t.created_at).toLocaleDateString()}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>_(t.id),className:"flex items-center gap-1 text-xs",style:{color:t.liked?"#EAB308":"var(--text-muted)"},children:[e.jsx(z,{size:13,fill:t.liked?"#EAB308":"none"}),Number(t.likes_count||0)]}),e.jsxs("button",{onClick:async()=>{const m=!k[t.id];b(S=>({...S,[t.id]:m})),m&&await B(t.id)},className:"flex items-center gap-1 text-xs",style:{color:"var(--text-muted)"},children:[e.jsx(E,{size:13}),Number(t.comments_count||0)]})]}),k[t.id]&&e.jsxs("div",{className:"mt-3 space-y-2",children:[(v[t.id]||[]).map(m=>e.jsxs("div",{className:"rounded-lg p-2",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs font-semibold",style:{color:"var(--text-primary)"},children:m.user_name||"Athlete"}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:m.text})]},m.id)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:o[t.id]||"",onChange:m=>p(S=>({...S,[t.id]:m.target.value})),placeholder:"Add comment",className:"flex-1 rounded-lg px-2 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}}),e.jsx("button",{onClick:()=>F(t.id),className:"rounded-lg px-2 py-1.5 text-xs font-semibold",style:{background:"var(--accent)",color:"#000"},children:"Send"})]})]})]},t.id)}),r.length===0&&e.jsx("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Follow athletes to populate your feed."})})]})}function P(){const[s,r]=x.useState("popular"),[a,u]=x.useState(""),[y,g]=x.useState([]);return x.useEffect(()=>{h.get("/community/workouts",{params:{sort:s,target:a||void 0}}).then(l=>{var o;return g(((o=l.data)==null?void 0:o.workouts)||[])}).catch(()=>g([]))},[s,a]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[["popular","newest"].map(l=>e.jsx("button",{onClick:()=>r(l),className:"rounded-full px-3 py-1 text-xs font-semibold",style:{background:s===l?"var(--accent)":"var(--bg-input)",color:s===l?"#000":"var(--text-muted)"},children:l==="popular"?"Popular":"Newest"},l)),e.jsx("input",{value:a,onChange:l=>u(l.target.value),placeholder:"By body part",className:"rounded-full px-3 py-1 text-xs",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}})]}),y.map(l=>e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"font-semibold",style:{color:"var(--text-primary)"},children:l.workout_name}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[l.target," · Used ",l.usage_count||0," times"]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:(l.main||[]).slice(0,2).map(o=>o.name||o).join(" · ")}),e.jsx("button",{onClick:()=>h.post(`/community/workouts/${l.id}/save`).catch(()=>{}),className:"mt-2 rounded-lg px-3 py-1.5 text-xs font-semibold",style:{background:"var(--accent)",color:"#000"},children:"Save to My Plan"})]},l.id)),y.length===0&&e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No workouts found yet."})]})}function U(){const[s,r]=x.useState([]),[a,u]=x.useState("newest"),[y,g]=x.useState(!1);x.useEffect(()=>{g(!0),h.get("/routes",{params:{sort:a==="popular"?"popular":"newest"}}).then(o=>{var p;return r(((p=o.data)==null?void 0:p.routes)||[])}).catch(()=>r([])).finally(()=>g(!1))},[a]);const l=async o=>{try{const p=await h.post(`/routes/${o}/like`);r(k=>k.map(b=>{var v,f;return b.id===o?{...b,liked:(v=p.data)==null?void 0:v.liked,likes_count:((f=p.data)==null?void 0:f.likes_count)??b.likes_count}:b}))}catch(p){console.error("Failed to toggle like",p)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2",children:["newest","popular"].map(o=>e.jsx("button",{onClick:()=>u(o),className:"rounded-full px-3 py-1 text-xs font-semibold",style:{background:a===o?"var(--accent)":"var(--bg-input)",color:a===o?"#000":"var(--text-muted)"},children:o==="newest"?"Newest":"Popular"},o))}),y&&e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Loading routes..."}),!y&&s.length===0&&e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No shared routes yet. Be the first to post one!"}),s.map(o=>e.jsx(W,{route:o,onLike:l},o.id))]})}function W({route:s,onLike:r}){const a=u=>{if(!u)return"--";const y=Math.floor(u/60),g=Math.round(u%60);return`${y}:${String(g).padStart(2,"0")} /mi`};return e.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:16,padding:16,border:"1px solid var(--border-subtle)",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",margin:0},children:s.title}),e.jsxs("p",{style:{fontSize:12,color:"var(--text-muted)",margin:"2px 0 0"},children:["by ",s.runner_name||"Athlete"," ",s.city?`· ${s.city}`:""]})]}),e.jsxs("button",{onClick:()=>r(s.id),style:{background:s.liked?"rgba(234,179,8,0.15)":"var(--bg-input)",border:`1px solid ${s.liked?"#EAB308":"var(--border-subtle)"}`,borderRadius:8,padding:"4px 10px",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[e.jsx(z,{size:14,color:s.liked?"#EAB308":"var(--text-muted)",fill:s.liked?"#EAB308":"none"}),e.jsx("span",{style:{fontSize:12,color:s.liked?"#EAB308":"var(--text-muted)"},children:s.likes_count})]})]}),e.jsxs("div",{style:{display:"flex",gap:16,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:18,fontWeight:800,color:"var(--text-primary)",margin:0},children:Number(s.distance_miles||0).toFixed(2)}),e.jsx("p",{style:{fontSize:10,color:"var(--text-muted)",margin:0},children:"miles"})]}),s.avg_pace&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:18,fontWeight:800,color:"var(--text-primary)",margin:0},children:a(s.avg_pace)}),e.jsx("p",{style:{fontSize:10,color:"var(--text-muted)",margin:0},children:"avg pace"})]}),s.surface&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:14,fontWeight:600,color:"var(--text-muted)",margin:"4px 0 0",textTransform:"capitalize"},children:s.surface}),e.jsx("p",{style:{fontSize:10,color:"var(--text-muted)",margin:0},children:"surface"})]})]}),s.route_coords&&s.route_coords.length>=2&&e.jsx(H,{coords:s.route_coords})]})}function H({coords:s}){if(!s||s.length===0)return null;const r=s.map(c=>Array.isArray(c)?{lat:c[0],lon:c[1]}:{lat:Number(c.lat),lon:Number(c.lon)}),a=r.map(c=>c.lat),u=r.map(c=>c.lon),y=Math.min(...a),g=Math.max(...a),l=Math.min(...u),o=Math.max(...u),p=10,k=280,b=100,v=c=>p+(c-l)/(o-l||1)*(k-p*2),f=c=>p+(g-c)/(g-y||1)*(b-p*2),w=r.map((c,_)=>`${_===0?"M":"L"}${v(c.lon).toFixed(1)},${f(c.lat).toFixed(1)}`).join(" ");return e.jsx("div",{style:{borderRadius:10,overflow:"hidden",background:"#111",marginTop:8},children:e.jsxs("svg",{viewBox:`0 0 ${k} ${b}`,style:{width:"100%",height:100,display:"block"},children:[e.jsx("path",{d:w,fill:"none",stroke:"#EAB308",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:v(r[0].lon),cy:f(r[0].lat),r:"4",fill:"#22c55e"}),e.jsx("circle",{cx:v(r[r.length-1].lon),cy:f(r[r.length-1].lat),r:"4",fill:"#ef4444"})]})})}export{Q as default};
