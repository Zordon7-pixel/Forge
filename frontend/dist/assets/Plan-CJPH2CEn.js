import{b as I,e as P,r as n,a as i,j as e}from"./index-BaOvKJ5T.js";const T={run:{background:"var(--accent-dim)",color:"var(--accent)"},rest:{background:"rgba(107,114,128,0.15)",color:"var(--text-muted)"},"cross-train":{background:"rgba(245,158,11,0.18)",color:"#f59e0b"},strength:{background:"var(--accent-dim)",color:"var(--accent)"}};function A(){var v,j;const y=I(),N=P(),[a,w]=n.useState(null),[S,R]=n.useState(!0),[m,b]=n.useState(!1),[l,C]=n.useState({}),[d,D]=n.useState(null),[L,h]=n.useState(null),g=async()=>{var t;try{const[s,r]=await Promise.all([i.get("/plans/current"),i.get("/plans/compliance").catch(()=>({data:null}))]);w(((t=s.data)==null?void 0:t.plan)||s.data||null),D(r.data)}finally{R(!1)}};n.useEffect(()=>{g()},[]);const _=!!((v=N.state)!=null&&v.suggestEasyDay),p=n.useMemo(()=>{var t,s,r;if((r=(s=(t=a==null?void 0:a.plan_json)==null?void 0:t.weeks)==null?void 0:s[0])!=null&&r.days)return a.plan_json.weeks[0].days;if(!(a!=null&&a.weekly_structure))return[];if(Array.isArray(a.weekly_structure))return a.weekly_structure;try{return JSON.parse(a.weekly_structure)}catch{return[]}},[a]);n.useEffect(()=>{p.filter(s=>{const r=(s.workout_type||s.type||"").toLowerCase();return!r.includes("rest")&&!r.includes("strength")&&!r.includes("cross")}).forEach((s,r)=>{i.get(`/ai/run-brief?sessionId=${s.id||r}`).then(x=>{C(o=>({...o,[s.id||r]:x.data}))}).catch(()=>{})})},[p]);const f=async()=>{b(!0);try{await i.post("/plans/generate"),await g()}finally{b(!1)}},E=new Date().toLocaleDateString("en-US",{weekday:"long"});return S?e.jsx("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",color:"var(--text-muted)"},children:"Loading your training data..."}):a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:a.title||"Your Plan"}),e.jsxs("p",{className:"mt-1 text-sm",style:{color:"var(--text-muted)"},children:["Goal: ",a.goal||"--"]})]}),_&&e.jsx("div",{className:"rounded-xl p-3",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Recovery suggestion: replace today with an easy 20-30 minute run."})}),((j=d==null?void 0:d.missed)==null?void 0:j.length)>0&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-sm font-semibold mb-2",style:{color:"var(--text-primary)"},children:"Missed sessions"}),e.jsx("div",{className:"space-y-2",children:d.missed.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[t.day," · ",t.type," ",t.distance?`· ${t.distance} mi`:""]}),e.jsx("button",{onClick:async()=>{h(t.sessionId),await i.post("/plans/reschedule-missed",{originalDate:t.date,sessionId:t.sessionId}),await g(),h(null)},className:"rounded-lg px-2 py-1 text-xs font-semibold",style:{background:"var(--accent)",color:"#000"},children:L===t.sessionId?"Rescheduling...":"Reschedule"})]},t.sessionId))})]}),e.jsx("div",{className:"space-y-3",children:p.map((t,s)=>{const r=(t.workout_type||t.type||"").toString().toLowerCase(),x=r.includes("cross")?"cross-train":r.includes("strength")?"strength":r.includes("rest")?"rest":"run",o=(t.day||"").toLowerCase().includes(E.toLowerCase());return e.jsxs("div",{className:"rounded-xl border p-4",style:o?{borderColor:"var(--accent)",background:"linear-gradient(135deg, rgba(234,179,8,0.12) 0%, var(--bg-card) 100%)"}:{borderColor:"var(--border-subtle)",background:"var(--bg-card)"},children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold",style:{color:"var(--text-primary)"},children:t.day||`Day ${s+1}`}),o?e.jsx("span",{className:"rounded-full px-2 py-0.5 text-xs font-bold",style:{background:"var(--accent)",color:"black"},children:"TODAY"}):null]}),e.jsx("span",{className:"rounded-full px-2 py-1 text-xs",style:T[x],children:t.workout_type||t.type||"Run"})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:t.description||"No description."}),l[t.id||s]&&e.jsxs("div",{className:"mt-2 rounded-lg p-2",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-primary)"},children:l[t.id||s].why}),e.jsxs("p",{className:"text-[11px]",style:{color:"var(--text-muted)"},children:["Effort: ",l[t.id||s].effort," · BPM: ",l[t.id||s].bpmRange," · Cadence: ",l[t.id||s].cadence]})]}),o&&e.jsx("div",{style:{marginTop:12},children:(()=>{const u=(t.workout_type||t.type||"").toLowerCase(),c=u.includes("rest"),k=u.includes("strength")||u.includes("lift")||u.includes("cross");return e.jsx("button",{onClick:()=>{c||y(k?"/log-lift":"/log-run")},style:{width:"100%",padding:"14px",background:c?"var(--bg-input)":"var(--accent)",color:c?"var(--text-muted)":"#000",fontWeight:900,fontSize:15,borderRadius:12,border:"none",cursor:c?"default":"pointer"},children:c?"Rest Day — Take it easy":k?"Log Workout":"Start Run"})})()})]},s)})}),e.jsx("button",{onClick:f,disabled:m,className:"w-full rounded-xl border py-3 font-semibold disabled:opacity-60",style:{borderColor:"var(--border-subtle)",background:"var(--bg-card)",color:"var(--text-primary)"},children:m?"Regenerating...":"Regenerate Plan"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx("img",{src:"/empty-plan.png",alt:"",className:"w-64 h-64 object-contain"}),e.jsx("p",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:"No training plan yet."}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Generate one to get started."}),e.jsx("button",{onClick:f,className:"mt-2 rounded-xl px-6 py-3 font-semibold text-black",style:{background:"var(--accent)"},children:"Generate Plan"})]})}export{A as default};
