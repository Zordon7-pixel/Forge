import{r as c,j as a,a as u}from"./index-B0TFXbO8.js";const y={"5K":3.1,"10K":6.2,Half:13.1,Full:26.2,Other:null};function b(n){const o=new Date(`${n}T12:00:00`).getTime()-Date.now();return Math.ceil(o/864e5)}function w(){const[n,o]=c.useState([]),[s,l]=c.useState({race_name:"",race_date:"",distance_key:"5K",distance_miles:3.1,location:"",goal_time:""}),[m,p]=c.useState(""),[r,d]=c.useState(null),x=()=>u.get("/races").then(e=>o(e.data.races||[]));c.useEffect(()=>{x()},[]);const _=c.useMemo(()=>n.filter(e=>e.status==="upcoming").sort((e,t)=>e.race_date.localeCompare(t.race_date)),[n]),h=c.useMemo(()=>n.filter(e=>e.status!=="upcoming").sort((e,t)=>t.race_date.localeCompare(e.race_date)),[n]),v=async e=>{e.preventDefault();const t=s.goal_time?s.goal_time.split(":").reduce((f,k)=>f*60+Number(k),0):null,j={race_name:s.race_name,race_date:s.race_date,distance_miles:Number(s.distance_miles),location:s.location,goal_time_seconds:t},N=await u.post("/races",j);p("Race added");const g=N.data.race,i=b(g.race_date);i>0&&i<=60&&d({race:g,days:i}),l({race_name:"",race_date:"",distance_key:"5K",distance_miles:3.1,location:"",goal_time:""}),x()};return a.jsxs("div",{className:"space-y-4",children:[a.jsx("h1",{className:"text-2xl font-black",style:{color:"var(--text-primary)"},children:"Races"}),r&&a.jsxs("div",{className:"rounded-xl p-4",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[a.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:["With ",r.days," days to your ",r.race.race_name,", I'd suggest a taper starting 2 weeks out. Want me to adjust your plan?"]}),a.jsxs("div",{className:"flex gap-2 mt-3",children:[a.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},onClick:async()=>{await u.post("/plans/race-adjust",{raceId:r.race.id}),d(null),p("Plan adjusted for race taper")},children:"Adjust Plan"}),a.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},onClick:()=>d(null),children:"Not now"})]})]}),a.jsxs("form",{onSubmit:v,className:"rounded-xl p-4 space-y-3",style:{background:"var(--bg-card)"},children:[a.jsx("p",{className:"text-sm font-semibold",children:"Add Race"}),a.jsx("input",{className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Race name",value:s.race_name,onChange:e=>l({...s,race_name:e.target.value}),required:!0}),a.jsx("input",{type:"date",className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},value:s.race_date,onChange:e=>l({...s,race_date:e.target.value}),required:!0}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("select",{className:"rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},value:s.distance_key,onChange:e=>{const t=e.target.value;l({...s,distance_key:t,distance_miles:y[t]??s.distance_miles})},children:Object.keys(y).map(e=>a.jsx("option",{children:e},e))}),a.jsx("input",{type:"number",step:"0.1",className:"rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Miles",value:s.distance_miles,onChange:e=>l({...s,distance_miles:e.target.value}),required:!0})]}),a.jsx("input",{className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Location",value:s.location,onChange:e=>l({...s,location:e.target.value})}),a.jsx("input",{className:"w-full rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},placeholder:"Goal time (hh:mm:ss)",value:s.goal_time,onChange:e=>l({...s,goal_time:e.target.value})}),a.jsx("button",{className:"rounded-lg px-4 py-2 font-bold",style:{background:"var(--accent)",color:"#000"},children:"Save Race"}),m&&a.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:m})]}),a.jsxs("section",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm font-semibold",children:"Upcoming"}),_.map(e=>{const t=b(e.race_date);return a.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)"},children:[a.jsx("p",{className:"font-bold",children:e.race_name}),a.jsxs("p",{className:"text-xs",style:{color:"var(--accent)"},children:[t," days to go"]}),a.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[e.distance_miles," mi ",e.location?`Â· ${e.location}`:""]})]},e.id)})]}),a.jsxs("section",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm font-semibold",children:"Past"}),h.map(e=>a.jsx("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)"},children:a.jsx("p",{className:"font-semibold",children:e.race_name})},e.id))]})]})}export{w as default};
