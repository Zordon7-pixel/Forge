import{r as i,j as e,A as N,a as p}from"./index-BY6vNrGT.js";import{d as P,e as F,s as M}from"./validation-CCcprX5w.js";import{T as R}from"./triangle-alert--kcHDZIe.js";import{C as w}from"./circle-check-5-x0qrih.js";const $=["knee","hip","ankle","shin","calf","hamstring","lower back","shoulder","other"];function u(a){return a<=3?"#22c55e":a<=6?"#EAB308":"#ef4444"}function C(a){if(!a)return"";const[n,x,l]=a.split("-");return`${x}/${l}/${n}`}function q(){const a=new Date().toISOString().slice(0,10),[n,x]=i.useState([]),[l,B]=i.useState([]),[j,A]=i.useState([]),[E,T]=i.useState(!0),[d,S]=i.useState(!1),[y,g]=i.useState(""),[c,_]=i.useState({}),z=i.useRef(null),k=i.useRef(null),[r,o]=i.useState({body_part:"",pain_level:"",notes:"",date:a}),b=async()=>{try{const[t,s]=await Promise.all([p.get("/injury/active"),p.get("/injury")]);x(t.data.injuries||[]);const m=s.data.injuries||[];A(m),B(m.filter(L=>L.cleared===1))}catch{}T(!1)};i.useEffect(()=>{b()},[]);const I=i.useMemo(()=>P({bodyPart:r.body_part,injuries:j}),[r.body_part,j]),W=async t=>{t.preventDefault();const{errors:s}=F({bodyPart:r.body_part,severity:r.pain_level});if(_(s),Object.keys(s).length){M({body_part:z,pain_level:k},["body_part","pain_level"]);return}S(!0);try{await p.post("/injury",{body_part:r.body_part,pain_level:Number(r.pain_level),notes:r.notes,date:r.date}),o({body_part:"",pain_level:"",notes:"",date:a}),_({}),g("Injury logged"),await b(),setTimeout(()=>g(""),2e3)}catch{g("Failed to log injury")}S(!1)},D=async t=>{try{await p.put(`/injury/${t}/clear`),await b()}catch{}},f={background:"var(--bg-card)",borderRadius:16,padding:20,marginBottom:12,border:"1px solid var(--border-subtle)"},h={fontSize:11,fontWeight:700,color:"var(--text-muted)",letterSpacing:1,textTransform:"uppercase",marginBottom:14,display:"flex",alignItems:"center",gap:6},v={background:"var(--bg-input)",border:"1px solid var(--border-subtle)",borderRadius:10,padding:"12px 14px",fontSize:14,color:"var(--text-primary)",width:"100%",boxSizing:"border-box"};return E?e.jsx("div",{style:{background:"var(--bg-card)",borderRadius:16,padding:20,color:"var(--text-muted)"},children:"Loading..."}):e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:24,fontWeight:900,color:"var(--text-primary)",marginBottom:16},children:"Injury Log"}),e.jsxs("div",{style:f,children:[e.jsxs("div",{style:h,children:[e.jsx(R,{size:14,color:"#EAB308"}),"Active Injuries"]}),n.length===0?e.jsx("p",{style:{fontSize:14,color:"var(--text-muted)"},children:"No active injuries"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:n.map(t=>e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:12,padding:14,border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",textTransform:"capitalize"},children:String(t.body_part||"").replace(/_/g," ")}),e.jsxs("span",{style:{fontSize:12,fontWeight:700,color:"#000",background:u(t.pain_level),borderRadius:20,padding:"2px 10px"},children:["Pain ",t.pain_level,"/10"]})]}),e.jsx("span",{style:{fontSize:11,color:"var(--text-muted)"},children:C(t.date)})]}),t.notes&&e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginBottom:10,lineHeight:1.4},children:t.notes}),e.jsxs("button",{onClick:()=>D(t.id),style:{display:"flex",alignItems:"center",gap:6,background:"rgba(34,197,94,0.1)",border:"1px solid rgba(34,197,94,0.3)",borderRadius:8,padding:"6px 12px",fontSize:13,fontWeight:600,color:"#22c55e",cursor:"pointer"},children:[e.jsx(w,{size:14}),"Mark Cleared"]})]},t.id))})]}),e.jsxs("div",{style:f,children:[e.jsxs("div",{style:h,children:[e.jsx(R,{size:14}),"Log New Injury"]}),e.jsxs("form",{onSubmit:W,style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:"Body Part"}),e.jsxs("select",{value:r.body_part,onChange:t=>o(s=>({...s,body_part:t.target.value})),style:v,children:[e.jsx("option",{value:"",children:"Select body part"}),$.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]}),c.body_part&&e.jsx("p",{ref:z,style:{fontSize:12,color:"#ef4444",marginTop:6},children:c.body_part}),I&&e.jsx("p",{style:{fontSize:12,color:"#f59e0b",marginTop:6},children:I})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:["Pain Level: ",e.jsxs("span",{style:{fontWeight:700,color:u(Number(r.pain_level)||1)},children:[Number(r.pain_level)||1,"/10"]})]}),e.jsx("input",{type:"range",min:1,max:10,step:1,value:r.pain_level||1,onChange:t=>o(s=>({...s,pain_level:Number(t.target.value)})),style:{width:"100%",accentColor:u(Number(r.pain_level)||1)}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:2},children:[e.jsx("span",{style:{fontSize:11,color:"#22c55e"},children:"1 Mild"}),e.jsx("span",{style:{fontSize:11,color:"#EAB308"},children:"5 Moderate"}),e.jsx("span",{style:{fontSize:11,color:"#ef4444"},children:"10 Severe"})]}),c.pain_level&&e.jsx("p",{ref:k,style:{fontSize:12,color:"#ef4444",marginTop:6},children:c.pain_level})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:"Date"}),e.jsx("input",{type:"date",value:r.date,onChange:t=>o(s=>({...s,date:t.target.value})),style:v})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:"Notes"}),e.jsx("textarea",{rows:3,placeholder:"Describe the injury, when it started, what aggravates it...",value:r.notes,onChange:t=>o(s=>({...s,notes:t.target.value})),style:{...v,resize:"vertical"}})]}),y&&e.jsx("p",{style:{fontSize:13,color:y.startsWith("Failed")?"#ef4444":"#22c55e"},children:y}),e.jsx("button",{type:"submit",disabled:d,style:{background:"#EAB308",color:"#000",border:"none",borderRadius:10,padding:"12px 0",fontSize:15,fontWeight:700,cursor:d?"not-allowed":"pointer",opacity:d?.7:1},children:d?"Logging...":"Log Injury"})]})]}),e.jsxs("div",{style:f,children:[e.jsxs("div",{style:h,children:[e.jsx(N,{size:14}),"Injury History"]}),l.length===0?e.jsx("p",{style:{fontSize:14,color:"var(--text-muted)"},children:"No injury history yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:l.map(t=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",background:"var(--bg-base)",borderRadius:10,border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(w,{size:14,color:"#22c55e"}),e.jsx("span",{style:{fontSize:14,fontWeight:600,color:"var(--text-primary)",textTransform:"capitalize"},children:String(t.body_part||"").replace(/_/g," ")}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,color:"#000",background:u(t.pain_level),borderRadius:20,padding:"1px 8px"},children:[t.pain_level,"/10"]})]}),e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:C(t.date)})]},t.id))})]})]})}export{q as default};
