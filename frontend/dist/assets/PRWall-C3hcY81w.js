import{r as c,j as e,a as x}from"./index-xcBp2yTO.js";import{L as X}from"./LoadingRunner-D_xQNgIC.js";import{P as B}from"./pencil-DibQxkFa.js";const u={background:"var(--bg-card)",borderRadius:16,padding:"16px",border:"1px solid var(--border-subtle)"},L=["Best Bench Press","Best Squat","Best Deadlift"],v=[{label:"1 Mile PR",unit:"min/mi"},{label:"5K PR",unit:"min/mi"},{label:"10K PR",unit:"min/mi"},{label:"Half Marathon PR",unit:"min/mi"},{label:"Marathon PR",unit:"min/mi"},{label:"Longest Run",unit:"mi"},{label:"Fastest Mile",unit:"min/mi"},{label:"Best Avg Pace",unit:"min/mi"},{label:"Most Miles in a Week",unit:"mi"}],k=[{label:"Best Bench Press",unit:"lbs"},{label:"Best Squat",unit:"lbs"},{label:"Best Deadlift",unit:"lbs"},{label:"Best Overhead Press",unit:"lbs"},{label:"Best Pull-Up",unit:"reps"},{label:"Best Barbell Row",unit:"lbs"},{label:"Best Incline Press",unit:"lbs"},{label:"Best Leg Press",unit:"lbs"},{label:"Best Hip Thrust",unit:"lbs"},{label:"Best Dumbbell Curl",unit:"lbs"}];function C(l){const a=((l==null?void 0:l.unit)||"").toLowerCase(),i=Number((l==null?void 0:l.value)||0);if(a==="min/mi"){const b=Math.floor(i),R=Math.round((i-b)*60);return`${b}:${String(R).padStart(2,"0")} min/mi`}return a==="mi"?`${i.toFixed(2)} mi`:a==="lbs"||a==="lb"?`${Math.round(i)} lbs`:a==="reps"||a==="rep"?`${Math.round(i)} reps`:`${i} ${(l==null?void 0:l.unit)||""}`.trim()}function $(l){if(!l||l<0)return"--";const a=Math.floor(l/3600),i=Math.floor(l%3600/60),b=Math.round(l%60);return a>0?`${a}:${String(i).padStart(2,"0")}:${String(b).padStart(2,"0")}`:`${i}:${String(b).padStart(2,"0")}`}function Z(l,a){return!l||!a||a<=0?null:l/60/a}function ee(l){if(!l)return 0;const a=l.split(":").map(i=>parseInt(i,10));return a.length===3?a[0]*3600+a[1]*60+a[2]:a.length===2?a[0]*60+a[1]:parseInt(l,10)||0}function te(l){return l?l<3.5:!1}function ae(){const[l,a]=c.useState([]),[i,b]=c.useState(0),[R,I]=c.useState([]),[W,M]=c.useState(!0),[_,g]=c.useState(""),[E,y]=c.useState(!1),[A,j]=c.useState(null),[S,f]=c.useState({time_hms:"",date:new Date().toISOString().slice(0,10)}),[n,p]=c.useState({category:"run",label:v[0].label,value:"",unit:v[0].unit,achieved_at:new Date().toISOString().slice(0,10),notes:""}),P=async()=>{var t,r,s,o,d,m,h;M(!0),g("");try{const D=((t=(await x.get("/runs?limit=1")).data)==null?void 0:t.runs)||[];(r=D[0])!=null&&r.id&&await x.post("/prs/auto-detect",{run_id:D[0].id}).catch(()=>{});const[H,K,q]=await Promise.all([x.get("/prs"),x.get("/runs"),x.get("/prs/time").catch(()=>({data:{times:[]}}))]),U=((s=H.data)==null?void 0:s.prs)||[],G=((o=K.data)==null?void 0:o.runs)||[],V=((d=q.data)==null?void 0:d.times)||[],Y=G.reduce((J,Q)=>J+(Number(Q.distance_miles)||0),0);a(U),I(V),b(Y)}catch(N){g(((h=(m=N==null?void 0:N.response)==null?void 0:m.data)==null?void 0:h.error)||"Could not load PRs right now.")}finally{M(!1)}};c.useEffect(()=>{P()},[]);const z=c.useMemo(()=>l.filter(t=>t.category==="run"),[l]),T=c.useMemo(()=>l.filter(t=>t.category==="lift"),[l]),F=async t=>{var r,s;t.preventDefault();try{await x.post("/prs",{...n,value:Number(n.value)}),y(!1),p({category:"run",label:"",value:"",unit:"mi",achieved_at:new Date().toISOString().slice(0,10),notes:""}),await P()}catch(o){g(((s=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:s.error)||"Could not add PR.")}},w=async t=>{try{await x.delete(`/prs/${t}`),a(r=>r.filter(s=>s.id!==t))}catch{g("Could not delete PR.")}},O=async(t,r)=>{var s,o;try{const d=ee(S.time_hms);if(d<=0){g("Invalid time format");return}await x.post("/prs/manual",{distance_miles:r,time_seconds:d,date:S.date}),j(null),f({time_hms:"",date:new Date().toISOString().slice(0,10)}),await P()}catch(d){g(((o=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:o.error)||"Could not save time PR.")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-5 flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black",style:{color:"var(--text-primary)"},children:"PR Wall"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Your best performances, ever."})]}),e.jsx("button",{onClick:()=>y(!0),className:"rounded-xl px-4 py-2 text-sm font-bold",style:{background:"var(--accent)",color:"#000"},children:"+ Add PR"})]}),_&&e.jsx("p",{className:"mb-4 text-sm",style:{color:"var(--accent)"},children:_}),W?e.jsx(X,{message:"Loading records"}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"mb-6",children:[e.jsx("h2",{className:"mb-3 text-lg font-bold",children:"Running PRs"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{style:u,children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Total Miles"}),e.jsxs("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:[i.toFixed(2)," mi"]}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:"All-time running volume"})]}),z.length===0?e.jsx("div",{style:u,children:e.jsx("p",{style:{color:"var(--text-muted)"},children:"No running PRs yet. Log a run or add one manually."})}):z.map(t=>e.jsxs("div",{style:u,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:t.label}),t.run_id?e.jsx("span",{className:"rounded-full px-2 py-0.5 text-[10px] font-bold",style:{background:"rgba(234,179,8,0.2)",color:"var(--accent)"},children:"Auto"}):e.jsx("button",{onClick:()=>w(t.id),className:"text-xs",style:{color:"var(--text-muted)"},children:"Delete"})]}),e.jsx("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:C(t)}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:new Date(t.achieved_at).toLocaleDateString()})]},t.id))]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h2",{className:"mb-3 text-lg font-bold",children:"Time PRs"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:[{label:"1 Mile",target:1},{label:"5K",target:3.107},{label:"10K",target:6.214},{label:"15K",target:9.321},{label:"Half Marathon",target:13.109},{label:"Marathon",target:26.219}].map(t=>{const r=R.find(m=>m.distance===t.label);if(A===t.label)return e.jsxs("div",{style:u,children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:t.label}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx("input",{type:"text",placeholder:"HH:MM:SS or MM:SS",value:S.time_hms,onChange:m=>f(h=>({...h,time_hms:m.target.value})),className:"w-full rounded-lg border px-2 py-1 text-sm",style:{borderColor:"var(--border-subtle)",background:"var(--bg-input)",color:"var(--text-primary)"}}),e.jsx("input",{type:"date",value:S.date,onChange:m=>f(h=>({...h,date:m.target.value})),className:"w-full rounded-lg border px-2 py-1 text-sm",style:{borderColor:"var(--border-subtle)",background:"var(--bg-input)",color:"var(--text-primary)"}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>O(t.label,t.target),className:"flex-1 rounded-lg px-2 py-1 text-xs font-bold",style:{background:"var(--accent)",color:"#000",border:"none",cursor:"pointer"},children:"Save"}),e.jsx("button",{onClick:()=>{j(null),f({time_hms:"",date:new Date().toISOString().slice(0,10)})},className:"flex-1 rounded-lg border px-2 py-1 text-xs",style:{borderColor:"var(--border-subtle)",color:"var(--text-muted)",background:"none",cursor:"pointer"},children:"Cancel"})]})]})]},t.label);if(!r||!r.best_time_seconds)return e.jsxs("div",{style:u,children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:1},children:t.label}),e.jsx("button",{onClick:()=>{j(t.label),f({time_hms:"",date:new Date().toISOString().slice(0,10)})},className:"rounded-lg p-1.5",style:{background:"transparent",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:e.jsx(B,{size:14})})]}),e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-muted)"},children:"--"}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:"No PR yet â€” log a run to set it"})]},t.label);const s=Z(r.best_time_seconds,t.target),o=s?`${Math.floor(s)}:${String(Math.round((s-Math.floor(s))*60)).padStart(2,"0")}/mi`:"N/A",d=te(s);return e.jsxs("div",{style:u,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:1},children:t.label}),e.jsx("button",{onClick:()=>{j(t.label),f({time_hms:$(r.best_time_seconds),date:r.date})},className:"rounded-lg p-1.5",style:{background:"transparent",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:e.jsx(B,{size:14})})]}),e.jsx("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:$(r.best_time_seconds)}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)"},children:o}),d&&e.jsx("span",{style:{fontSize:10,color:"var(--accent)"},children:"(check data)"})]}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:new Date(r.date).toLocaleDateString()})]},t.label)})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"mb-3 text-lg font-bold",children:"Lifting PRs"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[L.map(t=>{const r=T.find(o=>o.label===t),s=()=>{p({category:"lift",label:t,value:r?String(r.value):"",unit:"lbs",achieved_at:new Date().toISOString().slice(0,10),notes:""}),y(!0)};return r?e.jsxs("div",{style:u,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:r.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s,className:"rounded-lg px-3 py-1 text-xs font-bold",style:{background:"var(--accent)",color:"#000",border:"none",cursor:"pointer"},children:"Update"}),!r.lift_id&&e.jsx("button",{onClick:()=>w(r.id),className:"text-xs",style:{color:"var(--text-muted)",background:"none",border:"none",cursor:"pointer"},children:"Delete"})]})]}),e.jsx("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:C(r)}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:new Date(r.achieved_at).toLocaleDateString()})]},r.id):e.jsxs("div",{style:u,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:1},children:t}),e.jsx("button",{onClick:s,className:"rounded-lg px-3 py-1 text-xs font-bold",style:{background:"var(--accent)",color:"#000",border:"none",cursor:"pointer"},children:"+ Add"})]}),e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-muted)"},children:"--"}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:"No record yet"})]},t)}),T.filter(t=>!L.includes(t.label)).map(t=>e.jsxs("div",{style:u,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:t.label}),!t.lift_id&&e.jsx("button",{onClick:()=>w(t.id),className:"text-xs",style:{color:"var(--text-muted)"},children:"Delete"})]}),e.jsx("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:C(t)}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:new Date(t.achieved_at).toLocaleDateString()})]},t.id))]})]})]}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{background:"rgba(0,0,0,0.75)"},children:e.jsxs("div",{className:"w-full rounded-t-2xl p-5 pb-10",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("h3",{className:"text-xl font-black mb-4",style:{color:"var(--text-primary)"},children:"Add Personal Record"}),e.jsxs("form",{className:"space-y-3",onSubmit:F,children:[e.jsx("div",{className:"flex gap-2",children:[{val:"run",label:"Running"},{val:"lift",label:"Lifting"}].map(t=>e.jsx("button",{type:"button",onClick:()=>{const r=t.val==="run"?v:k;p(s=>({...s,category:t.val,label:r[0].label,unit:r[0].unit}))},style:{flex:1,padding:"10px 0",borderRadius:12,fontWeight:700,fontSize:14,background:n.category===t.val?"var(--accent)":"var(--bg-input)",color:n.category===t.val?"#000":"var(--text-muted)",border:"none",cursor:"pointer"},children:t.label},t.val))}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold mb-1",style:{color:"var(--text-muted)"},children:n.category==="run"?"Race / Distance":"Exercise"}),e.jsx("select",{required:!0,value:n.label,onChange:t=>{const s=(n.category==="run"?v:k).find(o=>o.label===t.target.value);p(o=>({...o,label:t.target.value,unit:(s==null?void 0:s.unit)||o.unit}))},className:"w-full rounded-xl border px-3 py-2.5",style:{borderColor:"var(--border-subtle)",background:"var(--bg-input)",color:"var(--text-primary)",fontSize:14},children:(n.category==="run"?v:k).map(t=>e.jsx("option",{value:t.label,children:t.label},t.label))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{style:{flex:2},children:[e.jsx("p",{className:"text-xs font-semibold mb-1",style:{color:"var(--text-muted)"},children:n.category==="run"?n.unit==="mi"?"Distance (miles)":"Pace (min per mile, e.g. 8.5 = 8:30)":n.unit==="reps"?"Max Reps":"Max Weight (lbs)"}),e.jsx("input",{required:!0,type:"number",step:"0.01",min:"0",placeholder:n.unit==="min/mi"?"e.g. 7.5":n.unit==="mi"?"e.g. 13.1":"e.g. 225",value:n.value,onChange:t=>p(r=>({...r,value:t.target.value})),className:"w-full rounded-xl border px-3 py-2.5",style:{borderColor:"var(--border-subtle)",background:"var(--bg-input)",color:"var(--text-primary)",fontSize:14}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("p",{className:"text-xs font-semibold mb-1",style:{color:"var(--text-muted)"},children:"Unit"}),e.jsx("div",{className:"w-full rounded-xl border px-3 py-2.5 text-sm",style:{borderColor:"var(--border-subtle)",background:"var(--bg-base)",color:"var(--text-muted)"},children:n.unit})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold mb-1",style:{color:"var(--text-muted)"},children:"Date Achieved"}),e.jsx("input",{type:"date",value:n.achieved_at,onChange:t=>p(r=>({...r,achieved_at:t.target.value})),className:"w-full rounded-xl border px-3 py-2.5",style:{borderColor:"var(--border-subtle)",background:"var(--bg-input)",color:"var(--text-primary)",fontSize:14}})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold mb-1",style:{color:"var(--text-muted)"},children:"Notes (optional)"}),e.jsx("input",{placeholder:n.category==="run"?"e.g. Chicago Marathon, felt strong":"e.g. competition lift, belt + sleeves",value:n.notes,onChange:t=>p(r=>({...r,notes:t.target.value})),className:"w-full rounded-xl border px-3 py-2.5",style:{borderColor:"var(--border-subtle)",background:"var(--bg-input)",color:"var(--text-primary)",fontSize:14}})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx("button",{type:"submit",className:"flex-1 rounded-xl px-4 py-3 font-bold text-sm",style:{background:"var(--accent)",color:"#000",border:"none",cursor:"pointer"},children:"Save PR"}),e.jsx("button",{type:"button",onClick:()=>y(!1),className:"flex-1 rounded-xl border px-4 py-3 text-sm",style:{borderColor:"var(--border-subtle)",color:"var(--text-muted)",background:"none",cursor:"pointer"},children:"Cancel"})]})]})]})})]})}export{ae as default};
