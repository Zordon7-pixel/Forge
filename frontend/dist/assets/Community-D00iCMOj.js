import{r as x,j as e,a as y}from"./index-BaOvKJ5T.js";import{H as f}from"./heart-3fq0JSVE.js";function _(){const[t,r]=x.useState("workouts");return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Community"}),e.jsx("div",{className:"flex gap-2",children:[{key:"workouts",label:"Workouts"},{key:"routes",label:"Routes"}].map(o=>e.jsx("button",{onClick:()=>r(o.key),className:"rounded-full px-3 py-1 text-xs font-semibold",style:{background:t===o.key?"var(--accent)":"var(--bg-input)",color:t===o.key?"#000":"var(--text-muted)"},children:o.label},o.key))}),t==="workouts"?e.jsx(j,{}):e.jsx(b,{})]})}function j(){const[t,r]=x.useState("popular"),[o,i]=x.useState(""),[d,c]=x.useState([]);return x.useEffect(()=>{y.get("/community/workouts",{params:{sort:t,target:o||void 0}}).then(s=>{var a;return c(((a=s.data)==null?void 0:a.workouts)||[])}).catch(()=>c([]))},[t,o]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[["popular","newest"].map(s=>e.jsx("button",{onClick:()=>r(s),className:"rounded-full px-3 py-1 text-xs font-semibold",style:{background:t===s?"var(--accent)":"var(--bg-input)",color:t===s?"#000":"var(--text-muted)"},children:s==="popular"?"Popular":"Newest"},s)),e.jsx("input",{value:o,onChange:s=>i(s.target.value),placeholder:"By body part",className:"rounded-full px-3 py-1 text-xs",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}})]}),d.map(s=>e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"font-semibold",style:{color:"var(--text-primary)"},children:s.workout_name}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[s.target," · Used ",s.usage_count||0," times"]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:(s.main||[]).slice(0,2).map(a=>a.name||a).join(" · ")}),e.jsx("button",{onClick:()=>y.post(`/community/workouts/${s.id}/save`).catch(()=>{}),className:"mt-2 rounded-lg px-3 py-1.5 text-xs font-semibold",style:{background:"var(--accent)",color:"#000"},children:"Save to My Plan"})]},s.id)),d.length===0&&e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No workouts found yet."})]})}function b(){const[t,r]=x.useState([]),[o,i]=x.useState("newest"),[d,c]=x.useState(!1);x.useEffect(()=>{c(!0),y.get("/routes",{params:{sort:o==="popular"?"popular":"newest"}}).then(a=>{var n;return r(((n=a.data)==null?void 0:n.routes)||[])}).catch(()=>r([])).finally(()=>c(!1))},[o]);const s=async a=>{try{const n=await y.post(`/routes/${a}/like`);r(h=>h.map(m=>{var u,p;return m.id===a?{...m,liked:(u=n.data)==null?void 0:u.liked,likes_count:((p=n.data)==null?void 0:p.likes_count)??m.likes_count}:m}))}catch(n){console.error("Failed to toggle like",n)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2",children:["newest","popular"].map(a=>e.jsx("button",{onClick:()=>i(a),className:"rounded-full px-3 py-1 text-xs font-semibold",style:{background:o===a?"var(--accent)":"var(--bg-input)",color:o===a?"#000":"var(--text-muted)"},children:a==="newest"?"Newest":"Popular"},a))}),d&&e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Loading routes..."}),!d&&t.length===0&&e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No shared routes yet. Be the first to post one!"}),t.map(a=>e.jsx(k,{route:a,onLike:s},a.id))]})}function k({route:t,onLike:r}){const o=i=>{if(!i)return"--";const d=Math.floor(i/60),c=Math.round(i%60);return`${d}:${String(c).padStart(2,"0")} /mi`};return e.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:16,padding:16,border:"1px solid var(--border-subtle)",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",margin:0},children:t.title}),e.jsxs("p",{style:{fontSize:12,color:"var(--text-muted)",margin:"2px 0 0"},children:["by ",t.runner_name||"Athlete"," ",t.city?`· ${t.city}`:""]})]}),e.jsxs("button",{onClick:()=>r(t.id),style:{background:t.liked?"rgba(234,179,8,0.15)":"var(--bg-input)",border:`1px solid ${t.liked?"#EAB308":"var(--border-subtle)"}`,borderRadius:8,padding:"4px 10px",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[e.jsx(f,{size:14,color:t.liked?"#EAB308":"var(--text-muted)",fill:t.liked?"#EAB308":"none"}),e.jsx("span",{style:{fontSize:12,color:t.liked?"#EAB308":"var(--text-muted)"},children:t.likes_count})]})]}),e.jsxs("div",{style:{display:"flex",gap:16,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:18,fontWeight:800,color:"var(--text-primary)",margin:0},children:Number(t.distance_miles||0).toFixed(2)}),e.jsx("p",{style:{fontSize:10,color:"var(--text-muted)",margin:0},children:"miles"})]}),t.avg_pace&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:18,fontWeight:800,color:"var(--text-primary)",margin:0},children:o(t.avg_pace)}),e.jsx("p",{style:{fontSize:10,color:"var(--text-muted)",margin:0},children:"avg pace"})]}),t.surface&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:14,fontWeight:600,color:"var(--text-muted)",margin:"4px 0 0",textTransform:"capitalize"},children:t.surface}),e.jsx("p",{style:{fontSize:10,color:"var(--text-muted)",margin:0},children:"surface"})]})]}),t.route_coords&&t.route_coords.length>=2&&e.jsx(N,{coords:t.route_coords})]})}function N({coords:t}){if(!t||t.length===0)return null;const r=t.map(l=>Array.isArray(l)?{lat:l[0],lon:l[1]}:{lat:Number(l.lat),lon:Number(l.lon)}),o=r.map(l=>l.lat),i=r.map(l=>l.lon),d=Math.min(...o),c=Math.max(...o),s=Math.min(...i),a=Math.max(...i),n=10,h=280,m=100,u=l=>n+(l-s)/(a-s||1)*(h-n*2),p=l=>n+(c-l)/(c-d||1)*(m-n*2),g=r.map((l,v)=>`${v===0?"M":"L"}${u(l.lon).toFixed(1)},${p(l.lat).toFixed(1)}`).join(" ");return e.jsx("div",{style:{borderRadius:10,overflow:"hidden",background:"#111",marginTop:8},children:e.jsxs("svg",{viewBox:`0 0 ${h} ${m}`,style:{width:"100%",height:100,display:"block"},children:[e.jsx("path",{d:g,fill:"none",stroke:"#EAB308",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:u(r[0].lon),cy:p(r[0].lat),r:"4",fill:"#22c55e"}),e.jsx("circle",{cx:u(r[r.length-1].lon),cy:p(r[r.length-1].lat),r:"4",fill:"#ef4444"})]})})}export{_ as default};
