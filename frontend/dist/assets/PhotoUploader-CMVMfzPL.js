import{r,j as e,a as y}from"./index-DPvCFa56.js";import{C as w}from"./check-DBukk81A.js";import{C as R}from"./camera-Bj6y2iUt.js";function L({activityId:n,activityType:l,existingPhoto:i=null}){const[c,d]=r.useState(i),[f,u]=r.useState(!1),[m,j]=r.useState(!!i),h=r.useRef(),b=async a=>{if(!a||!n||!l)return;const t=new Image,s=URL.createObjectURL(a);t.onload=async()=>{const o=document.createElement("canvas"),p=800,g=Math.min(p/t.width,p/t.height,1);o.width=t.width*g,o.height=t.height*g,o.getContext("2d").drawImage(t,0,0,o.width,o.height);const x=o.toDataURL("image/jpeg",.75);d(x),u(!0);try{await y.post(`/social/${l}/${n}/photo`,{data:x,mime_type:"image/jpeg"}),j(!0)}catch(v){console.error("Photo upload error:",v),alert("Photo upload failed. Try a smaller image."),d(null)}finally{u(!1)}URL.revokeObjectURL(s)},t.onerror=()=>{console.error("Failed to load image"),alert("Could not load image. Try another file."),URL.revokeObjectURL(s)},t.src=s};return e.jsxs("div",{children:[c?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:c,alt:"Workout photo",style:{width:"100%",borderRadius:12,maxHeight:220,objectFit:"cover"}}),m&&e.jsx("div",{className:"absolute top-2 right-2 rounded-full p-1",style:{background:"var(--accent)"},children:e.jsx(w,{size:14,color:"#000"})}),!m&&f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-xl",style:{background:"rgba(0,0,0,0.5)"},children:e.jsx("span",{className:"text-xs font-bold text-white",children:"Uploading..."})})]}):e.jsxs("button",{onClick:()=>h.current.click(),className:"w-full py-3 rounded-xl flex items-center justify-center gap-2 text-sm font-semibold",style:{background:"var(--bg-input)",border:"1.5px dashed var(--border-subtle)",color:"var(--text-muted)"},children:[e.jsx(R,{size:16}),"Add workout photo"]}),e.jsx("input",{ref:h,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:a=>b(a.target.files[0])})]})}export{L as P};
