import{b as Le,c as Be,u as Ie,r as n,a as h,j as e,R as se}from"./index-B0TFXbO8.js";import{A as Ge}from"./AchievementUnlock-CBsq2ecB.js";import{L as Ee}from"./LoadingRunner-Cn-oV2PT.js";import{F as He}from"./flame-BidPfYnj.js";import{A as Ue,a as Pe}from"./arrow-up-right-BeDeKE5o.js";import{W as Fe}from"./watch-Tsbjh6H5.js";function ae(a){if(!a)return"0 min";const o=Math.floor(a/3600),c=Math.floor(a%3600/60);return o>0?c>0?`${o}h ${c}min`:`${o}h`:`${c} min`}function Oe(a){if(!a)return"0m";const o=Math.floor(a/3600),c=Math.floor(a%3600/60);return o>0?`${o}h ${c}m`:`${c}m`}function H(a,o=900){const[c,r]=se.useState(0);return se.useEffect(()=>{if(!a){r(0);return}let f=0;const b=a/(o/16),m=setInterval(()=>{f+=b,f>=a?(r(a),clearInterval(m)):r(Math.floor(f))},16);return()=>clearInterval(m)},[a,o]),c}function Ve({data:a=[]}){if(!a.length)return null;const o=Math.max(...a.map(m=>m.miles),1),c=100,r=40,f=a.map((m,u)=>{const j=u/(a.length-1)*c,R=r-m.miles/o*r;return`${j},${R}`}).join(" "),b=`0,${r} `+f+` ${c},${r}`;return e.jsxs("svg",{viewBox:`0 0 ${c} ${r}`,className:"w-full h-16",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trendGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--accent)",stopOpacity:"0.4"}),e.jsx("stop",{offset:"100%",stopColor:"var(--accent)",stopOpacity:"0"})]})}),e.jsx("polygon",{points:b,fill:"url(#trendGrad)"}),e.jsx("polyline",{points:f,fill:"none",stroke:"var(--accent)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),a.map((m,u)=>{const j=u/(a.length-1)*c,R=r-m.miles/o*r;return m.miles>0?e.jsx("circle",{cx:j,cy:R,r:"1.5",fill:"var(--accent)"},u):null})]})}function Ye({score:a,onClick:o}){const b=2*Math.PI*28,m=a/100*b,u=a>=75?"#22c55e":a>=50?"var(--accent)":"#ef4444",j=a>=80?"Optimal":a>=60?"Good":a>=40?"Moderate":"Low";return e.jsxs("div",{onClick:o,style:{cursor:"pointer"},className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 72 72",children:[e.jsx("circle",{cx:36,cy:36,r:28,fill:"none",stroke:"var(--border-subtle)",strokeWidth:"5"}),e.jsx("circle",{cx:36,cy:36,r:28,fill:"none",stroke:u,strokeWidth:"5",strokeDasharray:`${m} ${b}`,strokeLinecap:"round",transform:"rotate(-90 36 36)"}),e.jsx("text",{x:36,y:37,textAnchor:"middle",dominantBaseline:"middle",fontSize:"13",fontWeight:"bold",fill:u,children:a})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-base",style:{color:"var(--text-primary)"},children:j}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:"Training readiness"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)",opacity:.7},children:a>=75?"Go hard today.":a>=50?"Moderate effort.":"Take it easy today."})]})]}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)",opacity:.6},children:"Tap to see breakdown"})]})}const Ke={day:"Today",week:t("dashboard.thisWeek"),month:"This Month",year:"This Year",all:"All Time"};function Je(){const[a,o]=n.useState(null),[c,r]=n.useState(!1),[f,b]=n.useState(!1);n.useEffect(()=>{const j=localStorage.getItem("forge_token");if(!j)return;fetch("/api/watch-sync/status",{headers:{Authorization:`Bearer ${j}`}}).then(p=>p.ok?p.json():null).then(p=>o(p)).catch(()=>{});const R=setInterval(()=>{fetch("/api/watch-sync/status",{headers:{Authorization:`Bearer ${j}`}}).then(p=>p.ok?p.json():null).then(p=>{p&&a&&p.synced_at!==(a==null?void 0:a.synced_at)&&(b(!0),setTimeout(()=>b(!1),3e3)),o(p)}).catch(()=>{})},1e4);return()=>clearInterval(R)},[]);const m=(a==null?void 0:a.treadmill_brand)||(a==null?void 0:a.watch_mode)||null,u=a&&(a.avg_heart_rate||a.distance_miles);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("style",{children:`
        @keyframes watchPulse { 0%,100% { box-shadow: 0 0 0 0 rgba(234,179,8,0.4); } 50% { box-shadow: 0 0 0 8px rgba(234,179,8,0); } }
        @keyframes syncFlash { 0% { background: rgba(34,197,94,0.3); } 100% { background: transparent; } }
      `}),e.jsxs("button",{onClick:()=>{r(!0),setTimeout(()=>r(!1),1500)},style:{display:"flex",alignItems:"center",gap:6,background:u?"rgba(234,179,8,0.1)":"var(--bg-input)",border:`1px solid ${u?"rgba(234,179,8,0.4)":"var(--border-subtle)"}`,borderRadius:10,padding:"6px 12px",cursor:"pointer",animation:c?"watchPulse 1s ease-in-out infinite":"none",transition:"all 0.3s ease",...f?{animation:"syncFlash 1s ease forwards"}:{}},children:[e.jsx(Fe,{size:14,color:u?"#EAB308":"var(--text-muted)"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("p",{style:{fontSize:9,color:"var(--text-muted)",margin:0,letterSpacing:.5,textTransform:"uppercase"},children:m||"Watch"}),e.jsx("p",{style:{fontSize:11,fontWeight:700,color:u?"#EAB308":"var(--text-muted)",margin:0},children:f?"Synced!":u?`HR ${a.avg_heart_rate||"--"} bpm`:"No data"})]}),u&&e.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:"#22c55e",animation:"watchPulse 2s ease infinite"}})]}),e.jsx("p",{style:{fontSize:9,color:"var(--text-muted)",textAlign:"center",marginTop:2},children:"+ Meta Glasses (soon)"})]})}function ot(){var X,Z;const a=Le(),{fmt:o}=Be(),{t:c}=Ie(),[r,f]=n.useState(null),[b,m]=n.useState([]),[u,j]=n.useState([]),[R,p]=n.useState(!1),[re,ne]=n.useState(!0),[D,oe]=n.useState("week"),[L,le]=n.useState(!1),[U,ie]=n.useState(!1),[P,ce]=n.useState("auto"),[B,de]=n.useState(null),[Qe,qe]=n.useState(!1),[Xe,Ze]=n.useState(""),[ue,I]=n.useState(!1),[i,G]=n.useState(null),[y,F]=n.useState(null),[O,xe]=n.useState([]),[me,he]=n.useState({currentStreak:0,bestStreak:0}),[V,Y]=n.useState([]),[K,J]=n.useState(null),[v,pe]=n.useState(null),[Q,ye]=n.useState(!1),[S,ge]=n.useState(null),[E,fe]=n.useState(null),[be,ve]=n.useState(Number(localStorage.getItem("forge_load_warning_dismissed_until")||0)),[je,ke]=n.useState([]),[Se,we]=n.useState(0);n.useEffect(()=>{(async()=>{var s,l,x,g,d,k;try{const[w,C,N,z,$,W,ze,We,De,Me,$e,Ae]=await Promise.all([h.get("/auth/me/stats"),h.get("/runs",{params:{limit:5}}),h.get("/lifts"),h.get("/coach/warning"),h.get("/checkin/today").catch(()=>({data:null})),h.get("/users/goal").catch(()=>({data:null})),h.get("/auth/me/streak").catch(()=>({data:{currentStreak:0,bestStreak:0}})),h.get("/milestones/new").catch(()=>({data:{milestones:[]}})),h.get("/plans/compliance").catch(()=>({data:null})),h.get("/runs/load-analysis").catch(()=>({data:null})),h.get("/races/next").catch(()=>({data:{race:null}})),h.get("/gear/shoes").catch(()=>({data:{shoes:[]}}))]);f(w.data);const ee=Array.isArray(C.data)?C.data:((s=C.data)==null?void 0:s.runs)||[];m(ee),ie(ee.some(_=>_.avg_heart_rate||_.watch_mode||_.route_coords)),j(Array.isArray(N.data)?N.data:((l=N.data)==null?void 0:l.lifts)||[]),p(((x=z.data)==null?void 0:x.warning)===!0),$.data&&le(!0),W.data&&(ce(W.data.mode||"auto"),de(W.data.miles||null)),he(ze.data||{currentStreak:0,bestStreak:0});const A=((g=We.data)==null?void 0:g.milestones)||[];Y(A),A.length>0&&J(_=>_||{name:A[0].title,description:A[0].description,icon:"Award",color:"#EAB308"}),pe(De.data),ge(Me.data),fe(((d=$e.data)==null?void 0:d.race)||null),ke((((k=Ae.data)==null?void 0:k.shoes)||[]).filter(_=>_.alert)),h.get("/recap/weekly").then(_=>{var te;return we(((te=_.data)==null?void 0:te.totalCalories)||0)}).catch(()=>{})}finally{ne(!1)}})()},[]),n.useEffect(()=>{const s=localStorage.getItem("forge_last_watch_sync_seen_at")||"1970-01-01T00:00:00";h.get("/watch-sync/recent",{params:{since:s}}).then(l=>{var g;const x=((g=l.data)==null?void 0:g.items)||[];x.length&&(xe(x.filter(d=>d.routed_section==="other")),F(x[0]))}).catch(()=>{})},[]);const{readiness:T,readinessBreakdown:Ne}=n.useMemo(()=>{var $;if(!r||!L||!U)return{readiness:null,readinessBreakdown:[]};const{streak:s,week:l,all:x}=r;let g=50;const d=[];d.push({label:"Base score",value:50,delta:0,reason:"Starting point for all athletes."});const k=Math.min(s*4,20);g+=k,d.push({label:"Consistency streak",value:k,delta:k,reason:s>0?`${s}-day active streak adds +${k} pts. Staying consistent pays off.`:"No active streak. Logging runs builds your streak bonus."});const w=x.miles/Math.max(($=r.weeklyTrend)==null?void 0:$.filter(W=>W.miles>0).length,1),C=w>0?l.miles/w:0;let N=0,z="";return C<.5?(N=15,z=`This week you ran ${o.distance(l.miles,1)} vs your avg ${o.distance(w,1)} — low volume means your legs are fresh.`):C>1.3?(N=-15,z=`This week you ran ${o.distance(l.miles,1)} vs your avg ${o.distance(w,1)} — high volume week, body needs recovery.`):z=`This week (${o.distance(l.miles,1)}) is on par with your average (${o.distance(w,1)}) — balanced load.`,g+=N,d.push({label:"Weekly load",value:N,delta:N,reason:z}),{readiness:Math.max(1,Math.min(99,Math.round(g))),readinessBreakdown:d}},[r,L,U]);n.useMemo(()=>{var g;if(!r)return null;const s=((g=r.month)==null?void 0:g.miles)||0;let l;P==="manual"&&B?l=B:l=Math.max(25,Math.ceil(s/25)*25+(s>=25?25:0));const x=Math.min(s/l*100,100);return{miles:s,goal:l,pct:x}},[r,P,B]);const M=(r==null?void 0:r[D])||{},_e=H(Math.round((M.miles||0)*10),900),Re=H(M.count||0,900);H(me.currentStreak||0,900);const q=n.useMemo(()=>{const s=b.slice(0,3).map(d=>({...d,_type:"run"})),l=(u||[]).slice(0,3).map(d=>({...d,_type:"lift"})),x=(O||[]).slice(0,3).map(d=>({...d,_type:"other"}));return[...s,...l,...x].sort((d,k)=>{const w=d.date||d.started_at||d.created_at||"";return(k.date||k.started_at||k.created_at||"").localeCompare(w)}).slice(0,4)},[b,u,O]),Ce=S&&["elevated","high","danger"].includes(S.loadStatus)&&Date.now()>be,Te=(v==null?void 0:v.score)>=80?"#22c55e":(v==null?void 0:v.score)>=50?"#EAB308":"#ef4444";return re?e.jsx(Ee,{message:"Getting ready"}):e.jsxs("div",{className:"space-y-4",children:[K&&e.jsx(Ge,{badge:K,onDismiss:()=>J(null)}),e.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        @keyframes ringClose {
          0% { opacity: 1; stroke-dasharray: 157 0; }
          80% { opacity: 1; stroke-dasharray: 157 0; }
          100% { opacity: 0; stroke-dasharray: 157 0; }
        }
      `}),e.jsx(Je,{}),Ce&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:S.loadStatus==="danger"?"rgba(239,68,68,0.12)":S.loadStatus==="high"?"rgba(249,115,22,0.12)":"rgba(234,179,8,0.12)",border:`1px solid ${S.loadStatus==="danger"?"rgba(239,68,68,0.35)":S.loadStatus==="high"?"rgba(249,115,22,0.35)":"rgba(234,179,8,0.35)"}`},children:[e.jsxs("p",{className:"text-xs font-bold uppercase",style:{color:"var(--text-primary)"},children:[S.loadStatus," load"]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-primary)"},children:S.warning||S.recommendation}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},onClick:()=>a("/plan",{state:{suggestEasyDay:!0}}),children:"Take Easy Day"}),e.jsx("button",{className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},onClick:()=>{const s=Date.now()+864e5;localStorage.setItem("forge_load_warning_dismissed_until",String(s)),ve(s)},children:"OK"})]})]}),E&&(()=>{const s=Math.ceil((new Date(`${E.race_date}T12:00:00`).getTime()-Date.now())/864e5);return s>0&&s<=60?e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Next Race"}),e.jsx("p",{className:"text-base font-bold",style:{color:"var(--text-primary)"},children:E.race_name}),e.jsxs("p",{className:"text-sm",style:{color:"var(--accent)"},children:[s," days to go"]})]}):null})(),v&&e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},onClick:()=>ye(!Q),children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:[c("dashboard.thisWeek"),": ",v.completed,"/",v.planned," sessions — ",v.score,"%"]}),e.jsx("div",{className:"w-full h-2 rounded-full mt-2",style:{background:"var(--bg-input)"},children:e.jsx("div",{className:"h-2 rounded-full",style:{width:`${v.score}%`,background:Te}})}),Q&&e.jsx("div",{className:"mt-3 space-y-1",children:(v.sessions||[]).map((s,l)=>e.jsxs("p",{className:"text-xs",style:{color:s.completed?"#22c55e":"#ef4444"},children:[s.day,": ",s.type," ",s.completed?"hit":"missed"]},l))})]}),V.length>0&&e.jsx("div",{className:"space-y-2",children:V.map(s=>e.jsxs("div",{className:"rounded-xl p-3 flex items-center justify-between",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:s.title}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:s.description})]}),e.jsx("button",{onClick:()=>Y(l=>l.filter(x=>x.key!==s.key)),className:"text-xs",style:{color:"var(--text-muted)"},children:"Dismiss"})]},s.key))}),!L&&e.jsxs("a",{href:"/checkin",style:{display:"block",background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)",borderRadius:14,padding:"12px 16px",marginBottom:12,textDecoration:"none"},children:[e.jsx("p",{style:{color:"var(--accent)",fontWeight:700,fontSize:14,margin:0},children:"Quick check-in — 3 taps"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:12,margin:"2px 0 0"},children:"Help me adjust today's plan around your day"})]}),y&&e.jsxs("div",{className:"rounded-xl p-3",style:{background:"rgba(234,179,8,0.12)",border:"1px solid rgba(234,179,8,0.3)"},children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:["New activity synced from your watch — ",y.activity_name,". View it in ",y.routed_section==="lift"?"Lift":y.routed_section==="other"?"History":"Run"," tab."]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:()=>{localStorage.setItem("forge_last_watch_sync_seen_at",y.synced_at),y.routed_section==="lift"?a("/log-lift"):y.normalized_type==="treadmill"?a("/run/treadmill",{state:{incline:y.incline_pct,speed:y.belt_speed_mph,durationSeconds:y.duration_seconds,treadmillType:y.treadmill_brand||"Generic",watchMetrics:y}}):a("/log-run")},className:"rounded-lg px-3 py-1.5 text-xs font-bold",style:{background:"var(--accent)",color:"#000"},children:"View"}),e.jsx("button",{onClick:()=>{localStorage.setItem("forge_last_watch_sync_seen_at",y.synced_at),F(null)},className:"rounded-lg px-3 py-1.5 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},children:"Dismiss"})]})]}),e.jsxs("div",{className:"rounded-2xl p-6 flex flex-col items-center",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("h2",{className:"text-2xl font-black mb-1",style:{color:"var(--text-primary)"},children:"Ready to Run?"}),e.jsx("p",{className:"text-sm mb-10 text-center",style:{color:"var(--text-muted)"},children:"Dynamic warm-up reduces injury risk and improves performance."}),e.jsxs("button",{onClick:()=>a("/log-run?warmup=true"),className:"rounded-full w-28 h-28 mb-3 font-black flex flex-col items-center justify-center",style:{background:"var(--accent)",color:"#000",border:"none",cursor:"pointer"},children:[e.jsx(He,{className:"mb-1"}),e.jsx("span",{className:"text-xs font-black",children:"Start Warm-Up"})]}),e.jsx("button",{onClick:()=>a("/log-run"),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",fontSize:14,padding:"8px 0"},children:"Skip warm-up"})]}),e.jsx("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:T===null?e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Complete your daily check-in and sync your watch to unlock your Training Readiness score"}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{score:T,onClick:()=>I(!0)}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)"},children:"Based on your HRV, sleep, soreness, and energy levels"})]})}),(r==null?void 0:r.calendarDays)&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"text-xs font-medium mb-3",style:{color:"var(--text-muted)"},children:c("dashboard.thisWeek")}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:r.calendarDays.map(s=>e.jsxs("div",{className:"flex flex-col items-center gap-1",onClick:()=>G(s),style:{cursor:"pointer"},children:[e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.6},children:s.day}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border",style:{background:s.hasRun||s.hasLift?"var(--accent)":"var(--bg-input)",borderColor:s.isToday?"var(--accent)":"transparent",borderWidth:s.isToday?2:1},children:s.hasRun&&s.hasLift?e.jsx("span",{className:"text-xs font-bold text-black",children:"R+L"}):s.hasRun?e.jsx("span",{className:"text-xs font-bold text-black",children:"R"}):s.hasLift?e.jsx("span",{className:"text-xs font-bold text-black",children:"L"}):e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.4},children:"·"})})]},s.date))})]}),e.jsxs("div",{className:"rounded-2xl p-4 space-y-3",style:{background:"var(--bg-card)"},children:[e.jsx("div",{className:"flex gap-2",children:[{key:"day",label:"D"},{key:"week",label:"W"},{key:"month",label:"M"},{key:"all",label:"All"}].map(({key:s,label:l})=>e.jsx("button",{onClick:()=>oe(s),className:"px-4 py-1.5 rounded-full text-xs font-semibold transition-all",style:D===s?{background:"var(--accent)",color:"#000"}:{background:"var(--bg-input)",color:"var(--text-muted)",border:"1px solid var(--border-subtle)"},children:l},s))}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:Ke[D]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-5xl font-black tabular-nums",style:{color:"var(--text-primary)"},children:o.distanceValue(_e/10).toFixed(1)}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:[o.distanceLabel.charAt(0).toUpperCase()+o.distanceLabel.slice(1),"s"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{label:"Runs",value:Re},{label:"Time",value:Oe(M.seconds)},{label:"Cal",value:D==="week"?Se.toLocaleString():(M.calories||0).toLocaleString()}].map((s,l)=>{const x=l%2===0;return e.jsxs("div",{className:"rounded-lg p-2",style:{border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:s.value}),e.jsxs("p",{className:"text-xs flex items-center gap-1",style:{color:"var(--text-muted)"},children:[s.label,x?e.jsx(Ue,{size:12,color:"#22c55e"}):e.jsx(Pe,{size:12,color:"#ef4444"})]})]},s.label)})})]}),(r==null?void 0:r.weeklyTrend)&&r.weeklyTrend.some(s=>s.miles>0)&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-muted)"},children:"Past 12 Weeks"}),e.jsxs("p",{className:"text-xs font-semibold",style:{color:"var(--accent)"},children:[o.distance((X=r.weeklyTrend[r.weeklyTrend.length-1])==null?void 0:X.miles,1)," last week"]})]}),e.jsx(Ve,{data:r.weeklyTrend}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.5},children:new Date((Z=r.weeklyTrend[0])==null?void 0:Z.week).toLocaleDateString("en-US",{month:"short"})}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.5},children:"Now"})]})]}),R&&e.jsx("div",{className:"rounded-xl border p-3 text-sm",style:{borderColor:"rgba(234,179,8,0.3)",background:"rgba(234,179,8,0.08)",color:"var(--accent)"},children:"Heavy legs detected — consider a rest day or easy run today"}),je.map(s=>e.jsxs("div",{style:{background:"rgba(249,115,22,0.08)",border:"1px solid rgba(249,115,22,0.3)",borderRadius:12,padding:"10px 14px"},children:[e.jsxs("p",{style:{fontSize:13,fontWeight:700,color:"#f97316",margin:0},children:[s.brand," ",s.model," is at ",s.pct_used,"% — ",s.pct_used>=100?"replace now":"start looking for a replacement"]}),e.jsxs("p",{style:{fontSize:11,color:"var(--text-muted)",margin:"2px 0 0"},children:[s.total_miles," of ",s.recommended_miles," miles used"]})]},s.id)),e.jsxs("section",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsx("h3",{className:"text-base font-bold mb-3",style:{color:"var(--text-primary)",borderBottom:"1px solid rgba(234,179,8,0.45)",paddingBottom:6},children:"Recent Activity"}),e.jsxs("div",{className:"space-y-3",children:[q.map(s=>s._type==="run"?e.jsxs("div",{onClick:()=>a(`/history?runId=${s.id}`),className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",borderLeft:"4px solid #EAB308",cursor:"pointer"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:"Run"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(s.date||s.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:o.distance(Number(s.distance_miles||0),2)})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:o.pace(s.duration_seconds/s.distance_miles)})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:ae(s.duration_seconds)})}),s.calories>0&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:[s.calories," cal"]})})]})]},s.id):s._type==="other"?e.jsxs("div",{className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"rgba(234,179,8,0.2)",color:"var(--accent)"},children:"Other Activity"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(s.synced_at||s.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("p",{className:"text-sm font-bold mt-1",style:{color:"var(--text-primary)"},children:s.activity_name||s.activity_type||"Synced activity"})]},s.id):e.jsxs("div",{onClick:()=>a(`/history?workoutId=${s.id}`),className:"rounded-xl p-3 border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",borderLeft:"4px solid #ffffff",cursor:"pointer"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:"rgba(139,92,246,0.15)",color:"#a78bfa"},children:"Lift"}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:new Date(s.date||s.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("p",{className:"text-sm font-bold mt-1",style:{color:"var(--text-primary)"},children:s.exercise_name||(Array.isArray(s.muscle_groups)?s.muscle_groups.join(", "):"Workout")}),s.sets&&e.jsxs("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:[s.sets," sets · ",s.reps," reps · ",s.weight_lbs," lbs"]})]},s.id)),q.length===0&&e.jsx("p",{className:"text-sm py-4 text-center",style:{color:"var(--text-muted)"},children:c("dashboard.noActivity")})]})]}),i&&e.jsx("div",{onClick:()=>G(null),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:50,display:"flex",alignItems:"flex-end"},children:e.jsxs("div",{onClick:s=>s.stopPropagation(),style:{background:"var(--bg-card)",borderRadius:"20px 20px 0 0",padding:24,width:"100%",maxHeight:"60vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)"},children:new Date(i.date+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsx("p",{style:{fontSize:20,fontWeight:900,color:"var(--text-primary)"},children:i.hasRun||i.hasLift?"Active Day":"Rest Day"})]}),e.jsx("button",{onClick:()=>G(null),style:{background:"var(--bg-input)",border:"none",borderRadius:10,padding:"8px 14px",color:"var(--text-muted)",cursor:"pointer",fontSize:13},children:"Close"})]}),i.run&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:16,marginBottom:12},children:[e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--accent)",letterSpacing:1,textTransform:"uppercase",marginBottom:10},children:"Run"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:Number(i.run.distance||0).toFixed(2)}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"miles"})]}),i.run.duration>0&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:ae(i.run.duration)}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"duration"})]}),i.run.distance>0&&i.run.duration>0&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:22,fontWeight:900,color:"var(--text-primary)"},children:(()=>{const s=i.run.duration/i.run.distance;return`${Math.floor(s/60)}:${String(Math.round(s%60)).padStart(2,"0")}`})()}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"avg pace /mi"})]}),i.run.surface&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",textTransform:"capitalize"},children:i.run.surface}),e.jsx("p",{style:{fontSize:11,color:"var(--text-muted)"},children:"surface"})]})]}),i.run.notes&&e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginTop:12,lineHeight:1.5,borderTop:"1px solid var(--border-subtle)",paddingTop:10},children:i.run.notes})]}),i.lifts&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:16,marginBottom:12},children:[e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--accent)",letterSpacing:1,textTransform:"uppercase",marginBottom:8},children:"Strength"}),e.jsxs("p",{style:{fontSize:20,fontWeight:900,color:"var(--text-primary)"},children:[i.lifts," workout session",i.lifts>1?"s":""]})]}),!i.hasRun&&!i.hasLift&&e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:14,padding:20,textAlign:"center"},children:[e.jsx("p",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",marginBottom:6},children:"Rest day"}),e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",lineHeight:1.6},children:i.isToday?"No activity logged yet today.":"Recovery is part of training. Rest days make you stronger."})]})]})}),ue&&e.jsx("div",{onClick:()=>I(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:50,display:"flex",alignItems:"flex-end"},children:e.jsxs("div",{onClick:s=>s.stopPropagation(),style:{background:"var(--bg-card)",borderRadius:"20px 20px 0 0",padding:24,width:"100%",maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)"},children:"Training Readiness"}),e.jsxs("p",{style:{fontSize:28,fontWeight:900,color:"var(--accent)"},children:[T," ",e.jsx("span",{style:{fontSize:14,fontWeight:400,color:"var(--text-muted)"},children:"/ 100"})]}),e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginTop:2},children:T>=80?"Go hard today.":T>=60?"Moderate effort — push but listen to your body.":T>=40?"Take it easy — a recovery run or rest day is smart.":"Rest today. Your body is telling you something."})]}),e.jsx("button",{onClick:()=>I(!1),style:{background:"var(--bg-input)",border:"none",borderRadius:10,padding:"8px 14px",color:"var(--text-muted)",cursor:"pointer",fontSize:13},children:"Close"})]}),e.jsx("p",{style:{fontSize:11,fontWeight:700,color:"var(--text-muted)",letterSpacing:1,textTransform:"uppercase",marginBottom:12},children:"Score Breakdown"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:Ne.map((s,l)=>e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:12,padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("p",{style:{fontSize:13,fontWeight:700,color:"var(--text-primary)"},children:s.label}),e.jsx("p",{style:{fontSize:13,fontWeight:700,color:s.delta>0?"#22c55e":s.delta<0?"#ef4444":"var(--text-muted)"},children:s.delta>0?`+${s.delta}`:s.delta<0?`${s.delta}`:`${s.value}`})]}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",lineHeight:1.5},children:s.reason})]},l))}),e.jsxs("div",{style:{marginTop:20,padding:14,background:"var(--bg-base)",borderRadius:12,borderLeft:"3px solid var(--accent)"},children:[e.jsx("p",{style:{fontSize:12,fontWeight:700,color:"var(--accent)",marginBottom:6},children:"How to improve your score"}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)",lineHeight:1.6},children:"Log runs consistently to build your streak. Keep weekly mileage within 10–20% of your average. Connect your Garmin for HRV and sleep data — that unlocks a much more accurate score."})]})]})})]})}export{ot as default};
