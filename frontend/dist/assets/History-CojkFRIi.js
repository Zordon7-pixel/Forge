import{d as pe,r,j as e,a as $,e as be,c as he,u as ve,L as K}from"./index-B0TFXbO8.js";import{f as q,p as fe}from"./parseDuration-3bmQJghK.js";import{X as se}from"./x-BxDar5mu.js";import{B as ae}from"./brain-OIbWK9Ej.js";import{L as ge}from"./LoadingRunner-Cn-oV2PT.js";import{P as Q}from"./pencil-DQ9Bf3aB.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],ee=pe("Trash2",ye);function je({run:s,onSave:o,onClose:c}){var u;const[b,w]=r.useState(String(s.distance_miles||"")),[v,m]=r.useState(q(s.duration_seconds)),[S,p]=r.useState(s.duration_seconds||0),[D,_]=r.useState(s.date||((u=s.created_at)==null?void 0:u.slice(0,10))||""),[N,L]=r.useState(s.notes||""),[f,h]=r.useState(s.perceived_effort||5),[R,x]=r.useState(""),[n,g]=r.useState(!1),y=()=>{const i=fe(v);i?(p(i),m(q(i)),x("")):v&&x('Could not understand that duration. Try "45:00" or "1 hour 30 minutes"')},E=async()=>{var i,C;g(!0),x("");try{const A=await $.put(`/runs/${s.id}`,{date:D,distance_miles:Number(b),duration_seconds:S,notes:N,perceived_effort:f});o(A.data)}catch(A){x(((C=(i=A==null?void 0:A.response)==null?void 0:i.data)==null?void 0:C.error)||"Could not save.")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/70",onClick:i=>i.target===i.currentTarget&&c(),children:e.jsxs("div",{className:"w-full max-w-lg rounded-t-2xl p-5 space-y-3",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:"Edit Run"}),e.jsx("button",{onClick:c,className:"text-sm px-3 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Cancel"})]}),[["Distance (miles)",b,w,"decimal-pad"],["Date (YYYY-MM-DD)",D,_,"default"]].map(([i,C,A,T])=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:i}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:C,onChange:Y=>A(Y.target.value),inputMode:T==="decimal-pad"?"decimal":void 0})]},i)),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Duration (any format)"}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:v,onChange:i=>m(i.target.value),onBlur:y,placeholder:"e.g. 2 hours 45 minutes, 45:30, 1h30m"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs mb-2 block",style:{color:"var(--text-muted)"},children:["Effort: ",f,"/10"]}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5,6,7,8,9,10].map(i=>e.jsx("button",{onClick:()=>h(i),className:"flex-1 h-8 rounded text-xs font-bold",style:{background:i<=f?"var(--accent)":"var(--bg-input)",color:i<=f?"#000":"var(--text-muted)"},children:i},i))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Notes"}),e.jsx("textarea",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none resize-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:N,onChange:i=>L(i.target.value),rows:2})]}),R&&e.jsx("p",{className:"text-xs",style:{color:"#ef4444"},children:R}),e.jsx("button",{onClick:E,disabled:n,className:"w-full py-4 rounded-xl font-black text-black text-base",style:{background:"var(--accent)",opacity:n?.6:1},children:n?"Saving...":"Save Changes"})]})})}function ke({lift:s,onSave:o,onClose:c}){var E;const[b,w]=r.useState(s.exercise_name||""),[v,m]=r.useState(String(s.sets??"")),[S,p]=r.useState(String(s.reps??"")),[D,_]=r.useState(String(s.weight_lbs??"")),[N,L]=r.useState(s.date||((E=s.created_at)==null?void 0:E.slice(0,10))||""),[f,h]=r.useState(s.notes||""),[R,x]=r.useState(""),[n,g]=r.useState(!1),y=async()=>{var u,i;g(!0),x("");try{const C=await $.put(`/lifts/${s.id}`,{exercise_name:b,sets:v===""?null:Number(v),reps:S===""?null:Number(S),weight_lbs:D===""?null:Number(D),date:N,notes:f});o(C.data)}catch(C){x(((i=(u=C==null?void 0:C.response)==null?void 0:u.data)==null?void 0:i.error)||"Could not save.")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/70",onClick:u=>u.target===u.currentTarget&&c(),children:e.jsxs("div",{className:"w-full max-w-lg rounded-t-2xl p-5 space-y-3",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:"Edit Lift"}),e.jsx("button",{onClick:c,className:"text-sm px-3 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Cancel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Exercise"}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:b,onChange:u=>w(u.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Sets"}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:v,onChange:u=>m(u.target.value),inputMode:"numeric"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Reps"}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:S,onChange:u=>p(u.target.value),inputMode:"numeric"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Weight"}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:D,onChange:u=>_(u.target.value),inputMode:"decimal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Date (YYYY-MM-DD)"}),e.jsx("input",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:N,onChange:u=>L(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"Notes"}),e.jsx("textarea",{className:"w-full px-4 py-3 rounded-xl text-sm outline-none resize-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},value:f,onChange:u=>h(u.target.value),rows:2})]}),R&&e.jsx("p",{className:"text-xs",style:{color:"#ef4444"},children:R}),e.jsx("button",{onClick:y,disabled:n,className:"w-full py-4 rounded-xl font-black text-black text-base",style:{background:"var(--accent)",opacity:n?.6:1},children:n?"Saving...":"Save Changes"})]})})}const Ne=[{value:"tired",label:"Tired / needed rest"},{value:"no_time",label:"No time"},{value:"didnt_feel_like_it",label:"Didn't feel like it"},{value:"something_came_up",label:"Something came up"},{value:"weather",label:"Weather"},{value:"sick",label:"Sick / injured"}];function we({onClose:s}){const[o,c]=r.useState(""),[b,w]=r.useState(""),[v,m]=r.useState(!1),S=async()=>{if(o){m(!0);try{const p=await $.post("/runs/missed",{reason:o,scheduled_date:new Date().toISOString().slice(0,10)});w(p.data.message)}catch{}finally{m(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/70",onClick:p=>p.target===p.currentTarget&&s(),children:e.jsx("div",{className:"w-full max-w-lg rounded-t-2xl p-5 space-y-3",style:{background:"var(--bg-card)"},children:b?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base leading-relaxed",style:{color:"var(--text-primary)"},children:b}),e.jsx("button",{onClick:s,className:"w-full py-4 rounded-xl font-black text-black",style:{background:"var(--accent)"},children:"Got it"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:"What happened?"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No judgment — I'll adjust your plan."}),e.jsx("div",{className:"space-y-2",children:Ne.map(p=>e.jsx("button",{onClick:()=>c(p.value),className:"w-full p-3 rounded-xl text-left border text-sm font-medium",style:{background:o===p.value?"var(--accent-dim)":"var(--bg-input)",borderColor:o===p.value?"var(--accent)":"var(--border-subtle)",color:"var(--text-primary)"},children:p.label},p.value))}),e.jsx("button",{onClick:S,disabled:!o||v,className:"w-full py-4 rounded-xl font-black text-black",style:{background:o?"var(--accent)":"var(--bg-input)",opacity:v?.6:1},children:v?"Adjusting...":"Update My Plan"})]})})})}function Se(s=0){const o=Math.floor(s/3600),c=Math.floor(s%3600/60),b=s%60;return o>0?`${o}h ${c}m`:c>0&&b>0?`${c}m ${b}s`:`${c}m`}function _e(s,o){if(!s||!o)return"--";const c=s/60/o,b=Math.floor(c),w=Math.round((c-b)*60);return`${b}:${String(w).padStart(2,"0")} /mi`}const Ce=["","Very Easy","Easy","Easy-Moderate","Moderate","Moderate-Hard","Hard","Hard","Very Hard","Very Hard","Max"],te=[{key:"Z1",min:.5,max:.6,name:"Recovery",color:"#6B7280"},{key:"Z2",min:.6,max:.7,name:"Aerobic Base",color:"#3B82F6"},{key:"Z3",min:.7,max:.8,name:"Tempo",color:"#22C55E"},{key:"Z4",min:.8,max:.9,name:"Threshold",color:"#EAB308"},{key:"Z5",min:.9,max:1.01,name:"Max Effort",color:"#EF4444"}];function De({run:s,onClose:o,onFeedbackGenerated:c}){const[b,w]=r.useState(s.ai_feedback||""),[v,m]=r.useState(!1),[S,p]=r.useState(""),D=async()=>{var x,n;m(!0),p("");try{const g=await $.post(`/runs/${s.id}/feedback`);w(g.data.feedback),c&&c(s.id,g.data.feedback)}catch(g){p(((n=(x=g.response)==null?void 0:x.data)==null?void 0:n.error)||"Could not generate feedback.")}finally{m(!1)}},_=new Date(s.date||s.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),N=s.avg_hr||s.avg_heart_rate||null,L=s.max_heart_rate||190,f=N&&L?N/L:null,h=f?te.find(x=>f>=x.min&&f<x.max)||te[4]:null,R=[{label:"Distance",value:s.distance_miles?`${Number(s.distance_miles).toFixed(2)} mi`:"--"},{label:"Duration",value:s.duration_seconds?Se(s.duration_seconds):"--"},{label:"Pace",value:_e(s.duration_seconds,s.distance_miles)},{label:"Calories",value:s.calories?`${s.calories} cal`:"--"},{label:"Effort",value:s.perceived_effort?`${s.perceived_effort}/10 - ${Ce[s.perceived_effort]||""}`:"--"},{label:"Surface",value:s.surface||s.run_type||"--"}];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{background:"rgba(0,0,0,0.7)"},onClick:o,children:e.jsxs("div",{className:"w-full rounded-t-2xl p-6 pb-10 max-h-[85vh] overflow-y-auto",style:{background:"var(--bg-card)"},onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:"Run Detail"}),e.jsx("button",{onClick:o,children:e.jsx(se,{size:20,style:{color:"var(--text-muted)"}})})]}),e.jsx("p",{className:"text-sm mb-5",style:{color:"var(--text-muted)"},children:_}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-5",children:R.map(({label:x,value:n})=>e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:x}),e.jsx("p",{className:"font-semibold text-sm",style:{color:"var(--text-primary)"},children:n})]},x))}),h&&e.jsxs("div",{className:"rounded-xl p-3 mb-5",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Heart Rate Zone"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:[N," bpm"]}),e.jsxs("span",{className:"rounded-full px-2 py-1 text-xs",style:{background:`${h.color}22`,color:h.color},children:[h.key," · ",h.name]})]}),e.jsx("div",{className:"mt-2 h-1.5 rounded-full",style:{background:"var(--bg-base)"},children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${Math.min(100,f*100)}%`,background:h.color}})})]}),s.notes&&e.jsxs("div",{className:"rounded-xl p-3 mb-5",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Notes"}),e.jsxs("p",{className:"text-sm italic",style:{color:"var(--text-primary)"},children:['"',s.notes,'"']})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-base)",border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ae,{size:16,style:{color:"var(--accent)"}}),e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--text-primary)"},children:"AI Coach Feedback"})]}),b?e.jsx("p",{className:"text-sm leading-relaxed",style:{color:"var(--text-muted)"},children:b}):e.jsxs(e.Fragment,{children:[S&&e.jsx("p",{className:"text-xs mb-2",style:{color:"#ef4444"},children:S}),e.jsx("button",{onClick:D,disabled:v,className:"w-full py-2.5 rounded-xl text-sm font-semibold",style:{background:"var(--accent)",color:"#000"},children:v?"Analyzing your run...":"Get AI Feedback"})]})]})]})})}function Me(s=0){const o=Math.floor(s/3600),c=Math.floor(s%3600/60);return o>0?`${o}h ${c}m`:`${c}m`}function Re({session:s,onClose:o,onFeedbackGenerated:c}){const[b,w]=r.useState([]),[v,m]=r.useState(!0),[S,p]=r.useState(s.ai_feedback||""),[D,_]=r.useState(!1),[N,L]=r.useState("");r.useEffect(()=>{$.get(`/workouts/${s.id}/sets`).then(n=>{w(n.data.sets||[]),m(!1)}).catch(()=>m(!1))},[s.id]);const f=async()=>{var n,g;_(!0),L("");try{const y=await $.post(`/workouts/${s.id}/feedback`);p(y.data.feedback),c&&c(s.id,y.data.feedback)}catch(y){L(((g=(n=y.response)==null?void 0:n.data)==null?void 0:g.error)||"Could not generate feedback.")}finally{_(!1)}},h={};for(const n of b)h[n.exercise_name]||(h[n.exercise_name]=[]),h[n.exercise_name].push(n);const R=new Date(s.started_at||s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),x=Array.isArray(s.muscle_groups)?s.muscle_groups:[];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end",style:{background:"rgba(0,0,0,0.7)"},onClick:o,children:e.jsxs("div",{className:"w-full rounded-t-2xl p-6 pb-10 max-h-[85vh] overflow-y-auto",style:{background:"var(--bg-card)"},onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:"Workout Detail"}),e.jsx("button",{onClick:o,children:e.jsx(se,{size:20,style:{color:"var(--text-muted)"}})})]}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--text-muted)"},children:R}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-5",children:[e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Duration"}),e.jsx("p",{className:"font-semibold text-sm",style:{color:"var(--text-primary)"},children:s.total_seconds?Me(s.total_seconds):"--"})]}),e.jsxs("div",{className:"rounded-xl p-3",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Total Sets"}),e.jsx("p",{className:"font-semibold text-sm",style:{color:"var(--text-primary)"},children:b.length})]})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-5",children:x.map(n=>e.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-semibold capitalize",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:n},n))}),v?e.jsx("p",{className:"text-sm text-center py-4",style:{color:"var(--text-muted)"},children:"Loading sets..."}):Object.keys(h).length>0?e.jsx("div",{className:"space-y-4 mb-5",children:Object.entries(h).map(([n,g])=>e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"font-semibold text-sm mb-3",style:{color:"var(--text-primary)"},children:n}),e.jsx("div",{className:"space-y-2",children:g.map((y,E)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:["Set ",y.set_number||E+1]}),e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:[y.reps?`${y.reps} reps`:"--",y.weight_lbs?` @ ${y.weight_lbs} lbs`:""]})]},E))})]},n))}):e.jsx("p",{className:"text-sm mb-5",style:{color:"var(--text-muted)"},children:"No set data recorded for this session."}),s.notes&&e.jsxs("div",{className:"rounded-xl p-3 mb-5",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Notes"}),e.jsxs("p",{className:"text-sm italic",style:{color:"var(--text-primary)"},children:['"',s.notes,'"']})]}),e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-base)",border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ae,{size:16,style:{color:"var(--accent)"}}),e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--text-primary)"},children:"AI Coach Feedback"})]}),S?e.jsx("p",{className:"text-sm leading-relaxed",style:{color:"var(--text-muted)"},children:S}):e.jsxs(e.Fragment,{children:[N&&e.jsx("p",{className:"text-xs mb-2",style:{color:"#ef4444"},children:N}),e.jsx("button",{onClick:f,disabled:D,className:"w-full py-2.5 rounded-xl text-sm font-semibold",style:{background:"var(--accent)",color:"#000"},children:D?"Analyzing your workout...":"Get AI Feedback"})]})]})]})})}function G(s){var o;return s.date||((o=s.created_at)==null?void 0:o.slice(0,10))||""}function $e(s=0){const o=Math.floor(s/60),c=s%60;return`${o}:${String(c).padStart(2,"0")}`}function Le(s=0){const o=Math.floor(s/3600),c=Math.floor(s%3600/60);return o>0?`${o}h ${c}m`:`${c}m`}function We(){const s=be(),{fmt:o}=he(),{t:c,i18n:b}=ve(),[w,v]=r.useState(!0),[m,S]=r.useState("all"),[p,D]=r.useState("all"),[_,N]=r.useState([]),[L,f]=r.useState([]),[h,R]=r.useState([]),[x,n]=r.useState([]),[g,y]=r.useState(null),[E,u]=r.useState(null),[i,C]=r.useState(null),[A,T]=r.useState(null),[Y,U]=r.useState(!1),H=new Date().getFullYear(),[P,X]=r.useState(null),[j,B]=r.useState({from:"",to:""}),[re,J]=r.useState(!1);r.useEffect(()=>{(async()=>{var t,a,l,d;try{const[k,M,W,me]=await Promise.all([$.get("/runs"),$.get("/lifts"),$.get("/workouts").catch(()=>({data:{sessions:[]}})),$.get("/races").catch(()=>({data:{races:[]}}))]);N([...Array.isArray(k.data)?k.data:((t=k.data)==null?void 0:t.runs)||[]].sort((F,I)=>G(I).localeCompare(G(F)))),f([...Array.isArray(M.data)?M.data:((a=M.data)==null?void 0:a.lifts)||[]].sort((F,I)=>(I.date||I.created_at||"").localeCompare(F.date||F.created_at||""))),R([...((l=W.data)==null?void 0:l.sessions)||[]].sort((F,I)=>(I.started_at||"").localeCompare(F.started_at||""))),n([...((d=me.data)==null?void 0:d.races)||[]].sort((F,I)=>(I.race_date||"").localeCompare(F.race_date||"")))}finally{v(!1)}})()},[]),r.useEffect(()=>{if(!w){const t=new URLSearchParams(s.search),a=t.get("runId"),l=t.get("workoutId");if(a){const d=_.find(k=>k.id===a);d&&C(d)}if(l){const d=h.find(k=>k.id===l);d&&T(d)}}},[w,s.search,_,h]);const le=async(t,a)=>{a.stopPropagation(),confirm("Delete this run?")&&(await $.delete(`/runs/${t}`),N(l=>l.filter(d=>d.id!==t)))},oe=async(t,a)=>{a.stopPropagation(),confirm("Delete this lift?")&&(await $.delete(`/lifts/${t}`),f(l=>l.filter(d=>d.id!==t)))},ce=t=>{N(a=>a.map(l=>l.id===t.id?{...l,...t}:l)),y(null)},ne=t=>{f(a=>a.map(l=>l.id===t.id?{...l,...t}:l)),u(null)},O=(t,a)=>{if(j.from||j.to)return t.filter(k=>{const M=(k[a]||k.created_at||"").slice(0,10);return!(j.from&&M<j.from||j.to&&M>j.to)});if(P)return t.filter(k=>(k[a]||k.created_at||"").slice(0,10).startsWith(String(P)));if(p==="all")return t;const l={week:7,month:30,year:365}[p],d=new Date(Date.now()-l*864e5).toISOString().slice(0,10);return t.filter(k=>(k[a]||k.created_at||"").slice(0,10)>=d)},z=O(_,"date"),V=O(L,"date"),Z=O(h,"started_at"),de=r.useMemo(()=>z.reduce((t,a)=>t+Number(a.distance_miles||0),0),[z]),ie=r.useMemo(()=>{const t=z.filter(l=>l.distance_miles&&l.duration_seconds);if(!t.length)return"--";const a=t.reduce((l,d)=>l+d.duration_seconds/d.distance_miles,0)/t.length;return o.pace(a)},[z,o]),xe=r.useMemo(()=>{const t=[];for(let a=7;a>=0;a-=1){const l=new Date;l.setDate(l.getDate()-a*7);const d=new Date(l);d.setDate(d.getDate()+6);const k=_.filter(M=>{const W=new Date((M.date||M.created_at||"")+"T12:00:00");return W>=l&&W<=d}).reduce((M,W)=>M+Number(W.distance_miles||0),0);t.push({week:`${l.getMonth()+1}/${l.getDate()}`,miles:Number(k.toFixed(1))})}return t},[_]),ue=r.useMemo(()=>z.slice(0,20).reverse().map((t,a)=>({idx:a+1,pace:t.distance_miles?Number((t.duration_seconds/60/t.distance_miles).toFixed(2)):0})).filter(t=>t.pace>0),[z]);return w?e.jsx(ge,{message:"Loading history"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 grid grid-cols-3 gap-2",children:[["Distance",o.distance(de,1)],["Avg Pace",ie],["Lifts",`${V.length+Z.length}`]].map(([t,a])=>e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.7},children:t}),e.jsx("p",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:a})]},t))}),e.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[e.jsx(K,{to:"/recap",style:{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:20,background:"#EAB308",color:"#000",fontWeight:700,fontSize:13,textDecoration:"none"},children:"Weekly Recap"}),e.jsx(K,{to:"/journal",className:"text-sm",style:{color:"var(--accent)"},children:"View Journal"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mb-4",children:[e.jsx("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:e.jsx("div",{style:{width:"100%",height:180},children:e.jsx(ResponsiveContainer,{children:e.jsxs(BarChart,{data:xe,children:[e.jsx(XAxis,{dataKey:"week",stroke:"#fff",tick:{fontSize:10}}),e.jsx(YAxis,{stroke:"#fff",tick:{fontSize:10}}),e.jsx(Tooltip,{}),e.jsx(Bar,{dataKey:"miles",fill:"#EAB308"})]})})})}),e.jsx("div",{className:"rounded-xl p-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:e.jsx("div",{style:{width:"100%",height:180},children:e.jsx(ResponsiveContainer,{children:e.jsxs(LineChart,{data:ue,children:[e.jsx(XAxis,{dataKey:"idx",stroke:"#fff",tick:{fontSize:10}}),e.jsx(YAxis,{stroke:"#fff",tick:{fontSize:10}}),e.jsx(Tooltip,{}),e.jsx(Line,{type:"monotone",dataKey:"pace",stroke:"#EAB308",strokeWidth:2,dot:!1})]})})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{style:{display:"flex",gap:8,overflowX:"auto",paddingBottom:4,marginBottom:12},children:[Array.from({length:1},(t,a)=>H-a).map(t=>e.jsx("button",{onClick:()=>{X(P===t?null:t),B({from:"",to:""})},style:{flexShrink:0,padding:"6px 16px",borderRadius:20,border:`1.5px solid ${P===t?"var(--accent)":"var(--border-subtle)"}`,background:P===t?"var(--accent)":"var(--bg-input)",color:P===t?"black":"var(--text-muted)",fontWeight:700,fontSize:13,cursor:"pointer",whiteSpace:"nowrap"},children:t},t)),e.jsx("button",{onClick:()=>{J(t=>!t),X(null)},style:{flexShrink:0,padding:"6px 14px",borderRadius:20,border:`1.5px solid ${j.from||j.to?"var(--accent)":"var(--border-subtle)"}`,background:j.from||j.to?"var(--accent-dim)":"var(--bg-input)",color:j.from||j.to?"var(--accent)":"var(--text-muted)",fontWeight:700,fontSize:13,cursor:"pointer",whiteSpace:"nowrap"},children:"Custom Range"})]}),re&&e.jsxs("div",{className:"rounded-xl p-4 mb-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"text-xs font-semibold mb-3",style:{color:"var(--text-muted)"},children:"Custom Date Range"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"From"}),e.jsx("input",{type:"date",value:j.from,min:`${H-5}-01-01`,max:new Date().toISOString().slice(0,10),onChange:t=>B(a=>({...a,from:t.target.value})),style:{width:"100%",background:"var(--bg-input)",border:"1px solid var(--border-subtle)",borderRadius:8,padding:"8px 10px",color:"var(--text-primary)",fontSize:13}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs mb-1 block",style:{color:"var(--text-muted)"},children:"To"}),e.jsx("input",{type:"date",value:j.to,min:`${H-5}-01-01`,max:new Date().toISOString().slice(0,10),onChange:t=>B(a=>({...a,to:t.target.value})),style:{width:"100%",background:"var(--bg-input)",border:"1px solid var(--border-subtle)",borderRadius:8,padding:"8px 10px",color:"var(--text-primary)",fontSize:13}})]})]}),(j.from||j.to)&&e.jsx("button",{onClick:()=>{B({from:"",to:""}),J(!1)},className:"mt-3 text-xs",style:{color:"var(--text-muted)"},children:"Clear"})]})]}),e.jsx("div",{className:"mb-4 flex rounded-xl overflow-hidden border",style:{borderColor:"var(--border-subtle)",opacity:P||j.from||j.to?.4:1},children:["week","month","year","all"].map(t=>e.jsx("button",{onClick:()=>D(t),className:"flex-1 py-2 text-xs font-semibold uppercase",style:p===t?{background:"var(--accent)",color:"black"}:{background:"var(--bg-input)",color:"var(--text-muted)"},children:t==="week"?"W":t==="month"?"M":t==="year"?"Y":"All"},t))}),e.jsx("div",{className:"mb-4 flex border-b",style:{borderColor:"var(--border-subtle)"},children:[["all","All"],["runs",c("history.runs")],["lifts",c("history.workouts")],["races",c("history.races")]].map(([t,a])=>e.jsx("button",{onClick:()=>S(t),className:"px-4 py-2 text-sm font-medium border-b-2",style:m===t?{borderColor:"var(--accent)",color:"var(--text-primary)"}:{borderColor:"transparent",color:"var(--text-muted)"},children:a},t))}),(m==="all"||m==="runs")&&e.jsxs("div",{className:"space-y-3 mb-3",children:[z.map(t=>e.jsxs("div",{onClick:()=>C(t),className:"cursor-pointer rounded-xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:new Date(G(t)).toLocaleDateString()}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.perceived_effort?e.jsxs("span",{className:"rounded-full px-2 py-1 text-xs",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:["Effort ",t.perceived_effort,"/10"]}):null,e.jsx("button",{onClick:a=>{a.stopPropagation(),y(t)},className:"transition-colors",style:{color:"var(--text-muted)"},children:e.jsx(Q,{size:14})}),e.jsx("button",{onClick:a=>le(t.id,a),className:"transition-colors",style:{color:"var(--text-muted)"},children:e.jsx(ee,{size:14})})]})]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:[o.distance(Number(t.distance_miles||0),2)," · ",$e(t.duration_seconds)," · ",o.pace(t.duration_seconds/t.distance_miles),(t.calories_burned||t.calories)>0&&e.jsxs("span",{children:[" · ",t.calories_burned||t.calories," cal"]})]}),t.notes&&e.jsxs("p",{className:"mt-1 text-xs italic",style:{color:"var(--text-muted)",opacity:.7},children:['"',t.notes,'"']})]},t.id)),z.length===0&&m!=="lifts"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx("img",{src:"/empty-runs.png",alt:"",className:"w-64 h-64 object-contain"}),e.jsx("p",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:c("history.noRuns")}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Lace up and log your next run."})]}),e.jsx("button",{onClick:()=>U(!0),className:"w-full py-3 rounded-xl text-sm mt-2",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Miss a workout? Let me know - I'll adjust your plan"})]}),(m==="all"||m==="lifts")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:[c("history.workouts")," & ",c("history.races")]}),Z.map(t=>e.jsxs("div",{onClick:()=>T(t),className:"cursor-pointer rounded-xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:new Date(t.started_at||t.created_at).toLocaleDateString()}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:"View Details"})]}),e.jsxs("p",{className:"mt-1 text-sm",style:{color:"var(--text-primary)"},children:["Duration: ",t.total_seconds?Le(t.total_seconds):"--",t.calories_burned>0&&e.jsxs("span",{children:[" · ",t.calories_burned," cal"]})]}),Array.isArray(t.muscle_groups)&&t.muscle_groups.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.muscle_groups.map(a=>e.jsx("span",{className:"rounded-full px-2 py-1 text-xs capitalize",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:a},a))})]},t.id)),V.map(t=>{let a=[];try{a=Array.isArray(t.muscle_groups)?t.muscle_groups:JSON.parse(t.muscle_groups||"[]")}catch{a=[]}return e.jsxs("div",{className:"cursor-pointer rounded-xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:new Date(t.date||t.created_at).toLocaleDateString()}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),u(t)},className:"transition-colors",style:{color:"var(--text-muted)"},children:e.jsx(Q,{size:14})}),e.jsx("button",{onClick:l=>oe(t.id,l),className:"transition-colors",style:{color:"var(--text-muted)"},children:e.jsx(ee,{size:14})})]})]}),e.jsx("p",{className:"mt-1 font-semibold",style:{color:"var(--text-primary)"},children:t.exercise_name}),e.jsxs("p",{className:"mt-1 text-sm",style:{color:"var(--text-muted)"},children:[t.sets," × ",t.reps," @ ",t.weight_lbs," lbs"]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a.map(l=>e.jsx("span",{className:"rounded-full px-2 py-1 text-xs capitalize",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:l},l))})]},t.id)}),V.length===0&&Z.length===0&&m!=="runs"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[e.jsx("img",{src:"/empty-lifts.png",alt:"",className:"w-64 h-64 object-contain"}),e.jsx("p",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:"No lifts recorded for this period."}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Hit the weights."})]})]}),(m==="all"||m==="races")&&e.jsxs("div",{className:"space-y-3",children:[x.length===0?e.jsx("p",{className:"text-center py-8",style:{color:"var(--text-muted)",fontSize:14},children:c("history.noRaces")}):x.map(t=>e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",style:{color:"var(--text-primary)"},children:t.race_name}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:[t.race_date," · ",t.distance_miles," mi",t.location?` · ${t.location}`:""]})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full font-semibold",style:{background:t.status==="completed"?"rgba(34,197,94,0.15)":"rgba(234,179,8,0.15)",color:t.status==="completed"?"#22c55e":"#EAB308"},children:t.status||"upcoming"})]}),t.goal_time_seconds&&e.jsxs("p",{className:"text-xs mt-2",style:{color:"var(--text-muted)"},children:["Goal: ",Math.floor(t.goal_time_seconds/3600)>0?`${Math.floor(t.goal_time_seconds/3600)}h `:"",Math.floor(t.goal_time_seconds%3600/60),":",String(t.goal_time_seconds%60).padStart(2,"0")]})]},t.id)),e.jsx("button",{onClick:()=>window.location.href="/races",style:{width:"100%",padding:"10px 0",borderRadius:12,background:"var(--bg-input)",border:"1px solid var(--border-subtle)",color:"var(--text-muted)",fontSize:13,cursor:"pointer"},children:"+ Add Race"})]}),g&&e.jsx(je,{run:g,onSave:ce,onClose:()=>y(null)}),E&&e.jsx(ke,{lift:E,onSave:ne,onClose:()=>u(null)}),Y&&e.jsx(we,{onClose:()=>U(!1)}),i&&e.jsx(De,{run:i,onClose:()=>C(null),onFeedbackGenerated:(t,a)=>N(l=>l.map(d=>d.id===t?{...d,ai_feedback:a}:d))}),A&&e.jsx(Re,{session:A,onClose:()=>T(null),onFeedbackGenerated:(t,a)=>R(l=>l.map(d=>d.id===t?{...d,ai_feedback:a}:d))})]})}export{We as default};
