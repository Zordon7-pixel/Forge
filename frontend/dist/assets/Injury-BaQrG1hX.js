import{r as a,j as e,A as _e,a as d}from"./index-DlECNy7h.js";import{d as ze,e as ke,s as Re}from"./validation-CCcprX5w.js";import{T as re}from"./triangle-alert-D0yWe0NI.js";import{C as T}from"./circle-check-DZdCMh-5.js";import{D as Ce}from"./dumbbell-DlRYyvq3.js";import{P as Ee}from"./plus-D8DVL4vX.js";import{C as se}from"./circle-BrRMpaLO.js";import{T as we}from"./trending-up-BKwRvpMA.js";import{L as Te}from"./lock-DSnYuW5D.js";const Ie=["knee","hip","ankle","shin","calf","hamstring","lower back","shoulder","other"],We=["Clamshells","Hip Bridges","Calf Raises","Single-Leg Stance","Monster Walks","Foam Roll IT Band","Eccentric Heel Drops"],A=[{type:"first_walk",label:"First Walk"},{type:"first_jog",label:"First Jog"},{type:"first_run",label:"First Run"},{type:"pain_free_day",label:"Pain Free Day"}];function _(s){return s<=3?"#22c55e":s<=6?"#EAB308":"#ef4444"}function N(s){if(!s)return"";const[o,h,z]=s.split("-");return`${h}/${z}/${o}`}function Be(s,o,h){return Math.max(o,Math.min(h,s))}function De(s){return s<=30?{color:"#ef4444",label:"Rest needed"}:s<=60?{color:"#EAB308",label:"Light activity OK"}:s<=80?{color:"#22c55e",label:"Return to training"}:{color:"#3b82f6",label:"Full training cleared"}}function Me(s){return new Date(`${s}T00:00:00`).toLocaleDateString(void 0,{weekday:"short"}).slice(0,1)}function Ke(){const s=new Date().toISOString().slice(0,10),[o,h]=a.useState("pain"),[z,ie]=a.useState([]),[L,ae]=a.useState([]),[m,ne]=a.useState([]),[$,oe]=a.useState([]),[O,le]=a.useState([]),[f,de]=a.useState({score:0,days_since_injury:0,avg_pain_3d:0,avg_pain_7d:0}),[ce,pe]=a.useState(!0),[k,H]=a.useState(!1),[I,W]=a.useState(""),[R,U]=a.useState({}),[xe,K]=a.useState(!1),[B,C]=a.useState(""),[ue,q]=a.useState(""),[J,ge]=a.useState({first_walk:s,first_jog:s,first_run:s,pain_free_day:s}),X=a.useRef(null),Y=a.useRef(null),[n,v]=a.useState({body_part:"",pain_level:"",notes:"",date:s}),[c,E]=a.useState({name:"",sets:3,reps:10,notes:"",date:s}),b=async()=>{var t,r,i,p;try{const[l,y,S,P,F]=await Promise.all([d.get("/injury/active"),d.get("/injury"),d.get("/pt/exercises"),d.get("/pt/milestones"),d.get("/pt/readiness")]);ie(((t=l.data)==null?void 0:t.injuries)||[]);const te=((r=y.data)==null?void 0:r.injuries)||[];ne(te),ae(te.filter(Se=>Se.cleared===1)),oe(((i=S.data)==null?void 0:i.exercises)||[]),le(((p=P.data)==null?void 0:p.milestones)||[]),de(F.data||{score:0,days_since_injury:0,avg_pain_3d:0,avg_pain_7d:0})}catch{}pe(!1)};a.useEffect(()=>{b()},[]);const G=a.useMemo(()=>ze({bodyPart:n.body_part,injuries:m}),[n.body_part,m]),j=a.useMemo(()=>{const t={};return O.forEach(r=>{t[r.type]||(t[r.type]=r)}),t},[O]),Q=a.useMemo(()=>$.filter(t=>t.date===s).sort((t,r)=>(t.created_at||"").localeCompare(r.created_at||"")),[$,s]),ye=a.useMemo(()=>{const t={};m.forEach(i=>{i.date&&(t[i.date]||(t[i.date]=[]),t[i.date].push(Number(i.pain_level||0)))});const r=[];for(let i=6;i>=0;i-=1){const p=new Date;p.setDate(p.getDate()-i);const l=p.toISOString().slice(0,10),y=t[l]||[],S=y.length?y.reduce((P,F)=>P+F,0)/y.length:0;r.push({date:l,label:Me(l),pain:Number(S.toFixed(1))})}return r},[m]),D=a.useMemo(()=>{const t=[...m].sort((r,i)=>String(i.date||"").localeCompare(String(r.date||""))).slice(0,3);return t.length?t.reduce((r,i)=>r+Number(i.pain_level||0),0)/t.length:0},[m]),V=A.every(t=>!!j[t.type]),Z=!!j.first_walk,me=a.useMemo(()=>V?"ðŸŽ‰ Cleared for full training":D<=1&&Z?"âœ… Ready to try a gentle jog":D<=2&&Number(f.days_since_injury||0)>7?"âœ… Ready to try a short walk":"ðŸ“‹ Keep up PT exercises and rest",[V,D,Z,f.days_since_injury]),be=async t=>{t.preventDefault();const{errors:r}=ke({bodyPart:n.body_part,severity:n.pain_level});if(U(r),Object.keys(r).length){Re({body_part:X,pain_level:Y},["body_part","pain_level"]);return}H(!0);try{await d.post("/injury",{body_part:n.body_part,pain_level:Number(n.pain_level),notes:n.notes,date:n.date}),v({body_part:"",pain_level:"",notes:"",date:s}),U({}),W("Injury logged"),await b(),setTimeout(()=>W(""),2e3)}catch{W("Failed to log injury")}H(!1)},he=async t=>{try{await d.put(`/injury/${t}/clear`),await b()}catch{}},ee=async t=>{try{await d.post("/pt/exercises",t),C("Exercise added"),await b(),setTimeout(()=>C(""),1500)}catch{C("Failed to add exercise")}},fe=async t=>{if(t.preventDefault(),!c.name.trim()){C("Exercise name is required");return}await ee({name:c.name.trim(),sets:Number(c.sets)||3,reps:Number(c.reps)||10,completed:!1,date:c.date||s,notes:c.notes||""}),E({name:"",sets:3,reps:10,notes:"",date:s}),K(!1)},ve=async t=>{const r=Number(t.completed)?0:1;try{await d.put(`/pt/exercises/${t.id}`,{completed:r}),r&&(q(t.id),setTimeout(()=>q(""),450)),await b()}catch{}},je=async t=>{try{await d.post("/pt/milestone",{type:t,date:J[t]||s,notes:""}),await b()}catch{}},x={background:"var(--bg-card)",borderRadius:16,padding:20,marginBottom:12,border:"1px solid var(--border-subtle)"},u={fontSize:11,fontWeight:700,color:"var(--text-muted)",letterSpacing:1,textTransform:"uppercase",marginBottom:14,display:"flex",alignItems:"center",gap:6},g={background:"var(--bg-input)",border:"1px solid var(--border-subtle)",borderRadius:10,padding:"12px 14px",fontSize:14,color:"var(--text-primary)",width:"100%",boxSizing:"border-box"};if(ce)return e.jsx("div",{style:{background:"var(--bg-card)",borderRadius:16,padding:20,color:"var(--text-muted)"},children:"Loading..."});const M=Be(Number(f.score||0),0,100),w=De(M);return e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:24,fontWeight:900,color:"var(--text-primary)",marginBottom:16},children:"PT Recovery Module"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8,marginBottom:14},children:[{key:"pain",label:"Pain Log"},{key:"pt",label:"PT Exercises"},{key:"progress",label:"Recovery Progress"}].map(t=>e.jsx("button",{onClick:()=>h(t.key),style:{border:`1px solid ${o===t.key?"var(--accent)":"var(--border-subtle)"}`,background:o===t.key?"var(--accent-dim)":"var(--bg-card)",color:o===t.key?"var(--accent)":"var(--text-primary)",borderRadius:10,padding:"10px 8px",fontWeight:700,fontSize:13,cursor:"pointer"},children:t.label},t.key))}),o==="pain"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:x,children:[e.jsxs("div",{style:u,children:[e.jsx(re,{size:14,color:"#EAB308"}),"Active Injuries"]}),z.length===0?e.jsx("p",{style:{fontSize:14,color:"var(--text-muted)"},children:"No active injuries"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:z.map(t=>e.jsxs("div",{style:{background:"var(--bg-base)",borderRadius:12,padding:14,border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:15,fontWeight:700,color:"var(--text-primary)",textTransform:"capitalize"},children:String(t.body_part||"").replace(/_/g," ")}),e.jsxs("span",{style:{fontSize:12,fontWeight:700,color:"#000",background:_(t.pain_level),borderRadius:20,padding:"2px 10px"},children:["Pain ",t.pain_level,"/10"]})]}),e.jsx("span",{style:{fontSize:11,color:"var(--text-muted)"},children:N(t.date)})]}),t.notes&&e.jsx("p",{style:{fontSize:13,color:"var(--text-muted)",marginBottom:10,lineHeight:1.4},children:t.notes}),e.jsxs("button",{onClick:()=>he(t.id),style:{display:"flex",alignItems:"center",gap:6,background:"rgba(34,197,94,0.1)",border:"1px solid rgba(34,197,94,0.3)",borderRadius:8,padding:"6px 12px",fontSize:13,fontWeight:600,color:"#22c55e",cursor:"pointer"},children:[e.jsx(T,{size:14}),"Mark Cleared"]})]},t.id))})]}),e.jsxs("div",{style:x,children:[e.jsxs("div",{style:u,children:[e.jsx(re,{size:14}),"Log New Injury"]}),e.jsxs("form",{onSubmit:be,style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:"Body Part"}),e.jsxs("select",{value:n.body_part,onChange:t=>v(r=>({...r,body_part:t.target.value})),style:g,children:[e.jsx("option",{value:"",children:"Select body part"}),Ie.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]}),R.body_part&&e.jsx("p",{ref:X,style:{fontSize:12,color:"#ef4444",marginTop:6},children:R.body_part}),G&&e.jsx("p",{style:{fontSize:12,color:"#f59e0b",marginTop:6},children:G})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:["Pain Level: ",e.jsxs("span",{style:{fontWeight:700,color:_(Number(n.pain_level)||1)},children:[Number(n.pain_level)||1,"/10"]})]}),e.jsx("input",{type:"range",min:1,max:10,step:1,value:n.pain_level||1,onChange:t=>v(r=>({...r,pain_level:Number(t.target.value)})),style:{width:"100%",accentColor:_(Number(n.pain_level)||1)}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:2},children:[e.jsx("span",{style:{fontSize:11,color:"#22c55e"},children:"1 Mild"}),e.jsx("span",{style:{fontSize:11,color:"#EAB308"},children:"5 Moderate"}),e.jsx("span",{style:{fontSize:11,color:"#ef4444"},children:"10 Severe"})]}),R.pain_level&&e.jsx("p",{ref:Y,style:{fontSize:12,color:"#ef4444",marginTop:6},children:R.pain_level})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:"Date"}),e.jsx("input",{type:"date",value:n.date,onChange:t=>v(r=>({...r,date:t.target.value})),style:g})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:"var(--text-muted)",display:"block",marginBottom:6},children:"Notes"}),e.jsx("textarea",{rows:3,placeholder:"Describe the injury, when it started, what aggravates it...",value:n.notes,onChange:t=>v(r=>({...r,notes:t.target.value})),style:{...g,resize:"vertical"}})]}),I&&e.jsx("p",{style:{fontSize:13,color:I.startsWith("Failed")?"#ef4444":"#22c55e"},children:I}),e.jsx("button",{type:"submit",disabled:k,style:{background:"#EAB308",color:"#000",border:"none",borderRadius:10,padding:"12px 0",fontSize:15,fontWeight:700,cursor:k?"not-allowed":"pointer",opacity:k?.7:1},children:k?"Logging...":"Log Injury"})]})]}),e.jsxs("div",{style:x,children:[e.jsxs("div",{style:u,children:[e.jsx(_e,{size:14}),"Injury History"]}),L.length===0?e.jsx("p",{style:{fontSize:14,color:"var(--text-muted)"},children:"No injury history yet"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:L.map(t=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",background:"var(--bg-base)",borderRadius:10,border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(T,{size:14,color:"#22c55e"}),e.jsx("span",{style:{fontSize:14,fontWeight:600,color:"var(--text-primary)",textTransform:"capitalize"},children:String(t.body_part||"").replace(/_/g," ")}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,color:"#000",background:_(t.pain_level),borderRadius:20,padding:"1px 8px"},children:[t.pain_level,"/10"]})]}),e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:N(t.date)})]},t.id))})]})]}),o==="pt"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:x,children:[e.jsxs("div",{style:{...u,marginBottom:10},children:[e.jsx(Ce,{size:14}),"Today's PT Checklist"]}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:12},children:e.jsxs("button",{onClick:()=>K(t=>!t),style:{border:"1px solid var(--accent)",background:"var(--accent-dim)",color:"var(--accent)",borderRadius:10,padding:"8px 12px",fontWeight:700,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[e.jsx(Ee,{size:14}),"Add Exercise"]})}),xe&&e.jsx("form",{onSubmit:fe,style:{border:"1px solid var(--border-subtle)",borderRadius:12,padding:12,marginBottom:12},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:8},children:[e.jsx("input",{placeholder:"Exercise name",value:c.name,onChange:t=>E(r=>({...r,name:t.target.value})),style:g}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx("input",{type:"number",min:1,placeholder:"Sets",value:c.sets,onChange:t=>E(r=>({...r,sets:t.target.value})),style:g}),e.jsx("input",{type:"number",min:1,placeholder:"Reps",value:c.reps,onChange:t=>E(r=>({...r,reps:t.target.value})),style:g})]}),e.jsx("button",{type:"submit",style:{background:"#EAB308",color:"#000",border:"none",borderRadius:10,padding:"10px 0",fontSize:14,fontWeight:700,cursor:"pointer"},children:"Save Exercise"})]})}),B&&e.jsx("p",{style:{fontSize:13,color:B.startsWith("Failed")?"#ef4444":"#22c55e",marginBottom:10},children:B}),Q.length===0?e.jsx("p",{style:{color:"var(--text-muted)",fontSize:14},children:"No PT exercises logged for today."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Q.map(t=>{const r=Number(t.completed)===1,i=ue===t.id;return e.jsxs("button",{onClick:()=>ve(t),style:{width:"100%",textAlign:"left",borderRadius:10,border:r?"1px solid rgba(34,197,94,0.4)":"1px solid var(--border-subtle)",background:r?"rgba(34,197,94,0.12)":"var(--bg-base)",padding:"12px 14px",color:"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 180ms ease",transform:i?"scale(1.02)":"scale(1)",boxShadow:i?"0 0 0 3px rgba(34,197,94,0.18)":"none"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:14},children:t.name}),e.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)"},children:[t.sets," sets x ",t.reps," reps"]})]}),r?e.jsx(T,{size:20,color:"#22c55e"}):e.jsx(se,{size:20,color:"var(--text-muted)"})]},t.id)})})]}),e.jsxs("div",{style:x,children:[e.jsx("div",{style:u,children:"Common PT Exercises"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:We.map(t=>e.jsxs("button",{onClick:()=>ee({name:t,sets:3,reps:10,completed:!1,date:s,notes:""}),style:{border:"1px solid var(--border-subtle)",background:"var(--bg-base)",color:"var(--text-primary)",borderRadius:999,padding:"7px 12px",fontSize:12,fontWeight:600,cursor:"pointer"},children:["+ ",t]},t))})]})]}),o==="progress"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:x,children:[e.jsxs("div",{style:u,children:[e.jsx(we,{size:14}),"Recovery Readiness"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flexWrap:"wrap",marginBottom:14},children:[e.jsx("div",{style:{width:104,height:104,borderRadius:"50%",background:`conic-gradient(${w.color} ${M}%, rgba(255,255,255,0.12) 0)`,display:"grid",placeItems:"center",position:"relative"},children:e.jsx("div",{style:{width:78,height:78,borderRadius:"50%",background:"var(--bg-card)",display:"grid",placeItems:"center",border:"1px solid var(--border-subtle)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:900,color:w.color,lineHeight:1},children:M}),e.jsx("div",{style:{fontSize:10,color:"var(--text-muted)"},children:"of 100"})]})})}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:16,fontWeight:800,color:w.color,marginBottom:4},children:w.label}),e.jsxs("p",{style:{fontSize:13,color:"var(--text-muted)"},children:["Days since injury: ",f.days_since_injury||0]}),e.jsxs("p",{style:{fontSize:13,color:"var(--text-muted)"},children:["Avg pain (3 days): ",Number(f.avg_pain_3d||0).toFixed(1)]})]})]}),e.jsx("div",{style:{border:"1px solid var(--border-subtle)",borderRadius:12,padding:"10px 12px",background:"var(--bg-base)",color:"var(--text-primary)",fontSize:14,fontWeight:600},children:me})]}),e.jsxs("div",{style:x,children:[e.jsx("div",{style:u,children:"Pain Trend (7 Days)"}),e.jsx("div",{style:{display:"flex",alignItems:"end",gap:8,height:100},children:ye.map(t=>{const r=Math.max(6,Math.round(t.pain/10*84));return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[e.jsx("div",{title:`${t.date}: ${t.pain}/10`,style:{width:"100%",maxWidth:28,height:r,borderRadius:8,background:_(t.pain||0),opacity:t.pain===0?.25:.9,transition:"height 160ms ease"}}),e.jsx("span",{style:{fontSize:11,color:"var(--text-muted)"},children:t.label})]},t.date)})})]}),e.jsxs("div",{style:x,children:[e.jsx("div",{style:u,children:"Recovery Milestones"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:A.map((t,r)=>{const i=!!j[t.type],p=A[r-1],l=!!p&&!j[p.type];return e.jsxs("div",{style:{border:"1px solid var(--border-subtle)",borderRadius:12,padding:12,background:l?"rgba(148,163,184,0.08)":"var(--bg-base)",opacity:l?.6:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l?e.jsx(Te,{size:14,color:"var(--text-muted)"}):i?e.jsx(T,{size:14,color:"#22c55e"}):e.jsx(se,{size:14,color:"var(--text-muted)"}),e.jsx("span",{style:{fontWeight:700,color:"var(--text-primary)"},children:t.label})]}),i&&e.jsx("span",{style:{fontSize:12,color:"#22c55e"},children:N(j[t.type].date)})]}),!l&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"date",value:J[t.type]||s,onChange:y=>ge(S=>({...S,[t.type]:y.target.value})),style:{...g,padding:"8px 10px",fontSize:13}}),e.jsx("button",{onClick:()=>je(t.type),style:{border:"1px solid rgba(34,197,94,0.3)",background:i?"rgba(34,197,94,0.15)":"rgba(34,197,94,0.08)",color:"#22c55e",borderRadius:8,padding:"8px 10px",fontSize:12,fontWeight:700,cursor:"pointer",whiteSpace:"nowrap"},children:i?"Update":"Mark Achieved"})]})]},t.type)})})]})]})]})}export{Ke as default};
