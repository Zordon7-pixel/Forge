import{b as Z,e as M,r as n,j as e,a as w}from"./index-vmUng2Mm.js";const l={accent:"#EAB308"};function h(c){const o=Math.floor(c/3600),i=Math.floor(c%3600/60),d=c%60;return o>0?`${o}:${String(i).padStart(2,"0")}:${String(d).padStart(2,"0")}`:`${i}:${String(d).padStart(2,"0")}`}function te(){var $,I,N,B,E;const c=Z(),o=M(),[i,d]=n.useState("idle"),[p,S]=n.useState((($=o.state)==null?void 0:$.durationSeconds)||0),[s,j]=n.useState(""),[a,_]=n.useState(((I=o.state)==null?void 0:I.speed)||""),[g,k]=n.useState(((N=o.state)==null?void 0:N.incline)||"0"),[v,D]=n.useState(((B=o.state)==null?void 0:B.treadmillType)||"Generic"),[m,L]=n.useState(5),[z,A]=n.useState(""),[y,R]=n.useState(!1),[T,C]=n.useState(""),[W,F]=n.useState("0.25"),[x,P]=n.useState([]),[H,O]=n.useState(!1),[G,U]=n.useState(!1),t=((E=o.state)==null?void 0:E.watchMetrics)||null,b=n.useRef(null);n.useEffect(()=>()=>clearInterval(b.current),[]),n.useEffect(()=>{if(x.length<2)return;const r=x[x.length-1];Math.abs(r-.25)<=.02&&O(!0)},[x]);const V=()=>{d("running"),b.current=setInterval(()=>S(r=>r+1),1e3)},Y=()=>{d("paused"),clearInterval(b.current)},q=()=>{d("running"),b.current=setInterval(()=>S(r=>r+1),1e3)},J=()=>{clearInterval(b.current),d("done")},K=async()=>{if(s){R(!0);try{await w.post("/runs",{date:new Date().toISOString().slice(0,10),type:G?"track":"treadmill",run_surface:"treadmill",distance_miles:Number(s),duration_seconds:p,notes:z||`Treadmill run (${v}). Speed: ${a||"?"} mph, Incline: ${g}%.`,perceived_effort:m,treadmill_speed:Number(a)||0,incline_pct:Number(g)||0,pace_splits:x,avg_heart_rate:t==null?void 0:t.avg_heart_rate,max_heart_rate:t==null?void 0:t.max_heart_rate,min_heart_rate:t==null?void 0:t.min_heart_rate,cadence_spm:t==null?void 0:t.cadence_spm,elevation_gain:t==null?void 0:t.elevation_gain,elevation_loss:t==null?void 0:t.elevation_loss,vo2_max:t==null?void 0:t.vo2_max,training_effect_aerobic:t==null?void 0:t.training_effect_aerobic,training_effect_anaerobic:t==null?void 0:t.training_effect_anaerobic,recovery_time_hours:t==null?void 0:t.recovery_time_hours,detected_surface_type:t==null?void 0:t.detected_surface_type,temperature_f:t==null?void 0:t.temperature_f,calories:t==null?void 0:t.calories,treadmill_brand:(t==null?void 0:t.treadmill_brand)||v,treadmill_model:t==null?void 0:t.treadmill_model}),C("Run saved!"),setTimeout(()=>c("/"),1500)}catch{C("Could not save run.")}finally{R(!1)}}},Q=a&&Number(a)>0?(()=>{const r=60/Number(a),f=Math.floor(r),X=Math.round((r-f)*60);return`${f}:${String(X).padStart(2,"0")}/mi`})():"--:--/mi",u=a&&Number(a)>0&&p>0?(Number(a)*p/3600).toFixed(2):null;return e.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-base)",color:"var(--text-primary)",paddingBottom:100},children:[e.jsxs("div",{style:{padding:"16px 16px 0",display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{onClick:()=>c(-1),style:{color:"var(--text-muted)",background:"var(--bg-input)",border:"none",borderRadius:10,padding:"8px 12px",cursor:"pointer",fontSize:14},children:"← Back"}),e.jsx("h1",{style:{fontWeight:900,fontSize:22,margin:0},children:"Treadmill Run"})]}),i==="idle"&&e.jsxs("div",{style:{padding:16,display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:16,padding:16},children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:13,marginBottom:12},children:"Set from treadmill display (optional)"}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{color:"var(--text-muted)",fontSize:12,display:"block",marginBottom:4},children:"Treadmill Type"}),e.jsx("select",{value:v,onChange:r=>D(r.target.value),style:{width:"100%",background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:12,padding:"12px",fontSize:14},children:["Generic","Peloton","NordicTrack","Precor","Life Fitness","Other"].map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:"var(--text-muted)",fontSize:12,display:"block",marginBottom:4},children:"Speed (mph)"}),e.jsx("input",{value:a,onChange:r=>_(r.target.value),type:"number",step:"0.1",placeholder:"6.5",style:{width:"100%",background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:12,padding:"12px",fontSize:16,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:"var(--text-muted)",fontSize:12,display:"block",marginBottom:4},children:"Incline (%)"}),e.jsx("input",{value:g,onChange:r=>k(r.target.value),type:"number",step:"0.5",placeholder:"0",style:{width:"100%",background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:12,padding:"12px",fontSize:16,boxSizing:"border-box"}})]})]}),a&&e.jsxs("p",{style:{color:l.accent,fontSize:13,marginTop:8},children:["Pace: ",Q]})]}),e.jsx("button",{onClick:V,style:{background:l.accent,color:"#000",fontWeight:900,fontSize:18,borderRadius:16,padding:"20px",border:"none",cursor:"pointer"},children:"Start Treadmill Run"})]}),(i==="running"||i==="paused")&&e.jsxs("div",{style:{padding:24,display:"flex",flexDirection:"column",alignItems:"center",gap:24},children:[e.jsx("p",{style:{color:l.accent,fontSize:72,fontWeight:900,fontFamily:"monospace",margin:0},children:h(p)}),e.jsxs("div",{style:{display:"flex",gap:40},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("p",{style:{fontSize:28,fontWeight:700,margin:0},children:u||s||"--"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:13},children:"Miles"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("p",{style:{fontSize:28,fontWeight:700,margin:0},children:a?`${a} mph`:"--"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:13},children:"Speed"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("p",{style:{fontSize:28,fontWeight:700,margin:0},children:[g,"%"]}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:13},children:"Incline"})]})]}),e.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:14,padding:14,width:"100%",boxSizing:"border-box"},children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:12,marginBottom:8},children:"Update treadmill settings"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx("input",{value:a,onChange:r=>_(r.target.value),placeholder:"Speed mph",type:"number",step:"0.1",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:10,padding:"10px",fontSize:14}}),e.jsx("input",{value:g,onChange:r=>k(r.target.value),placeholder:"Incline %",type:"number",step:"0.5",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:10,padding:"10px",fontSize:14}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("input",{value:W,onChange:r=>F(r.target.value),type:"number",step:"0.01",placeholder:"Lap miles",style:{flex:1,background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:10,padding:"10px",fontSize:14}}),e.jsx("button",{onClick:()=>P(r=>[...r,Number(W)||0]),style:{background:"var(--accent)",color:"#000",border:"none",borderRadius:10,padding:"10px 14px",fontWeight:700},children:"Log Lap"})]}),H&&e.jsxs("div",{style:{marginTop:8,background:"rgba(234,179,8,0.15)",border:"1px solid rgba(234,179,8,0.35)",borderRadius:10,padding:8},children:[e.jsx("p",{style:{fontSize:12,color:"var(--text-primary)"},children:"You are logging 400m-style laps. Switch to track mode?"}),e.jsx("button",{onClick:()=>U(!0),style:{marginTop:6,background:"var(--accent)",color:"#000",border:"none",borderRadius:8,padding:"6px 10px",fontSize:12,fontWeight:700},children:"Enable Track Mode"})]})]}),t&&e.jsx("div",{style:{width:"100%",display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[["Avg HR",t.avg_heart_rate&&`${t.avg_heart_rate} bpm`],["Max HR",t.max_heart_rate&&`${t.max_heart_rate} bpm`],["Cadence",t.cadence_spm&&`${t.cadence_spm} spm`],["VO2 Max",t.vo2_max],["Calories",t.calories],["Temp",t.temperature_f&&`${t.temperature_f}°F`]].filter(([,r])=>r).map(([r,f])=>e.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:10,padding:10},children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:11},children:r}),e.jsx("p",{style:{color:"var(--text-primary)",fontWeight:700,fontSize:13},children:f})]},r))}),e.jsxs("div",{style:{display:"flex",gap:12,width:"100%"},children:[i==="running"?e.jsx("button",{onClick:Y,style:{flex:1,background:"rgba(255,255,255,0.1)",color:"#fff",fontWeight:700,fontSize:16,borderRadius:14,padding:"18px",border:"none",cursor:"pointer"},children:"Pause"}):e.jsx("button",{onClick:q,style:{flex:1,background:l.accent,color:"#000",fontWeight:700,fontSize:16,borderRadius:14,padding:"18px",border:"none",cursor:"pointer"},children:"Resume"}),e.jsx("button",{onClick:J,style:{flex:1,background:"#ef4444",color:"#fff",fontWeight:700,fontSize:16,borderRadius:14,padding:"18px",border:"none",cursor:"pointer"},children:"Finish"})]})]}),i==="done"&&e.jsxs("div",{style:{padding:16,display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:16,padding:16},children:[e.jsxs("p",{style:{fontWeight:700,fontSize:18,margin:"0 0 12px"},children:["Run complete — ",h(p)]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{style:{background:"var(--bg-input)",borderRadius:10,padding:12},children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:12},children:"Time"}),e.jsx("p",{style:{fontWeight:700},children:h(p)})]}),e.jsxs("div",{style:{background:"var(--bg-input)",borderRadius:10,padding:12},children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:12},children:"Speed"}),e.jsxs("p",{style:{fontWeight:700},children:[a||"--"," mph"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:"var(--text-muted)",fontSize:12,display:"block",marginBottom:4},children:"Distance (check treadmill display)"}),e.jsx("input",{value:s,onChange:r=>j(r.target.value),placeholder:u?`Estimated: ${u} mi`:"Enter miles from treadmill",type:"number",step:"0.01",style:{width:"100%",background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:12,padding:"14px",fontSize:16,boxSizing:"border-box"}}),u&&!s&&e.jsxs("button",{onClick:()=>j(u),style:{marginTop:6,background:"none",border:"none",color:l.accent,fontSize:13,cursor:"pointer",padding:0},children:["Use estimated: ",u," mi"]})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{color:"var(--text-muted)",fontSize:12,display:"block",marginBottom:4},children:["Effort: ",m,"/10"]}),e.jsx("div",{style:{display:"flex",gap:4},children:[1,2,3,4,5,6,7,8,9,10].map(r=>e.jsx("button",{onClick:()=>L(r),style:{flex:1,height:32,borderRadius:6,background:r<=m?l.accent:"var(--bg-input)",color:r<=m?"#000":"var(--text-muted)",border:"none",cursor:"pointer",fontWeight:700,fontSize:11},children:r},r))})]}),e.jsx("textarea",{value:z,onChange:r=>A(r.target.value),placeholder:"Notes (optional)",rows:2,style:{width:"100%",background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",borderRadius:12,padding:"14px",fontSize:14,resize:"none",boxSizing:"border-box"}}),T&&e.jsx("p",{style:{color:l.accent,textAlign:"center"},children:T}),e.jsx("button",{onClick:K,disabled:y||!s,style:{background:s?l.accent:"var(--bg-input)",color:"#000",fontWeight:900,fontSize:16,borderRadius:14,padding:"18px",border:"none",cursor:"pointer",opacity:y?.6:1},children:y?"Saving...":"Save Run"})]})]})}export{te as default};
