import{r as s,j as t,a as c}from"./index-DlECNy7h.js";import{C as z}from"./circle-check-DZdCMh-5.js";import{C as q}from"./circle-BrRMpaLO.js";function G(d={}){if(d.type==="run"){const u=Number(d.distance_miles||0);if(u>0)return`${d.title||"Run"} Â· ${u.toFixed(1)} mi`}return d.title||String(d.type||"session").replace("_"," ")}function O(){var M;const[d,u]=s.useState([]),[a,v]=s.useState(null),[i,h]=s.useState(null),[l,P]=s.useState(null),[p,f]=s.useState(!1),[j,N]=s.useState(!1),[W,k]=s.useState(!0),[w,S]=s.useState(null),[y,x]=s.useState(!1),m=async()=>{var e,o,R;k(!0),f(!0);try{const[I,L,g]=await Promise.all([c.get("/plans"),c.get("/plans/my"),c.get("/plans/adaptive/recommend").catch(()=>({data:null}))]);u(((e=I.data)==null?void 0:e.plans)||[]),v(((o=L.data)==null?void 0:o.plan)||null),h(((R=L.data)==null?void 0:R.user_plan)||null),P((g==null?void 0:g.data)||null)}finally{k(!1),f(!1)}};s.useEffect(()=>{m()},[]);const $=async e=>{S(e);try{await c.post(`/plans/assign/${e}`),await m()}finally{S(null)}},r=Math.max(1,Number((i==null?void 0:i.current_week)||1)),n=s.useMemo(()=>{var o;const e=((o=a==null?void 0:a.plan_data)==null?void 0:o.weeks)||[];return e[r-1]||e[0]||null},[a,r]),b=new Set(((M=i==null?void 0:i.progress)==null?void 0:M.completedSessionIds)||[]),A=((n==null?void 0:n.sessions)||[]).filter(e=>e.type!=="rest").length,F=((n==null?void 0:n.sessions)||[]).filter(e=>e.type!=="rest"&&b.has(String(e.id))).length,C=A>0?Math.round(F/A*100):0,T=async e=>{const o=b.has(String(e));x(!0);try{await c.put("/plans/my/progress",o?{unset_session_id:e,current_week:r}:{completed_session_id:e,current_week:r}),await m()}finally{x(!1)}},_=async e=>{x(!0);try{await c.put("/plans/my/progress",{current_week:e}),await m()}finally{x(!1)}},B=async()=>{N(!0);try{await c.post("/plans/adaptive/accept"),await m()}finally{N(!1)}},E=s.useMemo(()=>{const e=String((l==null?void 0:l.intensity)||"normal").toLowerCase();return e==="recovery"?{label:"ðŸ”´ Recovery",color:"#EF4444"}:e==="reduced"?{label:"ðŸŸ¡ Reduced",color:"#EAB308"}:e==="increased"?{label:"ðŸ’ª Increased",color:"#22C55E"}:{label:"ðŸŸ¢ Normal",color:"#16A34A"}},[l==null?void 0:l.intensity]);return W?t.jsx("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",color:"var(--text-muted)"},children:"Loading training plans..."}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"rounded-2xl p-4 space-y-3",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:"Adaptive Plan"}),t.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:"This week's recommended plan based on your check-ins."})]}),t.jsx("span",{className:"text-xs font-bold rounded-full px-3 py-1",style:{background:"var(--bg-input)",color:E.color},children:E.label})]}),p&&t.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Loading adaptive recommendation..."}),!p&&!l&&t.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Adaptive recommendation is not available yet."}),!p&&l&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:l.reason||l.recommendation}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:(l.sessions||[]).map(e=>t.jsxs("div",{className:"rounded-lg p-3",style:{background:"var(--bg-input)",border:"1px solid var(--border-subtle)"},children:[t.jsx("p",{className:"text-xs font-semibold",style:{color:"var(--text-muted)"},children:e.day}),t.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:e.title}),t.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:e.type==="run"&&Number(e.distance_miles||0)>0?`${Number(e.distance_miles).toFixed(1)} mi`:e.type==="rest"?"Rest day":"Strength session"})]},e.id))}),t.jsx("button",{onClick:B,disabled:j,className:"rounded-lg px-4 py-2 text-sm font-semibold disabled:opacity-60",style:{background:"var(--accent)",color:"#000"},children:j?"Saving...":"Accept Plan"})]})]}),t.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[t.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Training Plans"}),t.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:"Running-first plans. Strength sessions focus on injury prevention only."})]}),!a&&t.jsx("div",{className:"grid gap-3",children:d.map(e=>t.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[t.jsx("p",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:e.name}),t.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:[e.type," Â· ",e.weeks," weeks"]}),t.jsx("p",{className:"text-sm mt-2",style:{color:"var(--text-muted)"},children:e.description}),t.jsx("button",{onClick:()=>$(e.id),disabled:w===e.id,className:"mt-3 rounded-lg px-4 py-2 text-sm font-semibold disabled:opacity-60",style:{background:"var(--accent)",color:"#000"},children:w===e.id?"Assigning...":"Assign Plan"})]},e.id))}),a&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:[t.jsx("p",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:a.name}),t.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:[a.type," Â· Week ",r," of ",a.weeks]}),t.jsx("div",{className:"mt-3 h-2 rounded-full",style:{background:"var(--bg-input)"},children:t.jsx("div",{className:"h-2 rounded-full",style:{width:`${C}%`,background:"#EAB308"}})}),t.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:[C,"% complete this week"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>_(Math.max(1,r-1)),disabled:r<=1||y,className:"rounded-lg px-3 py-1.5 text-xs font-semibold disabled:opacity-50",style:{background:"var(--bg-input)",color:"var(--text-primary)"},children:"Previous Week"}),t.jsx("button",{onClick:()=>_(Math.min(Number(a.weeks||r),r+1)),disabled:r>=Number(a.weeks||r)||y,className:"rounded-lg px-3 py-1.5 text-xs font-semibold disabled:opacity-50",style:{background:"var(--bg-input)",color:"var(--text-primary)"},children:"Next Week"})]}),t.jsx("div",{className:"rounded-xl p-4 space-y-2",style:{background:"var(--bg-card)",border:"1px solid var(--border-subtle)"},children:((n==null?void 0:n.sessions)||[]).map(e=>{const o=b.has(String(e.id));return t.jsxs("button",{onClick:()=>e.type!=="rest"&&T(e.id),disabled:y||e.type==="rest",className:"w-full rounded-lg p-3 flex items-center justify-between disabled:opacity-70",style:{background:"var(--bg-input)"},children:[t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:e.day}),t.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:G(e)})]}),e.type==="rest"?t.jsx("p",{className:"text-xs font-semibold",style:{color:"var(--text-muted)"},children:"REST"}):o?t.jsx(z,{size:18,color:"#EAB308"}):t.jsx(q,{size:18,color:"var(--text-muted)"})]},e.id)})}),t.jsx("button",{onClick:()=>{v(null),h(null)},className:"rounded-lg px-4 py-2 text-sm font-semibold",style:{background:"var(--bg-input)",color:"var(--text-primary)"},children:"Change Plan"})]})]})}export{O as default};
