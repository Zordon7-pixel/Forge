import{r as s,a as N,j as e,f as xe,b as me,e as pe}from"./index-DlECNy7h.js";import{g as be,a as he,s as oe}from"./validation-CCcprX5w.js";function fe({muscleGroup:l,onSelect:u,onClose:x}){const[n,j]=s.useState([]),[i,h]=s.useState(""),[$,k]=s.useState(!0),[P,f]=s.useState(!1),[y,w]=s.useState(""),[D,c]=s.useState(""),[o,F]=s.useState(null),[E,m]=s.useState(""),[g,v]=s.useState(!1);s.useEffect(()=>{R()},[l]);const R=async()=>{k(!0);try{const r=l?{muscle_group:l}:{},p=await N.get("/exercises",{params:r});j(Array.isArray(p.data)?p.data:[])}finally{k(!1)}},S=n.filter(r=>r.name.toLowerCase().includes(i.toLowerCase())),T=async()=>{var r,p;if(y.trim()){v(!0),m("");try{(await N.post("/exercises",{name:y.trim(),muscle_group:l||"other",instructions:D.trim()})).data.alreadyExists?m("Already in the library — found it!"):m("Added to community library!"),await R(),setTimeout(()=>{f(!1),w(""),c(""),m("")},1200)}catch(C){m(((p=(r=C==null?void 0:C.response)==null?void 0:r.data)==null?void 0:p.error)||"Could not add exercise.")}finally{v(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/70",onClick:r=>{r.target===r.currentTarget&&x()},children:e.jsxs("div",{className:"w-full max-w-lg rounded-t-2xl flex flex-col max-h-[80vh] relative",style:{background:"var(--bg-card)"},children:[o&&e.jsxs("div",{className:"absolute inset-0 z-10 rounded-t-2xl flex flex-col",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--border-subtle)"},children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:o.name}),e.jsx("button",{onClick:()=>F(null),className:"text-sm px-3 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Back"})]}),e.jsxs("div",{className:"overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:["Primary: ",o.muscle_group]}),o.secondary_muscles&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:["Also: ",o.secondary_muscles]})]}),o.how_to_image_url&&e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsx("img",{src:o.how_to_image_url,alt:o.name,className:"w-full object-contain max-h-48",onError:r=>{r.target.style.display="none"}})}),o.instructions?e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--bg-input)"},children:[e.jsx("p",{className:"text-sm font-semibold mb-2",style:{color:"var(--text-primary)"},children:"How to do it"}),e.jsx("p",{className:"text-sm leading-relaxed",style:{color:"var(--text-muted)"},children:o.instructions})]}):e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No instructions yet for this exercise."}),!o.is_system&&e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)",opacity:.6},children:"Community exercise — added by a FORGE user"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("button",{onClick:()=>{u(o),x()},className:"w-full py-3 rounded-xl font-bold text-black",style:{background:"var(--accent)"},children:["Select ",o.name]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:"Choose Exercise"}),l&&e.jsx("p",{className:"text-xs mt-0.5 capitalize",style:{color:"var(--text-muted)"},children:l})]}),e.jsx("button",{onClick:x,className:"text-sm px-3 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Close"})]}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:"var(--border-subtle)"},children:e.jsx("input",{type:"text",value:i,onChange:r=>h(r.target.value),placeholder:"Search exercises...",autoFocus:!0,className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}})}),e.jsx("div",{className:"overflow-y-auto flex-1 p-4 space-y-2",children:$?e.jsx("p",{className:"text-center py-8 text-sm",style:{color:"var(--text-muted)"},children:"Loading..."}):S.length===0&&!i?e.jsx("p",{className:"text-center py-8 text-sm",style:{color:"var(--text-muted)"},children:"No exercises for this muscle group yet."}):S.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsxs("p",{className:"text-sm mb-3",style:{color:"var(--text-muted)"},children:['No results for "',i,'"']}),!P&&e.jsxs("button",{onClick:()=>{w(i),f(!0)},className:"text-sm font-semibold px-4 py-2 rounded-xl",style:{background:"var(--accent-dim)",color:"var(--accent)"},children:['Add "',i,'" to library']})]}):S.map(r=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl px-4 py-3 cursor-pointer transition-all hover:opacity-80",style:{background:"var(--bg-input)"},children:[e.jsxs("button",{className:"flex-1 text-left",onClick:()=>{u(r),x()},children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:r.name}),r.secondary_muscles&&e.jsxs("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:["Also: ",r.secondary_muscles]}),!r.is_system&&e.jsx("span",{className:"text-xs",style:{color:"var(--accent)",opacity:.7},children:"community"})]}),(r.instructions||r.how_to_image_url)&&e.jsx("button",{onClick:p=>{p.stopPropagation(),F(r)},className:"ml-3 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",style:{background:"var(--accent-dim)",color:"var(--accent)"},title:"How to do this exercise",children:"?"})]},r.id))}),e.jsx("div",{className:"border-t p-4",style:{borderColor:"var(--border-subtle)"},children:P?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold",style:{color:"var(--accent)"},children:"New exercise — saved for everyone"}),e.jsx("input",{type:"text",value:y,onChange:r=>w(r.target.value),placeholder:"Exercise name (e.g. Sissy Squat)",className:"w-full px-4 py-3 rounded-xl text-sm outline-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}}),e.jsx("textarea",{value:D,onChange:r=>c(r.target.value),placeholder:"How to do it (optional — helps other users)",rows:2,className:"w-full px-4 py-3 rounded-xl text-sm outline-none resize-none",style:{background:"var(--bg-input)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"}}),E&&e.jsx("p",{className:"text-xs text-center font-medium",style:{color:"var(--accent)"},children:E}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{f(!1),w(""),c(""),m("")},className:"flex-1 py-3 rounded-xl text-sm",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Cancel"}),e.jsx("button",{onClick:T,disabled:g||!y.trim(),className:"flex-1 py-3 rounded-xl text-sm font-bold text-black",style:{background:y.trim()?"var(--accent)":"var(--bg-input)",opacity:g?.6:1},children:g?"Adding...":"Add Exercise"})]})]}):e.jsx("button",{onClick:()=>f(!0),className:"w-full py-3 rounded-xl text-sm font-semibold",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:"Don't see yours? Add it to the library"})})]})})}const ye=[30,60,90,120,180];function ne(l){const u=Math.floor(l/3600),x=Math.floor(l%3600/60),n=l%60;return u>0?`${u}:${String(x).padStart(2,"0")}:${String(n).padStart(2,"0")}`:`${x}:${String(n).padStart(2,"0")}`}function ge(){try{const l=new(window.AudioContext||window.webkitAudioContext),u=(x,n,j)=>{const i=l.createOscillator(),h=l.createGain();i.connect(h),h.connect(l.destination),i.frequency.value=x,i.type="sine",h.gain.setValueAtTime(.5,l.currentTime+n),h.gain.exponentialRampToValueAtTime(.001,l.currentTime+n+j),i.start(l.currentTime+n),i.stop(l.currentTime+n+j+.1)};u(880,0,.15),u(1100,.2,.15),u(880,.4,.15),u(1320,.6,.3)}catch{}}function je(){var re,ae;const{id:l}=xe(),u=me(),x=pe(),n=((re=x.state)==null?void 0:re.exercises)||[],j=((ae=x.state)==null?void 0:ae.workoutName)||"",[i,h]=s.useState(0),$=s.useRef(null),[k,P]=s.useState(0),[f,y]=s.useState(""),[w,D]=s.useState([]),[c,o]=s.useState(null),[F,E]=s.useState(!1),[m,g]=s.useState(""),[v,R]=s.useState(""),[S,T]=s.useState(1),[r,p]=s.useState([]),[C,G]=s.useState([]),[A,M]=s.useState({}),[V,B]=s.useState(""),[Q,ce]=s.useState(!0),[_,J]=s.useState(0),[W,H]=s.useState(!1),z=s.useRef(null),[O,de]=s.useState(null),[K,U]=s.useState(!1),X=s.useRef(null),Y=s.useRef(null),Z=s.useRef(null);s.useEffect(()=>($.current=setInterval(()=>h(t=>t+1),1e3),()=>clearInterval($.current)),[]),s.useEffect(()=>{N.get(`/workouts/${l}`).then(t=>{var d,b;const a=((b=(d=t.data)==null?void 0:d.session)==null?void 0:b.muscle_groups)||[];D(a),a.length>0&&y(a[0])}).catch(()=>{})},[l]),s.useEffect(()=>{N.get(`/workouts/${l}/sets`).then(t=>{var a;p(((a=t.data)==null?void 0:a.sets)||[])}).catch(()=>{})},[l]),s.useEffect(()=>{N.get("/lifts").then(t=>{var a;return G(((a=t.data)==null?void 0:a.lifts)||[])}).catch(()=>G([]))},[]),s.useEffect(()=>{N.get("/runs").then(t=>{var d;const a=(((d=t.data)==null?void 0:d.runs)||[])[0];a!=null&&a.avg_heart_rate&&de({bpm:a.avg_heart_rate,ts:a.created_at||a.date})}).catch(()=>{})},[]),s.useEffect(()=>{if(n.length>0){const t=n[0];o({name:t.name}),g(String(t.reps||""))}},[]),s.useEffect(()=>(W&&_>0?z.current=setTimeout(()=>J(t=>t-1),1e3):W&&_===0&&(H(!1),ge()),()=>clearTimeout(z.current)),[W,_]);const ee=s.useMemo(()=>be({exerciseName:c==null?void 0:c.name,nextWeight:v,recentLifts:C}),[c==null?void 0:c.name,v,C]);s.useEffect(()=>{B(ee)},[ee]);const te=t=>{clearTimeout(z.current),J(t),H(!0)},ie=async()=>{if(!(c!=null&&c.name))return;const{errors:t}=he({reps:m,weight:v});if(M(t),Object.keys(t).length){oe({reps:X,weight:Y},["reps","weight"]);return}try{const a=await N.post(`/workouts/${l}/sets`,{exercise_name:c.name,muscle_group:f,reps:Number(m),weight_lbs:Number(v),set_number:S});p(I=>[...I,a.data.set]);const d=S+1;T(d),g(""),R(""),M({}),B(""),te(90);const b=n[k];if(b&&d>Number(b.sets)){const I=k+1;if(I<n.length){const le=n[I];P(I),o({name:le.name}),g(String(le.reps||"")),R(""),T(1)}}}catch{}},ue=async()=>{if(r.length<1){M({workout:"Log at least 1 set before ending workout."}),oe({workout:Z},["workout"]);return}U(!0),clearInterval($.current);try{await N.put(`/workouts/${l}/end`,{}),u(`/workout/summary/${l}`)}catch{U(!1)}},L=(c==null?void 0:c.name)||"",q=[...r].reverse().find(t=>t.exercise_name===L),se=r.filter(t=>t.exercise_name===L);return e.jsxs("div",{className:"space-y-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Workout Time"}),e.jsx("p",{className:"text-3xl font-bold tabular-nums",style:{color:"var(--accent)"},children:ne(i)}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:O?`HR: ${O.bpm} bpm · ${Math.max(1,Math.round((Date.now()-new Date(O.ts).getTime())/6e4))} min ago`:"No watch data yet — sync your watch to unlock this"})]}),e.jsx("button",{onClick:ue,disabled:K,className:"rounded-xl px-5 py-3 font-bold text-sm",style:{background:"rgba(239,68,68,0.15)",color:"#ef4444",border:"1px solid rgba(239,68,68,0.3)"},children:K?"Ending...":"End Workout"})]}),n.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[j&&e.jsx("p",{className:"text-xs font-bold mb-3 uppercase tracking-widest",style:{color:"var(--accent)"},children:j}),e.jsx("div",{className:"space-y-2",children:n.map((t,a)=>{const d=a===k,b=a<k;return e.jsxs("div",{className:"flex items-center gap-3 rounded-xl px-3 py-2",style:{background:d?"rgba(234,179,8,0.08)":"transparent",borderLeft:d?"3px solid var(--accent)":"3px solid transparent",opacity:b?.4:1},children:[e.jsx("span",{className:"flex-1 text-sm font-semibold",style:{color:d?"var(--accent)":"var(--text-primary)",textDecoration:b?"line-through":"none"},children:t.name}),e.jsxs("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:[t.sets,"x",t.reps]}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:t.rest})]},a)})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>ce(t=>!t),className:"rounded-full px-3 py-1.5 text-xs font-medium border transition-all",style:Q?{background:"var(--accent-dim)",borderColor:"var(--accent)",color:"var(--accent)"}:{background:"var(--bg-card)",borderColor:"var(--border-subtle)",color:"var(--text-muted)"},children:"Rest Timer"})}),Q&&e.jsxs("div",{className:"rounded-xl p-3 space-y-2",style:{background:"var(--bg-card)"},children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-muted)"},children:"Rest Timer"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:ye.map(t=>e.jsx("button",{onClick:()=>te(t),className:"rounded-lg px-3 py-1.5 text-xs font-semibold border",style:W&&_===t?{background:"var(--accent)",color:"black",borderColor:"var(--accent)"}:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",color:"var(--text-muted)"},children:t<60?`${t}s`:`${t/60}m`},t))}),_>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-bold tabular-nums",style:{color:_<=5?"#ef4444":"var(--text-primary)"},children:ne(_)}),e.jsx("button",{onClick:()=>H(t=>!t),className:"rounded-lg px-3 py-1 text-xs font-semibold",style:{background:"var(--accent)",color:"black"},children:W?"Pause":"Resume"})]})]}),w.length>0&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:w.map(t=>e.jsx("button",{onClick:()=>{y(t),o(null),T(1)},className:"rounded-full px-4 py-1.5 text-sm capitalize font-medium whitespace-nowrap border flex-shrink-0",style:f===t?{background:"var(--accent)",borderColor:"var(--accent)",color:"black"}:{background:"var(--bg-card)",borderColor:"var(--border-subtle)",color:"var(--text-muted)"},children:t},t))}),e.jsxs("div",{className:"rounded-2xl p-4 space-y-3",style:{background:"var(--bg-card)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-base",style:{color:"var(--accent)"},children:["Current: ",L||"None selected"]}),e.jsx("button",{onClick:()=>E(!0),className:"text-xs",style:{color:"var(--text-muted)"},children:L?"Change Exercise":"Choose Exercise"})]}),F&&e.jsx(fe,{muscleGroup:f,onSelect:t=>{o(t),T(1),E(!1)},onClose:()=>E(!1)}),q&&e.jsx("div",{className:"rounded-lg px-3 py-2",style:{background:"var(--bg-input)"},children:e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:["Last set: ",e.jsxs("span",{className:"font-bold",style:{color:"var(--text-primary)"},children:[q.reps," reps @ ",q.weight_lbs," lbs"]})]})}),se.length>0&&e.jsx("div",{className:"space-y-1",children:se.map((t,a)=>e.jsxs("div",{className:"flex gap-3 text-sm",style:{color:"var(--text-muted)"},children:[e.jsxs("span",{children:["Set ",a+1]}),e.jsxs("span",{children:[t.reps," reps"]}),e.jsxs("span",{children:[t.weight_lbs," lbs"]})]},t.id))}),L&&e.jsxs("div",{className:"flex gap-3 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Reps"}),e.jsx("input",{type:"number",min:"1",placeholder:"0",value:m,onChange:t=>g(t.target.value),className:"w-full rounded-xl px-3 py-3 text-center text-xl font-bold border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",color:"var(--text-primary)"}}),A.reps&&e.jsx("p",{ref:X,className:"text-xs mt-1",style:{color:"#ef4444"},children:A.reps})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Weight (lbs)"}),e.jsx("input",{type:"number",min:"0",step:"2.5",placeholder:"0",value:v,onChange:t=>R(t.target.value),className:"w-full rounded-xl px-3 py-3 text-center text-xl font-bold border",style:{background:"var(--bg-input)",borderColor:"var(--border-subtle)",color:"var(--text-primary)"}}),A.weight&&e.jsx("p",{ref:Y,className:"text-xs mt-1",style:{color:"#ef4444"},children:A.weight}),V&&e.jsx("p",{className:"text-xs mt-1",style:{color:"#f59e0b"},children:V})]}),e.jsxs("button",{onClick:ie,className:"rounded-xl px-4 py-3 font-bold text-sm",style:{background:"var(--accent)",color:"black"},children:["+ Set ",S]})]})]}),A.workout&&e.jsx("p",{ref:Z,className:"text-xs",style:{color:"#ef4444"},children:A.workout}),r.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{background:"var(--bg-card)"},children:[e.jsxs("p",{className:"text-xs font-medium mb-3",style:{color:"var(--text-muted)"},children:["Sets logged — ",r.length," total"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(r.reduce((t,a)=>(t[a.exercise_name]||(t[a.exercise_name]=[]),t[a.exercise_name].push(a),t),{})).map(([t,a])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:t}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:a.map((d,b)=>e.jsxs("span",{className:"text-xs px-2 py-1 rounded-lg",style:{background:"var(--bg-input)",color:"var(--text-muted)"},children:[b+1,": ",d.reps,"×",d.weight_lbs]},d.id))})]},t))})]})]})}export{je as default};
